(function(c){var b={tagClass:function(j){return"label label-info"},itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false};function g(k,j){this.itemsArray=[];this.$element=c(k);this.$element.hide();this.isSelect=(k.tagName==="SELECT");this.multiple=(this.isSelect&&k.hasAttribute("multiple"));this.objectItems=j&&j.itemValue;this.placeholderText=k.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=c('<div class="bootstrap-tagsinput"></div>');this.$input=c('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.after(this.$container);var l="100%";this.$input.get(0).style.cssText="width: "+l+" !important;";this.build(j)}g.prototype={constructor:g,add:function(t,q){var u=this;if(u.options.maxTags&&u.itemsArray.length>=u.options.maxTags){return}if(t!==false&&!t){return}if(typeof t==="string"&&u.options.trimValue){t=c.trim(t)}if(typeof t==="object"&&!u.objectItems){throw ("Can't add objects when itemValue option is not set")}if(t.toString().match(/^\s*$/)){return}if(u.isSelect&&!u.multiple&&u.itemsArray.length>0){u.remove(u.itemsArray[0])}if(typeof t==="string"&&this.$element[0].tagName==="INPUT"){var r=t.split(",");if(r.length>1){for(var o=0;o<r.length;o++){this.add(r[o],true)}if(!q){u.pushVal()}return}}var l=u.options.itemValue(t),s=u.options.itemText(t),n=u.options.tagClass(t);var k=c.grep(u.itemsArray,function(w){return u.options.itemValue(w)===l})[0];if(k&&!u.options.allowDuplicates){if(u.options.onTagExists){var m=c(".tag",u.$container).filter(function(){return c(this).data("item")===k});u.options.onTagExists(t,m)}return}if(u.items().toString().length+t.length+1>u.options.maxInputLength){return}var v=c.Event("beforeItemAdd",{item:t,cancel:false});u.$element.trigger(v);if(v.cancel){return}u.itemsArray.push(t);var p=c('<span class="tag '+f(n)+'">'+f(s)+'<span data-role="remove"></span></span>');p.data("item",t);u.findInputWrapper().before(p);p.after(" ");if(u.isSelect&&!c('option[value="'+encodeURIComponent(l)+'"]',u.$element)[0]){var j=c("<option selected>"+f(s)+"</option>");j.data("item",t);j.attr("value",l);u.$element.append(j)}if(!q){u.pushVal()}if(u.options.maxTags===u.itemsArray.length||u.items().toString().length===u.options.maxInputLength){u.$container.addClass("bootstrap-tagsinput-max")}u.$element.trigger(c.Event("itemAdded",{item:t}))},remove:function(k,l){var j=this;if(j.objectItems){if(typeof k==="object"){k=c.grep(j.itemsArray,function(n){return j.options.itemValue(n)==j.options.itemValue(k)})}else{k=c.grep(j.itemsArray,function(n){return j.options.itemValue(n)==k})}k=k[k.length-1]}if(k){var m=c.Event("beforeItemRemove",{item:k,cancel:false});j.$element.trigger(m);if(m.cancel){return}c(".tag",j.$container).filter(function(){return c(this).data("item")===k}).remove();c("option",j.$element).filter(function(){return c(this).data("item")===k}).remove();if(c.inArray(k,j.itemsArray)!==-1){j.itemsArray.splice(c.inArray(k,j.itemsArray),1)}}if(!l){j.pushVal()}if(j.options.maxTags>j.itemsArray.length){j.$container.removeClass("bootstrap-tagsinput-max")}j.$element.trigger(c.Event("itemRemoved",{item:k}))},removeAll:function(){var j=this;c(".tag",j.$container).remove();c("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal()},refresh:function(){var j=this;c(".tag",j.$container).each(function(){var l=c(this),n=l.data("item"),o=j.options.itemValue(n),k=j.options.itemText(n),p=j.options.tagClass(n);l.attr("class",null);l.addClass("tag "+f(p));l.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(k);if(j.isSelect){var m=c("option",j.$element).filter(function(){return c(this).data("item")===n});m.attr("value",o)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=c.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true).trigger("change")},build:function(l){var k=this;k.options=c.extend({},b,l);if(k.objectItems){k.options.freeInput=false}a(k.options,"itemValue");a(k.options,"itemText");h(k.options,"tagClass");if(k.options.typeahead){var n=k.options.typeahead||{};h(n,"source");k.$input.typeahead(c.extend({},n,{source:function(r,t){function p(u){var w=[];for(var v=0;v<u.length;v++){var x=k.options.itemText(u[v]);s[x]=u[v];w.push(x)}t(w)}this.map={};var s=this.map,q=n.source(r);if(c.isFunction(q.success)){q.success(p)}else{if(c.isFunction(q.then)){q.then(p)}else{c.when(q).then(p)}}},updater:function(p){k.add(this.map[p])},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(k.options.typeaheadjs){var m=k.options.typeaheadjs||{options:{},datasets:{}};var o=Object.keys(m);var j={};if(o.indexOf("datasets")<0&&o.indexOf("options")<0){j.datasets=m;m=j;j=null}if(o.indexOf("options")<0){m.options={};console.log("got options")}k.$input.typeahead(m.options,m.datasets).on("typeahead:selected",c.proxy(function(q,p){if(m.datasets.valueKey){k.add(p[m.datasets.valueKey])}else{k.add(p)}k.$input.typeahead("val","")},k))}k.$container.on("click",c.proxy(function(p){if(!k.$element.attr("disabled")){k.$input.removeAttr("disabled")}k.$input.focus()},k));if(k.options.addOnBlur&&k.options.freeInput){k.$input.on("focusout",c.proxy(function(p){if(c(".typeahead, .twitter-typeahead",k.$container).length===0){k.add(k.$input.val());k.$input.val("")}},k))}k.$container.on("keydown","input",c.proxy(function(p){var t=c(p.target),u=k.findInputWrapper();if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}switch(p.which){case 8:if(e(t[0])===0){var q=u.prev();if(q){k.remove(q.data("item"))}}break;case 46:if(e(t[0])===0){var r=u.next();if(r){k.remove(r.data("item"))}}break;case 37:var v=u.prev();if(t.val().length===0&&v[0]){v.before(u);t.focus()}break;case 39:var s=u.next();if(t.val().length===0&&s[0]){s.after(u);t.focus()}break;default:}var y=t.val().length,w=Math.ceil(y/5),x=y+w+1;t.attr("size",Math.max(this.inputSize,t.val().length))},k));k.$container.on("keypress","input",c.proxy(function(t){var v=c(t.target);if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}var u=v.val(),s=k.options.maxChars&&u.length>=k.options.maxChars;if(k.options.freeInput&&(d(t,k.options.confirmKeys)||s)){k.add(s?u.substr(0,k.options.maxChars):u);v.val("");t.preventDefault()}var r=v.val().length,q=Math.ceil(r/5),p=r+q+1;v.attr("size",Math.max(this.inputSize,v.val().length))},k));k.$container.on("click","[data-role=remove]",c.proxy(function(p){if(k.$element.attr("disabled")){return}k.remove(c(p.target).closest(".tag").data("item"))},k));if(k.options.itemValue===b.itemValue){if(k.$element[0].tagName==="INPUT"){k.add(k.$element.val())}else{c("option",k.$element).each(function(){k.add(c(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return c(k)}};c.fn.tagsinput=function(k,j){var l=[];this.each(function(){var n=c(this).data("tagsinput");if(!n){n=new g(this,k);c(this).data("tagsinput",n);l.push(n);if(this.tagName==="SELECT"){c("option",c(this)).attr("selected","selected")}c(this).val(c(this).val())}else{if(!k&&!j){l.push(n)}else{if(n[k]!==undefined){var m=n[k](j);if(m!==undefined){l.push(m)}}}}});if(typeof k=="string"){return l.length>1?l:l[0]}else{return l}};c.fn.tagsinput.Constructor=g;function a(k,l){if(typeof k[l]!=="function"){var j=k[l];k[l]=function(m){return m[j]}}}function h(j,k){if(typeof j[k]!=="function"){var l=j[k];j[k]=function(){return l}}}var i=c("<div />");function f(j){if(j){return i.text(j).html()}else{return""}}function e(k){var l=0;if(document.selection){k.focus();var j=document.selection.createRange();j.moveStart("character",-k.value.length);l=j.text.length}else{if(k.selectionStart||k.selectionStart=="0"){l=k.selectionStart}}return(l)}function d(j,l){var k=false;c.each(l,function(o,n){if(typeof(n)==="number"&&j.which===n){k=true;return false}if(j.which===n.which){var q=!n.hasOwnProperty("altKey")||j.altKey===n.altKey,m=!n.hasOwnProperty("shiftKey")||j.shiftKey===n.shiftKey,p=!n.hasOwnProperty("ctrlKey")||j.ctrlKey===n.ctrlKey;if(q&&m&&p){k=true;return false}}});return k}c(function(){c("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);