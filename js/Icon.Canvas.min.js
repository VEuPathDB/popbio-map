L.Icon.Canvas = L.Icon.extend({
    options: {
        iconSize: new L.Point(20, 20),
        className: "leaflet-canvas-icon",
        population: 0,
        stats: [],
        colors: ["#ff4b00", "#bac900", "#EC1813", "#55BCBE", "#D2204C", "#FF0000", "#ada59a", "#3e647e"]
    }, createIcon: function () {
        var c = document.createElement("canvas");
        this._setIconStyles(c, "icon");
        var b = this.options.iconSize;
        var a = this.options.population;
        c.width = b.x;
        c.height = b.y;
        this.draw(c.getContext("2d"), b.x, b.y);
        return c
    }, createShadow: function () {
        return null
    }, draw: function (c, b, o) {
        var k = this.options.iconSize.x, g = k / 2, e = k / 2.5;
        var d = 0;
        var j = Math.PI * 2, f = Math.PI * 1.5;
        var a = f;
        var h = 0;
        for (var n in this.options.stats) {
            if (this.options.stats.hasOwnProperty(n)) {
                var p = this.options.stats[n] / this.options.population;
                if (p > 0) {
                    c.beginPath();
                    c.moveTo(g, g);
                    if (palette.hasOwnProperty(n)) {
                        c.fillStyle = palette[n]
                    } else {
                        c.fillStyle = palette.others
                    }
                    var m = a + 0.14, l = a + p * j;
                    if (l < m) {
                        m = a
                    }
                    c.arc(g, g, g, m, l);
                    a = a + p * j;
                    c.lineTo(g, g);
                    c.fill();
                    c.closePath()
                }
                ++h
            }
        }
        c.beginPath();
        c.fillStyle = "white";
        c.arc(g, g, e, 0, Math.PI * 2);
        c.fill();
        c.closePath();
        c.fillStyle = "#555";
        c.textAlign = "center";
        c.textBaseline = "middle";
        c.font = "bold 12px sans-serif";
        c.fillText(this.options.population, g, g, k)
    }
});