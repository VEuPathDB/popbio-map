L.Icon.Canvas=L.Icon.extend({options:{iconSize:new L.Point(20,20),className:"leaflet-canvas-icon",population:0,stats:[]},createIcon:function(){var c=document.createElement("canvas");this._setIconStyles(c,"icon");var b=this.options.iconSize;var a=this.options.population;c.width=b.x;c.height=b.y;this.draw(c.getContext("2d"),b.x,b.y);return c},createShadow:function(){return null},draw:function(d,c,l){var h=this.options.iconSize.x,f=h/2,e=h/2.5;var g=Math.PI*2;var b=Math.PI*1.5;for(var k in this.options.stats){if(this.options.stats.hasOwnProperty(k)){var m=this.options.stats[k]/this.options.population;if(m>0){d.beginPath();d.moveTo(f,f);if(palette.hasOwnProperty(k)){d.fillStyle=palette[k]}else{d.fillStyle=palette.others}var j=b,i=b+m*g;if(i<j){j=b}d.arc(f,f,f,j,i);b=b+m*g;d.lineTo(f,f);d.fill();d.closePath()}}}d.beginPath();d.fillStyle="white";d.arc(f,f,e,0,Math.PI*2);d.fill();d.closePath();var a=markerColor(this.options.trafficlight);if($("#view-mode").val()==="ir"){d.beginPath();d.fillStyle=a[0];d.arc(f,f,f-7,0,Math.PI*2);d.fill();d.closePath()}d.fillStyle=($("#view-mode").val()==="ir")?a[1]:"#555";d.textAlign="center";d.textBaseline="middle";d.font="bold 12px sans-serif";d.fillText(this.options.population,f,f,h)}});