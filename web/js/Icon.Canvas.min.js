L.Icon.Canvas = L.Icon.extend({
    options: {
        iconSize: new L.Point(20, 20),
        className: "leaflet-canvas-icon",
        population: 0,
        stats: []
    }, createIcon: function () {
        var c = document.createElement("canvas");
        this._setIconStyles(c, "icon");
        var b = this.options.iconSize;
        var a = this.options.population;
        c.width = b.x;
        c.height = b.y;
        this.draw(c.getContext("2d"), b.x, b.y);
        return c
    }, createShadow: function () {
        return null
    }, draw: function (c, b, k) {
        var g = this.options.iconSize.x, e = g / 2, d = g / 2.5;
        var f = Math.PI * 2;
        var a = Math.PI * 1.5;
        for (var j in this.options.stats) {
            if (this.options.stats.hasOwnProperty(j)) {
                var l = this.options.stats[j] / this.options.population;
                if (l > 0) {
                    c.beginPath();
                    c.moveTo(e, e);
                    if (palette.hasOwnProperty(j)) {
                        c.fillStyle = palette[j]
                    } else {
                        c.fillStyle = palette.others
                    }
                    var i = a, h = a + l * f;
                    if (h < i) {
                        i = a
                    }
                    c.arc(e, e, e, i, h);
                    a = a + l * f;
                    c.lineTo(e, e);
                    c.fill();
                    c.closePath()
                }
            }
        }
        c.beginPath();
        c.fillStyle = "white";
        c.arc(e, e, d, 0, Math.PI * 2);
        c.fill();
        c.closePath();
        c.fillStyle = "#555";
        c.textAlign = "center";
        c.textBaseline = "middle";
        c.font = "bold 12px sans-serif";
        c.fillText(this.options.population, e, e, g)
    }
});