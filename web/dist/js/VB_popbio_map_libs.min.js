/*! VectorBase Population Biology Map - v0.2.1 - 2016-04-20
* https://www.vectorbase.org/popbio/
* Copyright (c) 2016  */
function _typeof(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a}function refine_interval(a,b,c){b&c?a[0]=(a[0]+a[1])/2:a[1]=(a[0]+a[1])/2}function calculateAdjacent(a,b){a=a.toLowerCase();var c=a.charAt(a.length-1),d=a.length%2?"odd":"even",e=a.substring(0,a.length-1);return-1!=BORDERS[b][d].indexOf(c)&&(e=calculateAdjacent(e,b)),e+BASE32[NEIGHBORS[b][d].indexOf(c)]}function decodeGeoHash(a){var b=1,d=[],e=[];for(d[0]=-90,d[1]=90,e[0]=-180,e[1]=180,lat_err=90,lon_err=180,i=0;i<a.length;i++)for(c=a[i],cd=BASE32.indexOf(c),j=0;j<5;j++)mask=BITS[j],b?(lon_err/=2,refine_interval(e,cd,mask)):(lat_err/=2,refine_interval(d,cd,mask)),b=!b;return d[2]=(d[0]+d[1])/2,e[2]=(e[0]+e[1])/2,{latitude:d,longitude:e}}function encodeGeoHash(a,b){var c=1,d=[],e=[],f=0,g=0,h=12;for(geohash="",d[0]=-90,d[1]=90,e[0]=-180,e[1]=180;geohash.length<h;)c?(mid=(e[0]+e[1])/2,b>mid?(g|=BITS[f],e[0]=mid):e[1]=mid):(mid=(d[0]+d[1])/2,a>mid?(g|=BITS[f],d[0]=mid):d[1]=mid),c=!c,4>f?f++:(geohash+=BASE32[g],f=0,g=0);return geohash}function get_bit(a,b){return a/Math.pow(2,b)&1}function createBeeViolinPlot(a,b){"use strict";if("smpl"===$("#view-mode").val())return void $(a).html('<div style="text-align: center; margin-top: 30px"><i class="fa fa-area-chart" style="color: #C3312D; font-size: 12em"></i><h1>Ooops</h1><h4>this plot type only works with Insecticide Resistance data</h4><h4>switch to IR phenotypes view and try again</h4></div>');var c=solrPopbioUrl+"irViolinStats?&"+qryUrl+b+"&json.wrf=?&callback=?";$("#swarm-chart-area").fadeOut(),$.getJSON(c).done(function(c){PaneSpin("swarm-plots","start"),c.facets.count&&c.facets.count>0&&setTimeout(function(){$(a).empty();var d=$("<label>").text("Phenotypes included in background: "),e=$("<select />").attr("id","bgPlotType").attr("class","form-control");$("<option/>",{text:"phenotypes matching search",value:1}).appendTo(e),$("<option/>",{text:"phenotypes visible on map (including the ones behind this panel)",value:2}).appendTo(e),$("<option/>",{text:"all phenotypes",value:3}).appendTo(e),d.appendTo($(a)),e.val(bgPlotType).appendTo($(a)),d=$("<label>").text("Measurement type: ");var f=$("<select />").attr("id","plotType").attr("class","form-control");c.facets.vtypes.buckets.forEach(function(a){a.vunits.buckets.forEach(function(b){var c=a.val+" ("+b.val+"): "+b.count+" phenotypes";$("<option/>",{text:c,value:a.val+"-"+b.val,data:{phenotype_value_type_s:a.val,phenotype_value_unit_s:b.val,count:b.count,min:b.pmin,max:b.pmax}}).appendTo(f)})}),d.appendTo($(a)),f.appendTo($(a)),"none"!==selectedPlotType&&$('#plotType option[value="'+selectedPlotType+'"]').length>0&&$("#plotType").val(selectedPlotType);var g=f.find(":selected").data();buildPlot(a,b,g),f.change(function(){PaneSpin("swarm-plots","start"),g=f.find(":selected").data(),$("#beeViolinPlot").fadeOut(),setTimeout(function(){buildPlot(a,b,g)},delay)}),e.change(function(){PaneSpin("swarm-plots","start"),g=f.find(":selected").data(),bgPlotType=e.find(":selected").val(),$("#beeViolinPlot").fadeOut(),setTimeout(function(){buildPlot(a,b,g)},delay)})},delay)}).fail(function(){PaneSpin("swarm-plots","stop"),console.log("Failed while loading irViolinStats")})}function addViolin(a,b,c,d,e,f,g,h){"use strict";var i,j=b.length-1,k=b[j].count,l=b[j].val,m=(e[1]-e[0])/f;b.push({val:l+m,count:k});var n=d3.scale.linear().range([d/2,0]).domain([0,Math.max(d3.max(b,function(a){return 1.5*a.count}))]),o=d3.select("#plotTooltip");i=h?d3.scale.log().range(c).domain(e).nice():d3.scale.linear().range(c).domain(e).nice();var p=(a.append("circle").attr("r",7).style("display","none").style("fill","#FFFFFF").style("pointer-events","none").style("stroke","#FB5050").style("stroke-width","3px"),d3.bisector(function(a){return a.val}).left),q=d3.svg.area().interpolate(g).x(function(a){return i(a.val)}).y0(d/2).y1(function(a){return n(a.count)}),r=d3.svg.line().interpolate(g).x(function(a){return i(a.val)}).y(function(a){return n(a.count)}),s=a.append("g"),t=a.append("g");s.append("path").datum(b).attr("class","area").attr("d",q).on("mouseover",function(){o.transition().duration(100).style("opacity",1)}).on("mouseout",function(a){o.transition().duration(500).style("opacity",0)}).on("mousemove",function(a){var b=d3.mouse(this),c=i.invert(b[0]),d=p(a,c),e=a.length-1;if(0===d)var f="Range: "+a[d].val.roundDecimals(4)+"-"+(a[d].val+m).roundDecimals(4),g=a[d].count;else if(e>d)var f="Range: "+a[d-1].val.roundDecimals(4)+"-"+(a[d-1].val+m).roundDecimals(4),g=a[d-1].count;else var f="Range: "+a[e-1].val.roundDecimals(4)+"-"+(a[e-1].val+m).roundDecimals(4),g=a[e-1].count;var h='<h3 style="background-color: #CCCCCC;"><font color="white">Count of phenotypes</font></h3><p>%BIN</p><p><b>%COUNT</b></p>'.replace("%BIN",f).replace("%COUNT",g);o.html(h).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}),s.append("path").datum(b).attr("class","violin").attr("d",r),t.append("path").datum(b).attr("class","area").attr("d",q).on("mouseover",function(){o.transition().duration(100).style("opacity",1)}).on("mouseout",function(a){o.transition().duration(500).style("opacity",0)}).on("mousemove",function(a){var b=d3.mouse(this),c=i.invert(b[0]),d=p(a,c),e=a.length-1;if(0===d)var f="Range: "+a[d].val.roundDecimals(4)+"-"+(a[d].val+m).roundDecimals(4),g=a[d].count;else if(e>d)var f="Range: "+a[d-1].val.roundDecimals(4)+"-"+(a[d-1].val+m).roundDecimals(4),g=a[d-1].count;else var f="Range: "+a[e-1].val.roundDecimals(4)+"-"+(a[e-1].val+m).roundDecimals(4),g=a[e-1].count;var h='<h3 style="background-color: #CCCCCC;"><font color="white">Count of phenotypes</font></h3><p>%BIN</p><p><b>%COUNT</b></p>'.replace("%BIN",f).replace("%COUNT",g);o.html(h).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}),t.append("path").datum(b).attr("class","violin").attr("d",r),s.attr("transform","rotate(90,0,0)  translate(0,-"+d+")"),t.attr("transform","rotate(90,0,0) scale(1,-1)")}function addBoxPlot(a,b,c,d,e,f,g,h){"use strict";var i=d3.select("#plotTooltip");if(h){var j=d3.scale.log().range(d).domain(f).nice();console.log("Printing log in boxplot")}else var j=d3.scale.linear().range(d).domain(f).nice();for(var k=d3.scale.linear().range([0,e]),l=.5-g/2,m=.5+g/2,n=[.05,.25,.5,.75,.95],o=0;o<n.length;o++)n[o]=j(b[o]);var p=a.append("g");p.append("rect").attr("class","boxplot fill").attr("x",k(l)).attr("width",k(m)-k(l)).attr("y",n[3]).attr("height",-n[3]+n[1]),p.append("rect").attr("class","boxplot").attr("x",k(l)).attr("width",k(m)-k(l)).attr("y",n[3]).attr("height",-n[3]+n[1]);var q=[[0,1],[3,4]];for(o=0;o<q.length;o++)p.append("line").attr("class","boxplot").attr("x1",k(.5)).attr("x2",k(.5)).attr("y1",n[q[o][0]]).attr("y2",n[q[o][1]]);q=[0,1,2,3,4];for(var r=["","","median","",""],s=['<h3 style="background-color: #000000"><font color="white">5th percentile</font></h3><p><b>%VALUE</b></p>','<h3 style="background-color: #000000"><font color="white">25th percentile</font></h3><p><b>%VALUE</b></p>','<h3 style="background-color: #ff0000"><font color="white">Median</font></h3><p><b>%VALUE</b></p>','<h3 style="background-color: #000000"><font color="white">75th percentile</font></h3><p><b>%VALUE</b></p>','<h3 style="background-color: #000000"><font color="white">95th percentile</font></h3><p><b>%VALUE</b></p>'],o=0;o<q.length;o++)!function(a){var c=s[o].replace("%VALUE",b[q[o]].roundDecimals(4));p.append("line").attr("class","boxplot "+r[o]).attr("x1",k(l)).attr("x2",k(m)).attr("y1",n[q[o]]).attr("y2",n[q[o]]).on("mouseover",function(){i.transition().duration(100).style("opacity",1),i.html(c).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){i.transition().duration(500).style("opacity",0)})}(o);var t='<h3 style="background-color: #ff0000"><font color="white">Mean</font></h3><p><b>'+c.roundDecimals(4)+"</b></p>";p.append("circle").attr("class","boxplot mean").attr("cx",k(.5)).attr("cy",j(c)).attr("r",k(g/5)).on("mouseover",function(){i.transition().duration(100).style("opacity",1),i.html(t).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){i.transition().duration(500).style("opacity",0)})}function addBeeswarm(a,b,c,d,e,f,g){"use strict";var h,i=d3.select("#beeswarmPointTooltip");h=g?d3.scale.log().range(c).domain(e).nice():d3.scale.linear().range(c).domain(e).nice();var j=d3.scale.linear().range(d).domain(f).nice(),k=a.append("g");b.swarm.forEach(function(a,c){var d,e=b.data[c],f=e.bgColor,g=(e.y,e.collectionDate);if(g&&g.length>1){var l=new Date(g[0]),m=new Date(g[1]);d=l.toDateString()+"-"+m.toDateString()}else if(g&&g.length>0){var n=new Date(g[0]);d=n.toDateString()}e.collectionDate=d;var o=e.species?e.species:"Unknown";e.species=o;var p=$.templates("#irBsPointTemplate"),q=p.render(e);k.append("circle").attr("cx",j(a.x)).attr("cy",h(a.y)).attr("r",4).style("fill",f).on("mouseover",function(a){if(!stickyHover){$("#cancel-hover").css("display","none"),i.transition().duration(100).style("opacity",1).style("z-index",1e6),i.html(q);var b,c=window.innerHeight,d=i.node().getBoundingClientRect().height;b=d3.event.pageY-8+d>c?d3.event.pageY-d+28:d3.event.pageY-28,i.style("left",d3.event.pageX+20+"px").style("top",b+"px")}}).on("mouseout",function(a){stickyHover||i.transition().duration(500).style("opacity",0).style("z-index",-1e6)}).on("click",function(){i.transition().duration(100).style("opacity",1),stickyHover=!0,$("#no-interactions").addClass("foreground").on("click",function(){i.transition().duration(500).style("opacity",0).style("z-index",-1e6),$("#no-interactions").removeClass("foreground"),stickyHover=!1}),$("#cancel-hover").css("display","inline").on("click",function(){i.transition().duration(500).style("opacity",0).style("z-index",-1e6),$("#no-interactions").removeClass("foreground"),stickyHover=!1})})})}function buildPlot(a,b,c){"use strict";function d(a,b,c,d,e){var f=d3.scale.linear().range([j-u.bottom,u.top]).domain(a).nice(),h=d3.svg.axis().scale(f).orient("left");r.append("g").attr("class","axis").attr("transform","translate("+u.left+",0)").call(h),r.append("text").attr("x",u.left+s+t/2).attr("y",10).style("text-anchor","middle").text(g.capitalizeFirstLetter()),r.append("text").attr("x",u.left+s/2).attr("y",j-u.bottom+24).style("text-anchor","middle").style("font-weight","bold").text("Background"),r.append("text").attr("x",u.left+s/2).attr("y",j-u.bottom+40).style("text-anchor","middle").text("n="+b),c>0&&r.append("text").attr("x",u.left+s/2).attr("y",j-u.bottom+54).style("text-anchor","middle").text(c>1?c+" outliers excluded":c+" outlier excluded"),r.append("text").attr("x",u.left+s+t+s/2).attr("y",j-u.bottom+22).style("text-anchor","middle").style("font-weight","bold").text("Selection"),r.append("text").attr("x",u.left+s+t+s/2).attr("y",j-u.bottom+40).style("text-anchor","middle").text("n="+d),e>0&&r.append("text").attr("x",u.left+s+t+s/2).attr("y",j-u.bottom+54).style("text-anchor","middle").text(e>1?e+" outliers excluded":e+" outlier excluded")}var e,f=c.count,g=(c.min,c.max,c.phenotype_value_type_s),h=c.phenotype_value_unit_s,i=380,j=500,k=d3.select(a),l=25,m="basis";if(3>f)var n={pmin:"min(phenotype_value_f)",pmax:"max(phenotype_value_f)"};else var n={pmin:"percentile(phenotype_value_f,1)",pmax:"percentile(phenotype_value_f,99)"};var o=buildBbox(map.getBounds());d3.select("#beeViolinPlot")&&d3.select("#beeViolinPlot").remove();var p,q,r=k.append("svg").attr("width",i).attr("height",j).attr("style","width: "+i+"px; height: "+j+"px; border: 0; padding-top:10px").attr("id","beeViolinPlot"),s=150,t=10,u={top:25,bottom:65,left:40,right:20};switch($("#bgPlotType").val()){case"1":q=solrPopbioUrl+"irViolin?&"+qryUrl+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?";break;case"2":q=solrPopbioUrl+"irViolin?&"+qryUrl+o+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?";break;case"3":q=solrPopbioUrl+'irViolin?&q=*&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?"}$.getJSON(q).done(function(a){e=a.response.numFound;var c=a.facets.pmin,i=a.facets.pmax,k="&fq=phenotype_value_f:["+c+" TO "+i+"]";switch("percent"===h&&"mortality rate"===g&&(c=0,i=100),n={pmean:"avg(phenotype_value_f)",pperc:"percentile(phenotype_value_f,5,25,50,75,95)",pmin:"min(phenotype_value_f)",pmax:"max(phenotype_value_f)",denplot:{type:"range",field:"phenotype_value_f",gap:(i-c)/l,start:c,end:i,include:"edge"}},$("#bgPlotType").val()){case"1":p=solrPopbioUrl+"irBeeswarm?&"+qryUrl+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.wrf=?&callback=?',q=solrPopbioUrl+"irViolin?&"+qryUrl+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?";break;case"2":p=solrPopbioUrl+"irBeeswarm?&"+qryUrl+k+o+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.wrf=?&callback=?',q=solrPopbioUrl+"irViolin?&"+qryUrl+k+o+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?";break;case"3":p=solrPopbioUrl+"irBeeswarm?&q=*"+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.wrf=?&callback=?',q=solrPopbioUrl+"irViolin?&q=*"+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+"&json.wrf=?&callback=?"}var v=$.getJSON(q);v.done(function(a){var o=r.append("g").attr("transform","translate("+(0*(s+t)+u.left)+",0)"),q=a.response.numFound;"percent"===h&&"mortality rate"===g&&(c=0,i=100);var v,w,x,y,z,A,B,C,D,E=[c,i],F=s/2;if(q>50)a.facets.count>0&&(A=a.facets.denplot.buckets,B=a.facets.pmean,C=a.facets.pperc,D=a.facets.count,addViolin(o,A,[j-u.bottom,u.top],s,E,l,m,!1),addBoxPlot(o,C,B,[j-u.bottom,u.top],s,E,.15,!1));else if(q>=10&&50>=q){var G=$.getJSON(p);G.fail(function(){console.log("Failed while loading irBeeswarm")}),G.done(function(b){if(b.grouped.phenotype_value_type_s.matches>0){w=b.grouped.phenotype_value_type_s.groups[0],F=s/2,v=[],y=(4*(i-c)/s).toFixed(6);var d=getScaleFactor(y),e=y*d;w.doclist.docs.forEach(function(a,b){buildDataset(v,a)}),x=new Beeswarm(v,0,e,d),z=[(s-8*x.maxPoints)/2,(s-8*x.maxPoints)/2+8*x.maxPoints],8*x.maxPoints>s&&(z=[0,s]),addBeeswarm(o,x,[j-u.bottom,u.top],z,E,x.domain,!1)}a.facets.count>0&&(A=a.facets.denplot.buckets,B=a.facets.pmean,C=a.facets.pperc,D=a.facets.count,addBoxPlot(o,C,B,[j-u.bottom,u.top],s,E,.15,!1))})}else{var G=$.getJSON(p);G.fail(function(){console.log("Failed while loading irBeeswarm")}),G.done(function(a){if(a.grouped.phenotype_value_type_s.matches>0){w=a.grouped.phenotype_value_type_s.groups[0],v=[],y=(4*(i-c)/s).toFixed(6);var b=getScaleFactor(y),d=y*b;w.doclist.docs.forEach(function(a,b){buildDataset(v,a)}),x=new Beeswarm(v,0,d,b),z=[(s-8*x.maxPoints)/2,(s-8*x.maxPoints)/2+8*x.maxPoints],8*x.maxPoints>s&&(z=[0,s]),addBeeswarm(o,x,[j-u.bottom,u.top],z,E,x.domain,!1)}})}var H=solrPopbioUrl+"irBeeswarm?&"+qryUrl+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"'+b+"&json.wrf=?&callback=?",I=solrPopbioUrl+"irViolin?&"+qryUrl+k+'&fq=phenotype_value_type_s:"'+g+'"&fq=phenotype_value_unit_s:"'+h+'"&json.facet='+JSON.stringify(n)+b+"&json.wrf=?&callback=?",J=$.getJSON(H),K=$.getJSON(I);$.when(J,K).done(function(a,b){var g,h,k,n,o,p,v,w,x=b[0].response.numFound,y=(b[0].facets.pmin,b[0].facets.pmax,r.append("g").attr("transform","translate("+(1*(s+t)+u.left)+",0)")),z=s/2;if(x>50)b[0].facets.count>0&&(p=b[0].facets.denplot.buckets,v=b[0].facets.pmean,w=b[0].facets.pperc,addViolin(y,p,[j-u.bottom,u.top],s,E,l,m,!1),addBoxPlot(y,w,v,[j-u.bottom,u.top],s,E,.15,!1));else if(x>=10&&50>=x){if(a[0].grouped.phenotype_value_type_s.matches>0){h=a[0].grouped.phenotype_value_type_s.groups[0],z=s/2,g=[],n=(4*(i-c)/s).toFixed(6);var A=getScaleFactor(n),B=n*A;h.doclist.docs.forEach(function(a,b){buildDataset(g,a)}),k=new Beeswarm(g,0,B,A),o=[(s-8*k.maxPoints)/2,(s-8*k.maxPoints)/2+8*k.maxPoints],8*k.maxPoints>s&&(o=[0,s]),addBeeswarm(y,k,[j-u.bottom,u.top],o,E,k.domain,!1)}b[0].facets.count>0&&(v=b[0].facets.pmean,w=b[0].facets.pperc,addBoxPlot(y,w,v,[j-u.bottom,u.top],s,E,.15,!1))}else if(a[0].grouped.phenotype_value_type_s.matches>0){h=a[0].grouped.phenotype_value_type_s.groups[0],g=[],n=(4*(i-c)/s).toFixed(6);var A=getScaleFactor(n),B=n*A;h.doclist.docs.forEach(function(a,b){buildDataset(g,a)}),k=new Beeswarm(g,0,B,A),o=[(s-8*k.maxPoints)/2,(s-8*k.maxPoints)/2+8*k.maxPoints],8*k.maxPoints>s&&(o=[0,s]),addBeeswarm(y,k,[j-u.bottom,u.top],o,E,k.domain,!1)}d(E,q,e-q,x,f-x),PaneSpin("swarm-plots","stop"),$("#swarm-chart-area").fadeIn(),$("#beeViolinPlot").fadeIn()}),J.fail(function(){console.log("Failed while loading irBeeswarm"),PaneSpin("swarm-plots","stop")}),K.fail(function(){console.log("Failed while loading irViolin"),PaneSpin("swarm-plots","stop")})}),v.fail(function(){console.log("Failed while loading irViolin")})}).fail(function(){console.log("Failed while loading irViolin")})}function getScaleFactor(a){a=parseFloat(a)+"";var b=a.indexOf(".");return-1==b?1:Math.pow(10,a.length-b-1)}function buildDataset(a,b){a.push({x:void 0,y:b.phenotype_value_f,species:b.species_category,speciesType:"Taxonomy",insecticide:b.insecticide_s,insecticideType:"Insecticides",concentration:b.concentration_f,duration:b.duration_f,accession:b.accession,accessionType:"Stable ID",bundleName:b.bundle_name,url:b.url,sampleType:b.sample_type,sampleTypeType:"Sample type",geoCoords:b.geo_coords,geolocation:b.geolocations[0],geolocationType:"Geography",bgColor:b.species_category?palette[b.species_category[0]]:palette.Unknown,textColor:getContrastYIQ(b.species_category?palette[b.species_category[0]]:palette.Unknown),collectionDate:b.collection_date,projects:b.projects,projectsType:"Projects",collectionProtocols:b.collection_protocols,collectionProtocolsType:"Collection protocols",protocols:b.protocols,protocolsType:"Protocols",phenotypeValue:b.phenotype_value_f,phenotypeValueType:b.phenotype_value_type_s,phenotypeValueUnit:b.phenotype_value_unit_s,sampleSize:b.sample_size_i,concentrationUnit:b.concentration_unit_s,durationUnit:b.duration_unit_s})}function bindEvents(){"use strict";"ir"===urlParams.view?($("#SelectViewDropdown").find(".dropdown-menu li a").parents(".dropdown").find(".btn").html("<i class='fa fa-eye' id='view-icon'></i> Insecticide Resistance <span class=\"caret\"></span>"),$("#view-mode").val("ir")):($("#SelectViewDropdown").find(".dropdown-menu li a").parents(".dropdown").find(".btn").html("<i class='fa fa-eye' id='view-icon'></i> Samples <span class=\"caret\"></span>"),$("#view-mode").val("smpl"));var a="";$.each(colorBrewer.slice().reverse(),function(b,c){a+='<i style="margin: 0; border-radius: 0; border: 0; color: '+c+"; width: 10%; background-color: "+c+' ;"></i>'}),$("#menu-scale-bars").html(a),normIrSlider=$("#pre-norm-ir-slider").bslider({value:[0,9],id:"norm-ir-slider",handle:"triangle",min:0,max:9,step:1,tooltip:"hide"}),$(".sidebar-icon").on("click",function(){var a=$(".highlight-marker");a&&(sidebarClick=!0,$(a).trigger("click"),sidebarClick=!1)}),$(document).on("click",".active-term",function(){highlightedId=$(".highlight-marker").attr("id"),"swarm-plots"===$(".sidebar-pane.active").attr("id")?selectedPlotType=$("#plotType").val():$("#plotType").val("none"),$("#search_ac").tagsinput("add",{value:$(this).attr("value"),activeTerm:!0,type:$(this).attr("type"),field:mapTypeToField($(this).attr("type")),qtype:"exact"});var a=d3.select("#beeswarmPointTooltip");$("#no-interactions").hasClass("foreground")&&(a.transition().duration(500).style("opacity",0).style("z-index",-1e6),$("#no-interactions").removeClass("foreground"),stickyHover=!1)}).on("click",".active-legend",function(){$("#search_ac").tagsinput("add",{value:$(this).attr("value"),activeTerm:!0,type:$(this).attr("type"),field:mapTypeToField($(this).attr("type")),qtype:"exact"});var a=d3.select("#beeswarmPointTooltip");$("#no-interactions").hasClass("foreground")&&(a.transition().duration(500).style("opacity",0).style("z-index",-1e6),$("#no-interactions").removeClass("foreground"),stickyHover=!1)}).on("jsonLoaded",function(){if(highlightedId){var a=$("#"+highlightedId);a.length>0?($(a).trigger("click"),highlightMarker(a)):(sidebar.close(),setTimeout(function(){resetPlots()},delay)),highlightedId=!1}}),$("#grid-toggle").change(function(){if($(this).prop("checked")){var a=geohashLevel(map.getZoom(),"geohash");addGeohashes(map,a.slice(-1))}else map.removeLayer(geohashesGrid)}),$("#advanced-options").on("show.bs.collapse",function(){$("#bars-icon").toggleClass("down")}).on("hide.bs.collapse",function(){$("#bars-icon").toggleClass("down")}),$("#daterange").on("hidden.bs.collapse",function(){$("#date-start").datepicker("clearDates"),$("#date-end").datepicker("clearDates"),$("#add-dates").prop("disabled",!0),$("#add-season").prop("disabled",!0)}),$("#seasonal").on("hidden.bs.collapse",function(){checkSeasonal()||$(".season-toggle").each(function(){$(this).prop("checked")&&$(this).bootstrapToggle("off")})}),$("#date-select, #SelectViewDropdown").click(function(){"true"==$("#seasonal").attr("aria-expanded")&&$("#seasonal").collapse("hide")}),$("#season-select, #SelectViewDropdown").click(function(){"true"==$("#daterange").attr("aria-expanded")&&$("#daterange").collapse("hide")}),$("#daterange").find(".input-daterange").datepicker({format:"dd/mm/yyyy",startView:2,todayBtn:"linked",autoclose:!0,todayHighlight:!0,endDate:"Date.now()"}),$(".season-toggle").change(function(){var a=!1;$(".season-toggle").each(function(){var b=$(this).val(),c=$(this).prop("checked");months[b]=c,c&&(a=!0)}),a?$("#add-season").prop("disabled",!1):$("#add-season").prop("disabled",!0)}),$("#add-season").click(function(){var a=constructSeasonal(months);checkSeasonal()?($("#search_ac").tagsinput("add",{value:a.rangesText.toString(),ranges:a.ranges,replace:!0,type:"Seasonal",field:"collection_season"}),$("#search_ac").tagsinput("remove",checkSeasonal())):$("#search_ac").tagsinput("add",{value:a.rangesText.toString(),ranges:a.ranges,replace:!1,type:"Seasonal",field:"collection_season"})}),$("#add-norm-ir").click(function(){var a={0:1,1:.9,2:.8,3:.7,4:.6,5:.4,6:.3,7:.2,8:.1,9:0},b=normIrSlider.bslider("getValue"),c=b[0],d=b[1],e="";console.log(c+" - "+d),$.each(colorBrewer.slice().reverse().slice(c,d+1),function(a,b){e+='<i style="margin: 0; border-radius: 0; border: 0; color: '+b+"; width: 6px; background-color: "+b+' ;">&nbsp &nbsp</i>'}),b=a[d]+" TO "+a[c],console.log(b),$("#search_ac").tagsinput("add",{value:b,html:e,normIrValues:b,type:"Norm-IR",field:"phenotype_rescaled_value_f"})}),$("#date-start").datepicker().on("changeDate",function(a){$("#add-dates").prop("disabled",!1)}),$("#add-dates").click(function(){var a,b=new Date($("#date-start").datepicker("getUTCDate")),c=new Date($("#date-end").datepicker("getUTCDate"));a=b.getTime()===c.getTime()?b.toLocaleDateString("en-GB"):b.toLocaleDateString("en-GB")+"-"+c.toLocaleDateString("en-GB"),$("#search_ac").tagsinput("add",{value:a,dateStart:b,dateEnd:c,type:"Date",field:"collection_date_range"})}),$(".date-shortcut").click(function(){console.log(this.value),setDateRange("#date-start","#date-end",this.value)}),$("#search_ac").on("itemAdded",function(a){if(!a.item.replace){if(a.item.activeTerm)return $("#search-bar").animate({left:"+=4"},15).animate({left:"-=8"},30).animate({left:"+=8"},30).animate({left:"-=8"},30).animate({left:"+=8"},30).animate({left:"-=4"},15),void filterMarkers($("#search_ac").tagsinput("items"));removeHighlight(),sidebar.close(),setTimeout(function(){resetPlots()},delay),filterMarkers($("#search_ac").tagsinput("items"))}}),$("#search_ac").on("itemRemoved",function(){checkSeasonal()||$(".season-toggle").each(function(){$(this).prop("checked")&&$(this).bootstrapToggle("off")}),removeHighlight(),sidebar.close(),setTimeout(function(){resetPlots()},delay),filterMarkers($("#search_ac").tagsinput("items"))})}function initializeMap(){"use strict";map=L.map("map",{center:[23.079,3.515],zoom:3,zoomControl:!1,worldCopyJump:!0}),map.spin(!0),map.addControl(new L.Control.FullScreen({position:"topright",forcePseudoFullscreen:!0})),map.addControl(new L.Control.ZoomMin({position:"topright"})),sidebar=L.control.sidebar("sidebar").addTo(map);var a=new L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{minZoom:2,maxZoom:15,subdomains:["otile1","otile2","otile3","otile4"],noWrap:0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'}),b=new L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",{minZoom:2,maxZoom:15,maxNativeZoom:11,subdomains:["otile1","otile2","otile3","otile4"],noWrap:0,attribution:"Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency"}),c=new L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:2,maxZoom:15,noWrap:0,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>'});map.addLayer(a),assetLayerGroup=new L.LayerGroup,assetLayerGroup.addTo(map);var d=new L.Control.Layers({"MapQuest-OSM":a,OpenStreetMap:c,"MapQuest Open Aerial":b});d.setPosition("topright"),d.addTo(map);var e=solrPopbioUrl+$("#view-mode").val()+"Palette?q=*&facet.pivot=geohash_2,species_category&json.wrf=?&callback=?";legend=new L.control.legend(e),null!==rectHighlight&&map.removeLayer(rectHighlight),rectHighlight=null,map.spin(!1)}function initializeSearch(){$("#reset-search").click(function(){$("#search_ac").tagsinput("removeAll"),$(".season-toggle").each(function(){$(this).prop("checked")&&$(this).bootstrapToggle("off")}),removeHighlight(),sidebar.close(),setTimeout(function(){resetPlots()},delay),filterMarkers("")});var a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,limit:7,minLength:2,hint:!1,remote:{url:solrTaUrl+$("#view-mode").val()+"Ac?q=",ajax:{dataType:"jsonp",data:{wt:"json",rows:7},jsonp:"json.wrf"},replace:function(a,b){a=solrTaUrl+$("#view-mode").val()+"Ac?q=";var c=b.match(/([^@]+)@([^@]*)/);return null!=c?(partSearch=c[1],$("#world-toggle").prop("checked")?solrTaUrl+$("#view-mode").val()+"Acat?q="+encodeURI(c[1])+buildBbox(map.getBounds()):solrTaUrl+$("#view-mode").val()+"Acat?q="+encodeURI(c[1])):(partSearch=!1,$("#world-toggle").prop("checked")?a+encodeURI(b)+buildBbox(map.getBounds()):a+encodeURI(b))},filter:function(a){return partSearch?$.map(a.grouped.type.doclist.docs,function(a){return{value:partSearch,id:a.id,type:a.type,field:a.field,is_synonym:a.is_synonym,qtype:"partial"}}):$.map(a.grouped.textsuggest_category.doclist.docs,function(a){return{value:a.textsuggest_category,type:a.type,id:a.id,field:a.field,is_synonym:a.is_synonym,qtype:"exact"}})}}});a.initialize();var b=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,minLength:3,remote:{url:solrTaUrl+$("#view-mode").val()+"Acgrouped?q=",ajax:{dataType:"jsonp",data:{wt:"json",rows:10},jsonp:"json.wrf"},replace:function(a,b){return a=solrTaUrl+$("#view-mode").val()+"Acgrouped?q=",$("#world-toggle").prop("checked")?a+encodeURI(b)+"*":a+encodeURI(b)+"*"+buildBbox(map.getBounds())},filter:function(a){a.grouped.stable_id.ngroups;return $.map(a.facet_counts.facet_fields.type,function(a){return a[1]>0?{count:a[1],type:a[0],field:mapTypeToField(a[0]),value:$("#search_ac").tagsinput("input")[0].value,qtype:"summary"}:void 0})}}});b.initialize(),$("#search_ac").tagsinput({tagClass:function(a){return mapTypeToIcon(a.type)},itemValue:"value",itemText:function(a){return" "+a.value},typeaheadjs:{options:{minLength:3,hint:!1,highlight:!1},datasets:[{name:"acSuggestions",displayKey:"value",source:a.ttAdapter(),templates:{empty:function(){var a;return a=$("#world-toggle").prop("checked")?"No suggestions found. Try enabling world search or hit enter to perform a free text search instead.":"No suggestions found. Hit Enter to perform a free text search instead.",['<span class="tt-suggestions" style="display: block;">','<div class="tt-suggestion">','<p style="white-space: normal;">',a,"</p>","</div>","</span>"].join("\n")},suggestion:function(a){return"<p>"+a.value+(a.is_synonym?' (<i class="fa fa-list-ul" title="Duplicate term / Synonym" style="cursor: pointer"></i>)':"")+" <em> in "+a.type+"</em></p>"}}},{name:"acOtherResults",displayKey:"value",source:b.ttAdapter(),templates:{header:'<h4 class="more-results">More suggestions</h4>',suggestion:function(a){return"<p>~"+a.count+" <em>in "+a.type+"</em></p>"}}}]}}),$(".dropdown-menu li a").click(function(){$(this).parents(".dropdown").find(".btn").html($(this).data("value")+' <span class="caret"></span>'),$(this).parents(".dropdown").find(".btn").val($(this).data("value"));var c=$(this).text();"Samples"===c?$("#view-mode").val("smpl"):$("#view-mode").val("ir");var d=solrPopbioUrl+$("#view-mode").val()+"Palette?q=*&facet.pivot=geohash_2,species_category&json.wrf=?&callback=?";removeHighlight(),sidebar.close(),setTimeout(function(){resetPlots()},delay),$.getJSON(d,function(a){legend.populateLegend(a,"species_category")}),a.initialize(!0),b.initialize(!0)}),$("#SelectViewDropdown").find(".dropdown-menu li a").click(function(){var c=$(this).text();"Samples"===c?$("#view-mode").val("smpl"):$("#view-mode").val("ir");var d=solrPopbioUrl+$("#view-mode").val()+"Palette?q=*&facet.pivot=geohash_2,species_category&json.wrf=?&callback=?";removeHighlight(),sidebar.close(),setTimeout(function(){resetPlots()},delay),$.getJSON(d,function(a){legend.populateLegend(a,"species_category")}),a.initialize(!0),b.initialize(!0)})}function loadSolr(a){"use strict";var b=a.clear,c=a.zoomLevel,d=geohashLevel(c,"geohash");("true"===urlParams.grid||$("#grid-toggle").prop("checked"))&&addGeohashes(map,d.slice(-1));var e=[],f=function(a){if($("#markersCount").html(a.response.numFound+" samples in current view"),0===a.response.numFound)return b&&assetLayerGroup.clearLayers(),null!==rectHighlight&&map.removeLayer(rectHighlight),rectHighlight=null,void map.spin(!1);var d,f,g,h,i=a.stats.stats_fields,j=a.facet_counts,k=$("#view-mode").val();switch(c){case 1:case 2:d=i.geo_coords_ll_0_coordinate.facets.geohash_1,f=i.geo_coords_ll_1_coordinate.facets.geohash_1,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_1:null,g=j.facet_pivot["geohash_1,species_category"];break;case 3:case 4:case 5:d=i.geo_coords_ll_0_coordinate.facets.geohash_2,f=i.geo_coords_ll_1_coordinate.facets.geohash_2,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_2:null,g=j.facet_pivot["geohash_2,species_category"];break;case 6:case 7:d=i.geo_coords_ll_0_coordinate.facets.geohash_3,f=i.geo_coords_ll_1_coordinate.facets.geohash_3,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_3:null,g=j.facet_pivot["geohash_3,species_category"];break;case 8:case 9:d=i.geo_coords_ll_0_coordinate.facets.geohash_4,f=i.geo_coords_ll_1_coordinate.facets.geohash_4,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_4:null,g=j.facet_pivot["geohash_4,species_category"];break;case 10:case 11:d=i.geo_coords_ll_0_coordinate.facets.geohash_5,f=i.geo_coords_ll_1_coordinate.facets.geohash_5,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_5:null,g=j.facet_pivot["geohash_5,species_category"];break;case 12:case 13:case 14:d=i.geo_coords_ll_0_coordinate.facets.geohash_6,f=i.geo_coords_ll_1_coordinate.facets.geohash_6,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_6:null,g=j.facet_pivot["geohash_6,species_category"];break;default:d=i.geo_coords_ll_0_coordinate.facets.geohash_7,f=i.geo_coords_ll_1_coordinate.facets.geohash_7,h="ir"===k?i.phenotype_rescaled_value_f.facets.geohash_7:null,
g=j.facet_pivot["geohash_7,species_category"]}smallClusters=[];var l=[],m=[],n=[];for(var o in d)if(d.hasOwnProperty(o)){d[o].count;g.forEach(function(a,b){l[a.value]=a.count;var c=[],d=[];a.pivot?a.pivot.forEach(function(a){var b=a.value,e=a.count;c[b]=e,d.push({label:b.replace(/sensu lato/,"sl").replace(/chromosomal form/,"cf"),value:e,color:palette[b]?palette[b]:"#000000"})}):console.log("ERROR: Pivot for element "+a.value+"appears to be empty"),m[a.value]=c,n[a.value]=d});var p={};p.term=o,p.count=d[o].count,p.latLng=[d[o].mean,f[o].mean],p.bounds=[[d[o].min,f[o].min],[d[o].max,f[o].max]],p.population=l[o],p.trafficlight="ir"===k?h[o].mean:-1,p.stats=m[o],p.fullstats=n[o],e.push(p)}var q={};q.terms=e;var r={recordsField:"terms",latitudeField:"latLng.0",longitudeField:"latLng.1",displayOptions:{count:{title:function(a){return a}}},layerOptions:{fill:!1,stroke:!1,weight:0,color:"#80FF00",dropShadow:!1},setIcon:function(a){var b=40;return new L.Icon.Canvas({iconSize:new L.Point(b,b),className:"marker-cluster",population:a.population,trafficlight:a.trafficlight,stats:a.stats,id:a.term})},onEachRecord:function(a,b){a.on("dblclick",function(){clearTimeout(timer),prevent=!0,map.fitBounds(b.bounds)}).on("click",function(){var c=$(".sidebar-pane.active"),d=c.attr("id"),e=L.latLngBounds(b.bounds);if(highlightedId){switch($(".sidebar-pane").data("has-graph",!1),d){case"graphs":updatePieChart(b.population,b.fullstats),c.data("has-graph",!0);break;case"swarm-plots":createBeeViolinPlot("#swarm-chart-area",buildBbox(e)),c.data("has-graph",!0);break;case"marker-table":updateTable("#table-contents",buildBbox(e)),c.data("has-graph",!0)}return void(prevent=!1)}if(sidebarClick){switch(d){case"graphs":c.data("has-graph")||(updatePieChart(b.population,b.fullstats),c.data("has-graph",!0));break;case"swarm-plots":c.data("has-graph")||(createBeeViolinPlot("#swarm-chart-area",buildBbox(e)),c.data("has-graph",!0));break;case"marker-table":c.data("has-graph")||(updateTable("#table-contents",buildBbox(e)),c.data("has-graph",!0))}return void(prevent=!1)}var f=!1;a._icon===highlight&&(f=!0),removeHighlight(a._icon),highlightMarker(a._icon),timer=setTimeout(function(){if(!prevent){if(f)return removeHighlight(),sidebar.close(),void setTimeout(function(){resetPlots()},delay);switch($("#sidebar").hasClass("collapsed")&&("help"===$(".sidebar-pane.active").attr("id")?sidebar.open("graphs"):($("#swarm-chart-area").empty(),$("#table-contents").empty(),sidebar.open(d))),$(".sidebar-pane").data("has-graph",!1),d){case"graphs":updatePieChart(b.population,b.fullstats),c.data("has-graph",!0);break;case"swarm-plots":createBeeViolinPlot("#swarm-chart-area",buildBbox(e)),c.data("has-graph",!0);break;case"marker-table":updateTable("#table-contents",buildBbox(e)),c.data("has-graph",!0)}}},delay),prevent=!1}).on("mouseover",function(){moveTopMarker(a);var c=L.latLngBounds(b.bounds);null!==rectHighlight&&map.removeLayer(rectHighlight),rectHighlight=L.rectangle(c,{color:"grey",weight:1,fill:!0,clickable:!1}).addTo(map)}).on("mouseout",function(){removeTopMarker(a),null!==rectHighlight&&map.removeLayer(rectHighlight),rectHighlight=null})}},s=new L.MarkerDataLayer(q,r);b?(assetLayerGroup.clearLayers(),assetLayerGroup.addLayer(s)):assetLayerGroup.addLayer(s),null!==rectHighlight&&map.removeLayer(rectHighlight),rectHighlight=null,map.spin(!1)},g=solrPopbioUrl+$("#view-mode").val()+"Geoclust?"+qryUrl+buildBbox(map.getBounds())+"&stats.facet="+d+"&facet.pivot="+d+",species_category&json.wrf=?&callback=?";map.spin(!0),$.getJSON(g,f).done(function(){$(document).trigger("jsonLoaded")}).fail(function(){console.log("Ahhh"),map.spin(!1)})}function checkSeasonal(){for(var a=$("#search_ac").tagsinput("items"),b=0;b<a.length;b++){var c=a[b];if("Seasonal"===c.type)return c.value}return!1}function buildBbox(a){"use strict";var b;if(a.getEast()){var c=a.getSouth();-90>c&&(c=-90);var d=a.getNorth();d>90&&(d=90);var e=a.getWest();-180>e&&(e=-180),e>180&&(e=180);var f=a.getEast();f>180&&(f=180),-180>f&&(f=-180),b="&fq=geo_coords:["+c+","+e+" TO "+d+","+f+"]"}else b="&fq=geo_coords:[-90,-180 TO 90, 180]";return b}function geohashLevel(a,b){var c;if("geohash"===b)switch(a){case 1:case 2:c="geohash_1";break;case 3:case 4:case 5:c="geohash_2";break;case 6:case 7:c="geohash_3";break;case 8:case 9:c="geohash_4";break;case 10:case 11:c="geohash_5";break;case 12:case 13:case 14:c="geohash_6";break;default:c="geohash_7"}return c}function updatePieChart(a,b){b&&($("#pie-chart-header").empty(),d3.select("#pie-chart-area svg").attr("width","380px").attr("height","500px").style({width:"380px",height:"500px"}),nv.addGraph(function(){var a=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).color(function(a){return a.data.color}).showLabels(!0).labelThreshold(.05).labelType("percent").donut(!0).donutRatio(.5).growOnHover(!1);return d3.select("#pie-chart-area svg").datum(b).transition().duration(800).call(a),nv.utils.windowResize(a.update),a}))}function updateTable(a,b,c){"use strict";var d=a+"-header";if($(d).empty(),"smpl"===$("#view-mode").val())var e=solrPopbioUrl+"smplTable?&"+qryUrl+b+"&sort=id asc&json.wrf=?&callback=?";else var e=solrPopbioUrl+"irTable?&"+qryUrl+b+"&sort=id asc&json.wrf=?&callback=?";var f,g=e+"&cursorMark=*",h="*";PaneSpin("marker-table","start");$(".marker-row").fadeOut(),$("#marker-table").infiniteScrollHelper("destroy"),$.getJSON(g).done(function(b){if(b.response.numFound&&b.response.numFound>0){var c=b.response.docs;f=b.nextCursorMark,g=e+"&cursorMark="+f,setTimeout(function(){$(a).empty(),tableHtml(a,c),PaneSpin("marker-table","stop")},delay)}setTimeout(function(){$("#marker-table").infiniteScrollHelper({bottomBuffer:80,loadMore:function(b,c){PaneSpin("marker-table","start"),$.getJSON(g).done(function(b){if(b.response.numFound&&b.response.numFound>0){var d=b.response.docs;h=f,f=b.nextCursorMark,g=e+"&cursorMark="+f,tableHtml(a,d),PaneSpin("marker-table","stop")}c()}).fail(function(){PaneSpin("marker-table","stop"),console.log("Failed while loading smplTable"),c()})}})},delay)}).fail(function(){PaneSpin("marker-table","stop"),console.log("Failed while loading smplTable")})}function tableHtml(a,b){b.forEach(function(b){var c,d=b.collection_date_range;if(d&&d.length>0){var e=d[0];if(/TO/.test(e)){var f=/\[(\S+)\sTO\s(\S+)\]/,g=f.exec(e),h=g[1],i=g[2];c=dateResolution(h)+" to "+dateResolution(i)}else if(/^\d{4}$/.test(e))c=dateResolution(e);else{var j=new Date(e);c=j.toDateString()}}var k=b.species_category?b.species_category[0]:"Unknown";if("smpl"===$("#view-mode").val())var l={accession:b.accession,accessionType:"Stable ID",bundleName:b.bundle_name,url:b.url,sampleType:b.sample_type,sampleTypeType:"Sample type",geoCoords:b.geo_coords,geolocation:b.geolocations[0],geolocationType:"Geography",species:k,speciesType:"Taxonomy",bgColor:palette[k],textColor:getContrastYIQ(palette[k]),collectionDate:c,projects:b.projects,projectsType:"Projects",collectionProtocols:b.collection_protocols,collectionProtocolsType:"Collection protocols"},m=$.templates("#smplRowTemplate");else var l={accession:b.accession,accessionType:"Stable ID",bundleName:b.bundle_name,url:b.url,sampleType:b.sample_type,sampleTypeType:"Sample type",geoCoords:b.geo_coords,geolocation:b.geolocations[0],geolocationType:"Geography",species:k,speciesType:"Taxonomy",bgColor:palette[k],textColor:getContrastYIQ(palette[k]),collectionDate:c,projects:b.projects,projectsType:"Projects",collectionProtocols:b.collection_protocols,collectionProtocolsType:"Collection protocols",protocols:b.protocols,protocolsType:"Protocols",phenotypeValue:b.phenotype_value_f,phenotypeValueType:b.phenotype_value_type_s,phenotypeValueUnit:b.phenotype_value_unit_s,insecticide:b.insecticide_s,insecticideType:"Insecticides",sampleSize:b.sample_size_i,concentration:b.concentration_f,concentrationUnit:b.concentration_unit_s,duration:b.duration_f,durationUnit:b.duration_unit_s},m=$.templates("#irRowTemplate");var n=m.render(l);$(a).append(n),$(".marker-row").fadeIn()})}function filterMarkers(a){"use strict";if(0===a.length)return qryUrl="q=*",void loadSolr({clear:1,zoomLevel:map.getZoom()});var b={};a.forEach(function(a){if(b.hasOwnProperty(a.type)||(b[a.type]=[]),"Date"===a.type){var c="YYYY-MM-DD",d=dateConvert(a.dateEnd,c),e=dateConvert(a.dateStart,c);return void b[a.type].push({field:a.field,value:"["+e+" TO "+d+"]"})}if("Seasonal"!==a.type)return"Norm-IR"===a.type?void b[a.type].push({field:a.field,value:"["+a.normIrValues+"]"}):void("exact"==a.qtype?b[a.type].push({field:a.field,value:'"'+a.value+'"'}):b[a.type].push({field:a.field,value:"*"+a.value+"*"}));for(var f=0;f<a.ranges.length;f++){var g=a.ranges[f];b[a.type].push({field:a.field,value:"["+g+"]"})}});var c=0;qryUrl="q=(";var d=Object.keys(b).length;for(var e in b){var f={},g=0,h=b[e];h.sort(function(a,b){return a.field<b.field?-1:a.field>b.field?1:0}).forEach(function(a,b){f[a.field]?f[a.field]+=" OR "+a.value:f[a.field]=a.value});var i=Object.keys(f).length;if(d-1>c)if(i-1>g)if("Anywhere"===e)qryUrl+="("+f.anywhere+") AND ";else{qryUrl+="(";for(var j in f)qryUrl+=j+":("+f[j]+")",g!==i-1?(qryUrl+=" OR ",g++):qryUrl+=") AND "}else if("Anywhere"===e)qryUrl+="("+f.anywhere+") AND ";else for(var j in f)qryUrl+=j+":("+f[j]+")",g!==i-1?(qryUrl+=" OR ",g++):qryUrl+=" AND ";else{if(i-1>g)if("Anywhere"===e);else{qryUrl+="(";for(var j in f)qryUrl+=j+":("+f[j]+")",g!==i-1?(qryUrl+=" OR ",g++):qryUrl+="))"}else if("Anywhere"===e)qryUrl+="("+f.anywhere+"))";else for(var j in f)qryUrl+=j+":("+f[j]+"))";g++}c++}qryUrl=encodeURI(qryUrl),loadSolr({clear:1,zoomLevel:map.getZoom()})}function mapTypeToField(a){switch(a){case"Taxonomy":return"species_cvterms";case"Title":return"label";case"Sample type":return"sample_type";case"Geography":return"geolocations_cvterms";case"Collection protocols":return"collection_protocols_cvterms";case"Protocols":return"protocols_cvterms";case"Stable ID":return"id";case"Insecticides":return"insecticide_cvterms";case"Collection date":return"collection_date_range";case"Normalised IR":return"phenotype_rescaled_value_f";case"Projects":return"projects";default:return a.toLowerCase()}}function mapTypeToIcon(a){switch(a){case"Taxonomy":return"label label-primary fa fa-sitemap";case"Geography":return"label label-primary fa fa-map-marker";case"Title":return"label label-success fa fa-tag";case"Description":return"label label-success fa fa-info-circle";case"Projects":return"label label-success fa fa-database";case"Anywhere":return"label label-default fa fa-search";case"Pubmed references":return"label label-success fa fa-book";case"Insecticides":return"label label-success fa fa-eyedropper";case"Collection protocols":return"label label-success fa fa-shopping-cart";case"Date":return"label label-info fa fa-calendar";case"Seasonal":return"label label-info fa fa-calendar-check-o ";case"Norm-IR":return"label label-secondary fa fa-bolt";case"Stable ID":return"label label-warning fa fa-tag";case"Sample":return"label label-warning fa fa-map-pin";case"Sample type":return"label label-warning fa fa-file-o";case"Protocols":return"label label-warning fa fa-sort-amount-desc";default:return"label label-warning fa fa-search"}S}function PaneSpin(a,b){var c=document.getElementById(a);"start"===b?null==PaneSpinner?PaneSpinner=(new Spinner).spin(c):PaneSpinner.spin(c):PaneSpinner.stop(c)}function highlightMarker(a){$(a).addClass("highlight-marker"),$(a._icon).addClass("highlight-marker"),highlight=a,firstClick&&(firstClick=!1)}function moveTopMarker(a){$(a._icon).addClass("top-marker")}function removeTopMarker(a){$(a._icon).removeClass("top-marker")}function removeHighlight(a){null!==highlight&&($(highlight).removeClass("highlight-marker"),a?highlight=a:highlight=null)}function resetPlots(){"use strict";var a,b,c;firstClick?(a='<h3>Summary view for selected samples</h3><div id="pie-chart-header" style="text-align: center; margin-top: 30px"><i class="fa fa-pie-chart" style="color: #2c699e; font-size: 12em"></i><h1>Go on!</h1><h4>click a marker on the map</h4><h4>to plot some real data</h4> </div><div id="pie-chart-area"><svg></svg></div>',b='<div style="text-align: center; margin-top: 30px"><i class="fa fa-area-chart" style="color: #2c699e; font-size: 12em"></i><h1>Go on!</h1><h4>click a marker on the map</h4><h4>to plot some real data</h4> </div>',c='<div style="text-align: center; margin-top: 30px"><i class="fa fa-table" style="color: #2c699e; font-size: 12em"></i><h1>Go on!</h1><h4>click a marker on the map</h4><h4>to see some real data</h4> </div>'):(a='<h3>Summary view for selected samples</h3><div id="pie-chart-header" style="text-align: center; margin-top: 30px"><i class="fa fa-pie-chart" style="color: #2c699e; font-size: 12em"></i><h4>click a marker on the map</h4></div><div id="pie-chart-area"><svg></svg></div>',b='<div style="text-align: center; margin-top: 30px"><i class="fa fa-area-chart" style="color: #2c699e; font-size: 12em"></i><h4>click a marker on the map</h4></div>',c='<div style="text-align: center; margin-top: 30px"><i class="fa fa-table" style="color: #2c699e; font-size: 12em"></i><h4>click a marker on the map</h4></div>'),$("#graphs").html(a),$("#swarm-chart-area").html(b),$("#marker-table").off("scroll"),$("#table-contents-header").html(c),$("#table-contents").empty()}function markerColor(a){var b,c;return 0>a?["white","#555"]:(b=trafficLight.evaluate(a),c=.3>a?"#fff":a>.7?"#fff":"#555",[b,c])}function getContrastYIQ(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"}function constructSeasonal(a){for(var b,c,d="YYYY-MM",e="MMM",f=[],g=[],h=!1,i=new Date(1600,0,1),j=new Date(1600,0,1),k=1;13>k;k++){var l=a[k];l?(h?j.setMonth(k-1):(i.setMonth(k-1),j.setMonth(k-1),h=!0),12===k&&(b=dateConvert(i,d)+" TO "+dateConvert(j,d),f.push(b),c=i.getTime()===j.getTime()?dateConvert(i,e):dateConvert(i,e)+"-"+dateConvert(j,e),g.push(c),h=!1)):h&&(b=dateConvert(i,d)+" TO "+dateConvert(j,d),f.push(b),c=i.getTime()===j.getTime()?dateConvert(i,e):dateConvert(i,e)+"-"+dateConvert(j,e),g.push(c),h=!1)}return{ranges:f,rangesText:g}}function constructIrNorm(a,b){return{}}function dateResolution(a){var b=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/g,c=b.exec(a),d=c[1],e=c[5],f=c[7],g=new Date(a);if("undefined"!=typeof f)return g.toDateString();if("undefined"!=typeof e){var h="MMM YYYY";return dateConvert(g,h)}if("undefined"!=typeof d){var h="YYYY";return dateConvert(g,h)}return!1}function setDateRange(a,b,c){var d=new Date,e=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()));d.setUTCFullYear(d.getUTCFullYear()-c);var f=new Date(Date.UTC(d.getUTCFullYear(),0,1));$(a).datepicker("setUTCDate",f),$(b).datepicker("setUTCDate",e)}function dateConvert(a,b){var c=a.getFullYear(),d=("0"+(a.getMonth()+1)).slice(-2),e=("0"+a.getDate()).slice(-2),f=(("0"+a.getHours()).slice(-2),("0"+a.getMinutes()).slice(-2),("0"+a.getSeconds()).slice(-2),a.getDay()),g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i="";switch(b){case"YYYY-MM-DD":i=c+"-"+d+"-"+e;break;case"YYYY-MM":i=c+"-"+d;break;case"MMM YYYY":i=g[parseInt(d)-1]+" "+c;break;case"YYYY-MMM-DD DDD":i=c+"-"+g[parseInt(d)-1]+"-"+e+" "+h[parseInt(f)];break;case"MMM":i=g[parseInt(d)-1];break;case"YYYY":i=c}return i}function addGeohashes(a,b){function c(a,b){i.terms.push({term:a})}var d=a.getBounds(),e=d.getSouth(),f=d.getNorth(),g=d.getEast(),h=d.getWest();geohashesGrid&&a.removeLayer(geohashesGrid);var i={_type:"terms",terms:[]},j=geohash.bboxes(e,h,f,g,b);j.forEach(c);var k={recordsField:"terms",geohashField:"term",layerOptions:{fill:!1,clickable:!1,fillOpacity:0,opacity:.3,weight:1}};geohashesGrid=new L.GeohashDataLayer(i,k),a.addLayer(geohashesGrid)}L.LinearFunction=L.Class.extend({options:{constrainX:!1},initialize:function(a,b,c){this.setOptions(c),this.setRange(a,b)},_calculateParameters:function(a,b){0===this._xRange?(this._slope=0,this._b=a.y):(this._slope=(b.y-a.y)/this._xRange,this._b=a.y-this._slope*a.x)},_arrayToPoint:function(a){return{x:a[0],y:a[1]}},setOptions:function(a){L.Util.setOptions(this,a),this._preProcess=this.options.preProcess,this._postProcess=this.options.postProcess},getBounds:function(){var a=Math.min(this._minPoint.x,this._maxPoint.x),b=Math.max(this._minPoint.x,this._maxPoint.x),c=Math.min(this._minPoint.y,this._maxPoint.y),d=Math.max(this._minPoint.y,this._maxPoint.y);return[new L.Point(a,c),new L.Point(b,d)]},setRange:function(a,b){return a=a instanceof Array?this._arrayToPoint(a):a,b=b instanceof Array?this._arrayToPoint(b):b,this._minPoint=a,this._maxPoint=b,this._xRange=b.x-a.x,this._calculateParameters(a,b),this},setMin:function(a){return this.setRange(a,this._maxPoint),this},setMax:function(a){return this.setRange(this._minPoint,a),this},setPreProcess:function(a){return this._preProcess=a,this},setPostProcess:function(a){return this._postProcess=a,this},constrainX:function(a){return a=Number(a),this.options.constrainX&&(a=Math.max(a,this._minPoint.x),a=Math.min(a,this._maxPoint.x)),a},evaluate:function(a){var b;return this._preProcess&&(a=this._preProcess(a)),b=Number((this._slope*a).toFixed(6))+Number(this._b.toFixed(6)),this._postProcess&&(b=this._postProcess(b)),b},random:function(){var a=Math.random()*this._xRange+this._minPoint.x;return this.evaluate(a)},sample:function(a){a=Math.max(a,2);for(var b=a-1,c=this._xRange/b,d=this._minPoint.x,e=[];d<=this._maxPoint.x;)e.push(this.evaluate(d)),d+=c;return e},samplePoints:function(a){a=Math.max(a,2);for(var b=a-1,c=this._xRange/b,d=this._minPoint.x,e=[];d<=this._maxPoint.x;)e.push(new L.Point(d,this.evaluate(d))),d+=c;return e},getIntersectionPoint:function(a){var b=null;if(this._slope!==a._slope){var c=(this._b-a._b)/(a._slope-this._slope),d=this.evaluate(c);b=new L.Point(c,d)}return b}}),L.ColorFunction=L.LinearFunction.extend({options:{alpha:1,includeAlpha:!1},initialize:function(a,b,c){L.Util.setOptions(this,c),this._parts=[],this._dynamicPart=null,this._outputPrecision=0,this._prefix=null,this._formatOutput=function(a){return a.toFixed(this._outputPrecision)},this._mapOutput=function(a){for(var b=[],c=0;c<this._parts.length;++c){var d=this._parts[c];b.push(a[d])}return this.options.includeAlpha&&b.push(this.options.alpha),b},this._getColorString=function(a){a=this._formatOutput(a),this.options[this._dynamicPart]=a;var b=this._mapOutput(this.options);return this._writeColor(this._prefix,b)},this._writeColor=function(a,b){return this.options.includeAlpha&&(a+="a"),a+"("+b.join(",")+")"},c=this.options;var d=function(a){c&&c.postProcess&&(a=c.postProcess.call(this,a));var b=this._getColorString(a);return(L.Browser.ie&&b.indexOf("hsl")>-1||c.rgb)&&(b=L.hslColor(b).toRGBString()),b};L.LinearFunction.prototype.initialize.call(this,a,b,{preProcess:this.options.preProcess,postProcess:d})}}),L.HSLColorFunction=L.ColorFunction.extend({initialize:function(a,b,c){L.ColorFunction.prototype.initialize.call(this,a,b,c),this._parts=["outputHue","outputSaturation","outputLuminosity"],this._prefix="hsl",this._outputPrecision=2}}),L.RGBColorFunction=L.ColorFunction.extend({initialize:function(a,b,c){L.ColorFunction.prototype.initialize.call(this,a,b,c),this._parts=["outputRed","outputBlue","outputGreen"],this._prefix="rgb",this._outputPrecision=0}}),L.RGBRedFunction=L.LinearFunction.extend({options:{outputGreen:0,outputBlue:0},initialize:function(a,b,c){L.RGBColorFunction.prototype.initialize.call(this,a,b,c),this._dynamicPart="outputRed"}}),L.RGBBlueFunction=L.LinearFunction.extend({options:{outputRed:0,outputGreen:0},initialize:function(a,b,c){L.RGBColorFunction.prototype.initialize.call(this,a,b,c),this._dynamicPart="outputBlue"}}),L.RGBGreenFunction=L.LinearFunction.extend({options:{outputRed:0,outputBlue:0},initialize:function(a,b,c){L.RGBColorFunction.prototype.initialize.call(this,a,b,c),this._dynamicPart="outputGreen"}}),L.RGBColorBlendFunction=L.LinearFunction.extend({initialize:function(a,b,c,d){c=new L.RGBColor(c),d=new L.RGBColor(d);var e=c.r(),f=d.r(),g=c.g(),h=d.g(),i=c.b(),j=d.b();this._minX=a,this._maxX=b,this._redFunction=new L.LinearFunction(new L.Point(a,e),new L.Point(b,f)),this._greenFunction=new L.LinearFunction(new L.Point(a,g),new L.Point(b,h)),this._blueFunction=new L.LinearFunction(new L.Point(a,i),new L.Point(b,j))},getBounds:function(){var a=this._redFunction.getBounds(),b=this._greenFunction.getBounds(),c=this._blueFunction.getBounds(),d=Math.min(a[0].y,b[0].y,c[0].y),e=Math.max(a[0].y,b[0].y,c[0].y);return[new L.Point(a[0].x,d),new L.Point(a[1].x,e)]},evaluate:function(a){return new L.RGBColor([this._redFunction.evaluate(a),this._greenFunction.evaluate(a),this._blueFunction.evaluate(a)]).toRGBString()}}),L.HSLHueFunction=L.HSLColorFunction.extend({options:{outputSaturation:"100%",outputLuminosity:"50%"},initialize:function(a,b,c){L.HSLColorFunction.prototype.initialize.call(this,a,b,c),this._dynamicPart="outputHue"}}),L.HSLSaturationFunction=L.LinearFunction.extend({options:{outputHue:0,outputLuminosity:"50%"},initialize:function(a,b,c){L.HSLColorFunction.prototype.initialize.call(this,a,b,c),this._formatOutput=function(a){return(100*a).toFixed(this._outputPrecision)+"%"},this._dynamicPart="outputSaturation"}}),L.HSLLuminosityFunction=L.LinearFunction.extend({options:{outputHue:0,outputSaturation:"100%"},initialize:function(a,b,c){L.HSLColorFunction.prototype.initialize.call(this,a,b,c),this._formatOutput=function(a){return(100*a).toFixed(this._outputPrecision)+"%"},this._dynamicPart="outputLuminosity"}}),L.HSLColorBlendFunction=L.LinearFunction.extend({initialize:function(a,b,c,d){c=new L.HSLColor(c),d=new L.HSLColor(d);var e=c.h(),f=d.h(),g=c.s(),h=d.s(),i=c.l(),j=d.l();this._minX=a,this._maxX=b,this._hueFunction=new L.LinearFunction(new L.Point(a,e),new L.Point(b,f)),this._saturationFunction=new L.LinearFunction(new L.Point(a,g),new L.Point(b,h)),this._luminosityFunction=new L.LinearFunction(new L.Point(a,i),new L.Point(b,j))},getBounds:function(){var a=this._hueFunction.getBounds(),b=this._saturationFunction.getBounds(),c=this._luminosityFunction.getBounds(),d=Math.min(a[0].y,b[0].y,c[0].y),e=Math.max(a[0].y,b[0].y,c[0].y);return[new L.Point(a[0].x,d),new L.Point(a[1].x,e)]},evaluate:function(a){return new L.HSLColor([this._hueFunction.evaluate(a),this._saturationFunction.evaluate(a),this._luminosityFunction.evaluate(a)]).toHSLString()}}),L.PiecewiseFunction=L.LinearFunction.extend({options:{constrainX:!0},initialize:function(a,b){L.Util.setOptions(this,b),this._functions=a;var c,d;c=a[0].getBounds()[0],d=a[a.length-1].getBounds()[1],L.LinearFunction.prototype.initialize.call(this,c,d,{preProcess:this.options.preProcess,postProcess:this.options.postProcess})},_getFunction:function(a){var b,c,d,e;if(a<this._minPoint.x)e=this._functions[0];else if(a>=this._maxPoint.x)e=this._functions[this._functions.length-1];else for(var f=0;f<this._functions.length&&(e=this._functions[f],b=e.getBounds(),c=b[0],d=b[1],!(a>=c.x&&a<d.x));++f);return e},evaluate:function(a){var b,c=null;return a=this.constrainX(a),this._preProcess&&(a=this._preProcess(a)),b=this._getFunction(a),b&&(c=b.evaluate(a),this._postProcess&&(c=this._postProcess(c))),c}}),L.ColorClassFunction=L.PiecewiseFunction.extend({options:{interpolate:!1},initialize:function(a,b,c){var d,e=[];L.Util.setOptions(this,c);for(var f=0;f<a.length-1;++f){var g=a[f],h=a[f+1],i=b[f],j=this.options.interpolate?b[Math.min(b.length-1,f+1)]:b[f];d=new L.RGBColorBlendFunction(g,h,i,j),e.push(d)}L.PiecewiseFunction.prototype.initialize.call(this,e)}}),L.CustomColorFunction=L.PiecewiseFunction.extend({options:{interpolate:!0},initialize:function(a,b,c,d){L.Util.setOptions(this,d);for(var e,f,g=this.options.interpolate?c.length-1:c.length,h=[],i=new L.LinearFunction([0,a],[g,b]),j=0;g>j;++j)f=j+1,e=this.options.interpolate?new L.RGBColorBlendFunction(i.evaluate(j),i.evaluate(f),c[j],c[f]):new L.RGBColorBlendFunction(i.evaluate(j),i.evaluate(f),c[j],c[j]),h.push(e);i=null,L.PiecewiseFunction.prototype.initialize.call(this,h)}}),L.CategoryFunction=L.Class.extend({initialize:function(a,b){L.Util.setOptions(this,b),this._categoryKeys=Object.keys(a),this._categoryMap=a,this._preProcess=this.options.preProcess,this._postProcess=this.options.postProcess},evaluate:function(a){var b;return this._preProcess&&(a=this._preProcess(a)),b=this._categoryMap[a],this._postProcess&&(b=this._postProcess(b)),b},getCategories:function(){return this._categoryKeys}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){var f,g,h;if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");f=[];for(g in e)a.call(e,g)&&f.push(g);if(b)for(h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),L.Util.guid=function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},L.Util.getProperty=function(a,b,c){return b in a?a[b]:c},L.Util.setFieldValue=function(a,b,c){for(var d,e=b.split("."),f=a,g=0;g<e.length-1;++g)d=e[g],f[d]=f[d]||{},f=f[d];f[e[e.length-1]]=c},L.Util.getFieldValue=function(a,b){var c=null;if(b){for(var d,e,f,g,h,i,j,k=b.split("."),l=a,m=-1,n=0;n<k.length;++n)if(d=k[n],m=d.indexOf("["),m>-1){i=d.substring(m),d=d.substring(0,m),i=i.replace("[","").replace("]",""),e=i.split("="),f=e[0],g=e[1],l=l[d];for(var o=0;o<l.length;++o)h=l[o],j=h[f],j&&j===g&&(l=h)}else{if(!l||!l.hasOwnProperty(d)){l=null;break}l=l[d]}c=l}else c=a;return c},L.Util.getNumericRange=function(a,b){var c=Number.MAX_VALUE,d=Number.MIN_VALUE;for(var e in a)if(a.hasOwnProperty(e)){var f=a[e],g=L.Util.getFieldValue(f,b);c=Math.min(c,g),d=Math.max(d,g)}return[c,d]},L.Util.pointToGeoJSON=function(){var a={type:"Feature",geometry:{type:"Point",coordinates:[this._latlng[1],this._latlng[0]]},properties:{}};for(var b in this.options)if(this.options.hasOwnProperty(b)){var c=this.options[b];"function"!=typeof c&&(a.properties[b]=c)}return a},L.Util.updateLayer=function(a,b){a.eachLayer&&!a instanceof L.FeatureGroup?a.eachLayer(function(a){L.Util.updateLayer(a,b)}):b.call(this,a)},L.CategoryLegend=L.Class.extend({initialize:function(a){L.Util.setOptions(this,a)},generate:function(a){a=a||{};var b=document.createElement("div"),c=L.DomUtil.create("div","legend",b),d=a.className,e=this.options;d&&L.DomUtil.addClass(c,d),a.title&&(L.DomUtil.create("div","legend-title",c).innerHTML=a.title);for(var f in e){categoryOptions=e[f];var g=categoryOptions.displayName||f,h=L.DomUtil.create("div","data-layer-legend",c),i=L.DomUtil.create("div","legend-box",h);L.DomUtil.create("div","key",h).innerHTML=g,L.StyleConverter.applySVGStyle(i,categoryOptions)}return b.innerHTML}}),L.LegendIcon=L.DivIcon.extend({initialize:function(a,b,c){var d,e=document.createDocumentFragment(),f=document.createElement("div","",e),g=L.DomUtil.create("div","legend",f),h=L.DomUtil.create("div","title",g),i=L.DomUtil.create("div","legend-box",g),j=L.DomUtil.create("div","legend-values",g),k=b.title||b.name;k&&(h.innerHTML=k);for(var l in a)d=a[l],L.DomUtil.create("div","key",j).innerHTML=d.name||l,L.DomUtil.create("div","value",j).innerHTML=d.value;L.StyleConverter.applySVGStyle(i,b),i.style.height="5px",c.html=f.innerHTML,c.className=c.className||"legend-icon",L.DivIcon.prototype.initialize.call(this,c)}}),L.legendIcon=function(a,b,c){return new L.LegendIcon(a,b,c)},L.GeometryUtils={getName:function(a){var b=null;if(a&&a.features)for(var c=0;c<a.features.length;++c){var d=a.features[c];if(d.properties&&d.properties.name){b=d.properties.name;break}}return b},getGeoJSONLocation:function(a,b,c,d){var e=new L.GeoJSON(a,{pointToLayer:function(a,e){var f={location:e,text:c?L.Util.getFieldValue(b,c):[e.lat.toFixed(3),e.lng.toFixed(3)].join(", "),center:e};return d(f,b)}}),f=null;try{f=L.GeometryUtils.loadCentroid(a)}catch(g){console.log("Error loading centroid for "+JSON.stringify(a))}return{location:e,text:c?L.Util.getFieldValue(b,c):null,center:f}},mergeProperties:function(a,b,c){var d,e,f=b.features,g=L.GeometryUtils.indexFeatureCollection(f,c),h={type:"FeatureCollection",features:[]};for(var i in a)if(a.hasOwnProperty(i)&&(d=a[i],e=d[c])){var j=g[e];for(var k in d)j.properties[k]=d[k];h.features.push(j)}return h},indexFeatureCollection:function(a,b){for(var c,d,e,f=a.features,g={},h=0;h<f.length;++h)if(c=f[h],d=c.properties,e=d[b],e in g){var i=g[e];"GeometryCollection"!==i.geometry.type?g[e]={type:"Feature",geometry:{type:"GeometryCollection",geometries:[c.geometry,i.geometry]}}:i.geometry.geometries.push(c.geometry)}else g[e]=c;return g},arrayToMap:function(a,b,c){for(var d,e,f,g={},h=0;h<a.length;++h)d=a[h],e=d[b],f=c?d[c]:d,g[e]=f;return g},arrayToMaps:function(a,b){for(var c,d,e,f,g,h,i,j=[],k=0;k<b.length;++k)j.push({});for(var l=0;l<a.length;++l){d=a[l];for(var m=0;m<b.length;++m)c=j[m],g=b[m],h=g.from,i=g.to,e=d[h],f=i?d[i]:d,c[e]=f}return j},loadCentroid:function(a){var b,c,d,e=null;if(a.geometry&&"Point"===a.geometry.type)e=new L.LatLng(a.geometry.coordinates[1],a.geometry.coordinates[0]);else if("undefined"!=typeof jsts){var f=new jsts.io.GeoJSONParser,g=f.read(a);if(g.getCentroid)b=g.getCentroid(),c=b.coordinate.x,d=b.coordinate.y;else if(g.features){for(var h=0,i=0,j=0;j<g.features.length;++j)b=g.features[j].geometry.getCentroid(),h+=b.coordinate.x,i+=b.coordinate.y;c=h/g.features.length,d=i/g.features.length}else b=g.geometry.getCentroid(),c=b.coordinate.x,d=b.coordinate.y;e=new L.LatLng(d,c)}return e},loadCentroids:function(a){var b,c={};for(var d in a)b=a[d],c[d]=L.GeometryUtils.loadCentroid(b);return c}},L.SVGPathBuilder=L.Class.extend({initialize:function(a,b,c){this._points=a||[],this._innerPoints=b||[],L.Util.setOptions(this,c)},options:{closePath:!0},_getPathString:function(a,b){var c="";if(a.length>0){var d=a[0];b=null!==b?b:2;var e="M",f="L",g="Z";L.Browser.vml&&(b=0,e="m",f="l",g="xe"),c=e+d.x.toFixed(b)+","+d.y.toFixed(b);for(var h=1;h<a.length;h++)d=a[h],c+=f+d.x.toFixed(b)+","+d.y.toFixed(b);this.options.closePath&&(c+=g)}return c},addPoint:function(a,b){b?this._innerPoints.push(a):this._points.push(a)},build:function(a){a=a||this.options.digits;var b=this._getPathString(this._points,a);return this._innerPoints&&(b+=this._getPathString(this._innerPoints,a)),b}}),L.StyleConverter={keyMap:{fillColor:{property:["background-color"],valueFunction:function(a){return a}},color:{property:["color","border-top-color","border-right-color","border-bottom-color","border-left-color"],valueFunction:function(a){return a}},weight:{property:["border-width"],valueFunction:function(a){return Math.ceil(a)+"px"}},stroke:{property:["border-style"],valueFunction:function(a){return a===!0?"solid":"none"}},dashArray:{property:["border-style"],valueFunction:function(a){var b="solid";return a&&(b="dashed"),b}},barThickness:{property:["height"],valueFunction:function(a){return a+"px"}},radius:{property:["height"],valueFunction:function(a){return 2*a+"px"}},fillOpacity:{property:["opacity"],valueFunction:function(a){return a}}},applySVGStyle:function(a,b,c){var d=L.StyleConverter.keyMap;c&&(d=L.Util.extend(d,c)),a.style.borderStyle="solid";for(var e in b)L.StyleConverter.setCSSProperty(a,e,b[e],d);return a},setCSSProperty:function(a,b,c,d){d=d||L.StyleConverter.keyMap;var e=d[b],f="";if(e)for(var g=e.property,h=0,i=g.length;i>h;++h)f+=g[h]+":"+e.valueFunction(c)+";";return a.style.cssText+=f,
a}},L.StylesBuilder=L.Class.extend({initialize:function(a,b){this._categories=a,this._styleFunctionMap=b,this._buildStyles()},_buildStyles:function(){for(var a,b,c,d={},e=0;e<this._categories.length;++e){a=this._categories[e],d[a]={};for(var f in this._styleFunctionMap)b=this._styleFunctionMap[f],c=b.evaluate?b.evaluate(e):"function"==typeof b?b(e):b,d[a][f]=c}this._styleMap=d},getStyles:function(){return this._styleMap}}),L.PaletteBuilder=L.Class.extend({initialize:function(a){this._styleFunctionMap=a},generate:function(a){a=a||{};var b=document.createElement("div"),c=L.DomUtil.create("div","palette",b),d=a.count||10,e=function(a){for(var b=[],c=0;a>c;++c)b.push(c);return b}(d),f=new L.StylesBuilder(e,this._styleFunctionMap),g=f.getStyles();a.className&&L.DomUtil.addClass(c,a.className);for(var h in g){var i=L.DomUtil.create("i","palette-element",c),j=g[h];L.StyleConverter.applySVGStyle(i,j)}return b.innerHTML}}),L.HTMLUtils={buildTable:function(a,b,c){function d(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1}b=b||"table table-condensed table-striped table-bordered";for(var e=document.createDocumentFragment(),f=L.DomUtil.create("table",b,e),g=L.DomUtil.create("thead","",f),h=L.DomUtil.create("tbody","",f),i=L.DomUtil.create("tr","",g),j=["Name","Value"],k=0,l=j.length;l>k;k++){var m=L.DomUtil.create("th","",i);m.innerHTML=j[k]}c=c||[];for(var n in a)if(a.hasOwnProperty(n)&&!d(c,n)){var o=a[n];if("object"==typeof o){var p=document.createElement("div");p.appendChild(L.HTMLUtils.buildTable(o,c)),o=p.innerHTML}var q=L.DomUtil.create("tr","",h),r=[n,o];for(k=0,l=r.length;l>k;k++){var s=L.DomUtil.create("td","",q);s.innerHTML=r[k]}}return f}},L.AnimationUtils={animate:function(a,b,c,d){var e=d.delay||0,f=d.frames||30,g=d.duration||500,h={},i=d.easeFunction||function(a){return a},j=d.complete,k=g/f;for(var l in b)"color"!=l&&"fillColor"!=l&&c[l]?h[l]=new L.LinearFunction([0,b[l]],[f-1,c[l]]):"color"!=l&&"fillColor"!=l||(h[l]=new L.RGBColorBlendFunction(0,f-1,b[l],c[l]));var m={},n=0,o=function(){for(var b in h)m[b]=h[b].evaluate(n);a.options=L.extend({},a.options,m),a.setStyle(a.options).redraw(),n++,k=i(k),f>n?setTimeout(o,k):j()};setTimeout(o,e)}},L.Color=L.Class.extend({initialize:function(a){this._rgb=[0,0,0],this._hsl=[0,1,.5],this._a=1,a&&this.parseColorDef(a)},parseColorDef:function(a){},rgbToHSL:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return[d,e,h]},hslToRGB:function(a,b,c){var d,e,f,g=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a};if(0===b)d=e=f=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;d=g(i,h,a+1/3),e=g(i,h,a),f=g(i,h,a-1/3)}return[Math.floor(255*d),Math.floor(255*e),Math.floor(255*f)]},setRGB:function(a,b,c){return this._rgb=[a,b,c],this._hsl=this.rgbToHSL(a,b,c),this},setHSL:function(a,b,c){return this._hsl=[a,b,c],this._rgb=this.hslToRGB(a,b,c),this},toHSL:function(){return this._hsl},toHSLString:function(){var a="hsl";return this._a<1&&(a+="a"),a+"("+(360*this._hsl[0]).toFixed(1)+","+(100*this._hsl[1]).toFixed(0)+"%,"+(100*this._hsl[2]).toFixed(0)+"%)"},toRGB:function(){return this._rgb},toRGBString:function(){var a;if(this._a<1)a="rgba("+this._rgb[0].toFixed(0)+","+this._rgb[1].toFixed(0)+","+this._rgb[2].toFixed(0)+","+this._a.toFixed(1)+")";else{for(var b=[this._rgb[0].toString(16),this._rgb[1].toString(16),this._rgb[2].toString(16)],c=0;c<b.length;++c)1===b[c].length&&(b[c]="0"+b[c]);a="#"+b.join("")}return a},r:function(a){return arguments.length?this.setRGB(a,this._rgb[1],this._rgb[2]):this._rgb[0]},g:function(a){return arguments.length?this.setRGB(this._rgb[0],a,this._rgb[2]):this._rgb[1]},b:function(a){return arguments.length?this.setRGB(this._rgb[0],this._rgb[1],a):this._rgb[2]},h:function(a){return arguments.length?this.setHSL(a,this._hsl[1],this._hsl[2]):this._hsl[0]},s:function(a){return arguments.length?this.setHSL(this._hsl[0],a,this._hsl[2]):this._hsl[1]},l:function(a){return arguments.length?this.setHSL(this._hsl[0],this._hsl[1],a):this._hsl[2]},a:function(a){return arguments.length?(this._a=a,this):this._a}}),L.RGBColor=L.Color.extend({initialize:function(a){L.Color.prototype.initialize.call(this,a)},parseColorDef:function(a){var b,c,d,e,f=a instanceof Array,g=0===a.indexOf("#"),h=[];f?(b=Math.floor(a[0]),c=Math.floor(a[1]),d=Math.floor(a[2]),e=4===a.length?a[3]:1):g?(a=a.replace("#",""),b=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16),e=8===a.length?parseInt(a.substring(6,8),16):1):(h=a.replace("rgb","").replace("a","").replace(/\s+/g,"").replace("(","").replace(")","").split(","),b=parseInt(h[0]),c=parseInt(h[1]),d=parseInt(h[2]),e=4===h.length?parseInt(h[3]):1),this.setRGB(b,c,d),this._a=e}}),L.rgbColor=function(a){return new L.RGBColor(a)},L.HSLColor=L.Color.extend({initialize:function(a){L.Color.prototype.initialize.call(this,a)},parseColorDef:function(a){var b,c,d,e,f=a instanceof Array;if(f)b=a[0],c=a[1],d=a[2],e=4===a.length?a[3]:1;else{var g=a.replace("hsl","").replace("a","").replace("(","").replace(/\s+/g,"").replace(/%/g,"").replace(")","").split(",");b=Number(g[0])/360,c=Number(g[1])/100,d=Number(g[2])/100,e=4===g.length?parseInt(g[3]):1}this.setHSL(b,c,d),this._a=e}}),L.hslColor=function(a){return new L.HSLColor(a)},L.Animation=L.Class.extend({initialize:function(a,b){this._easeFunction=a,this._animateFrame=b},run:function(a,b){this.stop(),this._el=a,this._inProgress=!0,this._duration=b.duration||.25,this._animationOptions=b,this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,b=1e3*this._duration;b>a?this._runFrame(this._easeFunction(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){this._animateFrame(a),this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")}}),L.ColorBrewer={Sequential:{YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]}},Diverging:{PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]}},Qualitative:{Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}}},L.Palettes={huePalette:function(a,b,c,d,e){return new L.HSLHueFunction(new L.Point(a,c),new L.Point(b,d),e)},luminosityPalette:function(a,b,c,d,e){return new L.HSLLuminosityFunction(new L.Point(a,c),new L.Point(b,d),e)},saturationPalette:function(a,b,c,d,e){return new L.HSLSaturationFunction(new L.Point(a,c),new L.Point(b,d),e)},rgbBlendPalette:function(a,b,c,d,e){return new L.RGBColorBlendFunction(a,b,c,d,e)},hslBlendPalette:function(a,b,c,d,e){return new L.HSLColorBlendFunction(a,b,c,d,e)},customColorPalette:function(a,b,c,d){return new L.CustomColorFunction(a,b,c,d)}},L.DynamicColorPalettes={rainbow:{text:"Rainbow",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,0,300,c)}},greentored:{text:"Green - Red",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,120,0,c)}},yellowtored:{text:"Yellow - Red",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,60,0,c)}},orangetored:{text:"Orange - Red",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,30,0,c)}},redtopurple:{text:"Red - Purple",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,360,270,c)}},bluetored:{text:"Blue - Red",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,210,360,c)}},bluetored2:{text:"Blue - Red 2",getPalette:function(a,b,c){return L.Palettes.huePalette(a,b,180,0,c)}},whitetored:{text:"White - Red",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:0}))}},whitetoorange:{text:"White - Orange",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:30}))}},whitetoyellow:{text:"White - Yellow",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:60}))}},whitetogreen:{text:"White - Green",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:120}))}},whitetoltblue:{text:"White - Lt. Blue",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:180}))}},whitetoblue:{text:"White - Blue",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:240}))}},whitetopurple:{text:"White - Purple",getPalette:function(a,b,c){return L.Palettes.luminosityPalette(a,b,1,.5,L.Util.extend(option,{outputHue:270}))}},graytored:{text:"Gray - Red",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:0}))}},graytoorange:{text:"Gray - Orange",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:30}))}},graytoyellow:{text:"Gray - Yellow",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:60}))}},graytogreen:{text:"Gray - Green",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:120}))}},graytoltblue:{text:"Gray - Lt. Blue",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:180}))}},graytoblue:{text:"Gray - Blue",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:240}))}},graytopurple:{text:"Gray - Purple",getPalette:function(a,b,c){return L.Palettes.saturationPalette(a,b,0,1,L.Util.extend(option,{outputHue:270}))}}},L.DynamicPaletteElement=L.Class.extend({initialize:function(a,b){this._key=a,this._dynamicPalette=b},generate:function(a){var b=L.DomUtil.create("div","palette"),c=a.count,d=this._dynamicPalette.getPalette(0,c-1),e=a.width,f=!0;a.showText&&(f=a.showText),b.setAttribute("data-palette-key",this._key),this._dynamicPalette.text&&f&&(L.DomUtil.create("div","palette-text",b).innerHTML='<i class="icon-ok hidden"></i>'+this._dynamicPalette.text);var g=e/c;a.className&&L.DomUtil.addClass(b,a.className);for(var h=0;c>h;++h){var i=L.DomUtil.create("i","palette-element");for(var j in d){var k=d[j],l=k.evaluate?k.evaluate(h):k;L.StyleConverter.setCSSProperty(i,j,l)}i.style.width=g+"px",b.appendChild(i)}return b}}),L.RegularPolygon=L.Polygon.extend({statics:{R:6378.137,M_PER_KM:1e3},initialize:function(a,b){this._centerLatLng=a,L.Util.setOptions(this,b),L.Polygon.prototype.initialize.call(this,this._getLatLngs(),b)},options:{fill:!0,radius:1e3,numberOfSides:4,rotation:0,maxDegrees:360},getLatLng:function(){return this._centerLatLng},setRadius:function(a){this.options.radius=a,this._latlngs=this._getLatLngs(),this.redraw()},_getLatLngs:function(){for(var a,b=this.options.maxDegrees||360,c=b/Math.max(this.options.numberOfSides,3),d=b+this.options.rotation,e=this.options.rotation,f=[];d>e;)a=this._getPoint(e),f.push(a),e+=c;return f},_getPoint:function(a){var b=function(a){return a*L.LatLng.DEG_TO_RAD},c=function(a){return a*L.LatLng.RAD_TO_DEG},d=b(a),e=this.options.radius/L.RegularPolygon.M_PER_KM/L.RegularPolygon.R,f=b(this._centerLatLng.lat),g=b(this._centerLatLng.lng),h=Math.asin(Math.sin(f)*Math.cos(e)+Math.cos(f)*Math.sin(e)*Math.cos(d)),i=g+Math.atan2(Math.sin(d)*Math.sin(e)*Math.cos(f),Math.cos(e)-Math.sin(f)*Math.sin(h));return h=c(h),i=c(i),new L.LatLng(h,i)},toGeoJSON:function(){for(var a={type:"Feature",geometry:{type:"Polygon",coordinates:[[],[]]},properties:this.options},b=0;b<this._latlngs.length;++b){var c=this._latlngs[b];a.geometry.coordinates[0].push([c.lng,c.lat])}return a}}),L.regularPolygon=function(a,b){return new L.RegularPolygon(a,b)},L.Path.XLINK_NS="http://www.w3.org/1999/xlink";var TextFunctions=TextFunctions||{__updatePath:L.Path.prototype._updatePath,_updatePath:function(){this.__updatePath.call(this),this.options.text&&this._createText(this.options.text)},_initText:function(){this.options.text&&this._createText(this.options.text)},getTextAnchor:function(){return this._point?this._point:void 0},setTextAnchor:function(a){this._text&&(this._text.setAttribute("x",a.x),this._text.setAttribute("y",a.y))},_createText:function(a){this._text&&this._container.removeChild(this._text),this._pathDef&&this._defs.removeChild(this._pathDef);var b=function(a,b){var c="";for(var d in b)c+=d+": "+b[d]+";";return a.setAttribute("style",c),a},c=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a};this._text=this._createElement("text");var d=document.createTextNode(a.text);if(a.path){var e=a.path,f=L.Util.guid(),g=this._createElement("path");g.setAttribute("d",this._path.getAttribute("d")),g.setAttribute("id",f),this._defs||(this._defs=this._createElement("defs"),this._container.appendChild(this._defs)),this._defs.appendChild(g),this._pathDef=g;var h=this._createElement("textPath");e.startOffset&&h.setAttribute("startOffset",e.startOffset),e.attr&&c(h,e.attr),e.style&&b(h,e.style),h.setAttributeNS(L.Path.XLINK_NS,"xlink:href","#"+f),h.appendChild(d),this._text.appendChild(h)}else{this._text.appendChild(d);var i=this.getTextAnchor();this.setTextAnchor(i)}a.className?this._text.setAttribute("class",a.className):this._text.setAttribute("class","leaflet-svg-text"),a.attr&&c(this._text,a.attr),a.style&&b(this._text,a.style),this._container.appendChild(this._text)}},PathFunctions=PathFunctions||{__updateStyle:L.Path.prototype._updateStyle,_createDefs:function(){this._defs=this._createElement("defs"),this._container.appendChild(this._defs)},_createGradient:function(a){this._defs||this._createDefs(),this._gradient&&this._defs.removeChild(this._gradient),a=a!==!0?L.extend({},a):{};var b=L.Util.guid();this._gradientGuid=b;var c,d;if("radial"==a.gradientType)c=this._createElement("radialGradient"),
d=a.radial||{cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"};else{c=this._createElement("linearGradient");var e=a.vector||[["0%","0%"],["100%","100%"]];d={x1:e[0][0],x2:e[1][0],y1:e[0][1],y2:e[1][1]}}d.id="grad"+b;var f,g=a.stops||[{offset:"0%",style:{color:"rgb(255, 255, 255)",opacity:1}},{offset:"60%",style:{color:this.options.fillColor||this.options.color,opacity:1}}];for(f in d)c.setAttribute(f,d[f]);for(var h=0;h<g.length;++h){var i=g[h],j=this._createElement("stop");i.style=i.style||{};for(f in i){var k=i[f];if("style"===f){var l="";k.color=k.color||this.options.fillColor||this.options.color,k.opacity="undefined"==typeof k.opacity?1:k.opacity;for(var m in k)l+="stop-"+m+":"+k[m]+";";k=l}j.setAttribute(f,k)}c.appendChild(j)}this._gradient=c,this._defs.appendChild(c)},_createDropShadow:function(a){this._defs||this._createDefs(),this._dropShadow&&this._defs.removeChild(this._dropShadow);var b=L.Util.guid(),c=this._createElement("filter"),d=this._createElement("feOffset"),e=this._createElement("feGaussianBlur"),f=this._createElement("feBlend");a=a||{width:"200%",height:"200%"},a.id="filter"+b;var g;for(g in a)c.setAttribute(g,a[g]);var h={result:"offOut","in":"SourceAlpha",dx:"2",dy:"2"},i={result:"blurOut","in":"offOut",stdDeviation:"2"},j={"in":"SourceGraphic",in2:"blurOut",mode:"lighten"};for(g in h)d.setAttribute(g,h[g]);for(g in i)e.setAttribute(g,i[g]);for(g in j)f.setAttribute(g,j[g]);c.appendChild(d),c.appendChild(e),c.appendChild(f),this._dropShadow=c,this._defs.appendChild(c)},_createCustomElement:function(a,b){var c=this._createElement(a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c},_createImage:function(a){var b=this._createElement("image");return b.setAttribute("width",a.width),b.setAttribute("height",a.height),b.setAttribute("x",a.x||0),b.setAttribute("y",a.y||0),b.setAttributeNS(L.Path.XLINK_NS,"xlink:href",a.url),b},_createPattern:function(a){this._pattern&&this._defs.removeChild(this._pattern);var b=this._createCustomElement("pattern",a);return this._pattern=b,b},_createShape:function(a,b){this._shape&&this._container.removeChild(this._shape);var c=this._createCustomElement(a,b);return c},_applyCustomStyles:function(){},_createFillPattern:function(a){var b=L.Util.guid(),c=a.pattern;c.id=b,c.patternUnits=c.patternUnits||"objectBoundingBox";var d=this._createPattern(c),e=this._createImage(a.image);e.setAttributeNS(L.Path.XLINK_NS,"xlink:href",a.url),d.appendChild(e),this._defs||this._createDefs(),this._defs.appendChild(d),this._path.setAttribute("fill","url(#"+b+")")},_getDefaultDiameter:function(a){return 1.75*a},_createShapeImage:function(a){a=a||{};var b=L.Util.guid(),c=this.options.radius||Math.max(this.options.radiusX,this.options.radiusY),d=this._getDefaultDiameter(c),e=a.imageSize||new L.Point(d,d),f=a.radius||d/2,g=a.shape||{circle:{r:f,cx:0,cy:0}},h=a.pattern||{width:e.x,height:e.y,x:0,y:0},i=Object.keys(g),j=i.length>0?i[0]:"circle";g[j].fill="url(#"+b+")";var k=this._createShape(j,g[j]);this.options.clickable&&k.setAttribute("class","leaflet-clickable"),h.id=b,h.patternUnits=h.patternUnits||"objectBoundingBox";var l=this._createPattern(h);a=a.image||{width:e.x,height:e.y,x:0,y:0,url:this.options.imageCircleUrl};var m=this._createImage(a);m.setAttributeNS(L.Path.XLINK_NS,"xlink:href",a.url),l.appendChild(m),this._defs.appendChild(l),this._container.insertBefore(k,this._defs),this._shape=k;var n=this;this._shape.addEventListener("mouseover",function(){n.fire("mouseover")}),this._shape.addEventListener("mouseout",function(){n.fire("mouseout")}),this._shape.addEventListener("mousemove",function(){n.fire("mousemove")});var o=this.getTextAnchor();if(this._shape&&o)if("circle"===this._shape.tagName||"ellipse"===this._shape.tagName)this._shape.setAttribute("cx",o.x),this._shape.setAttribute("cy",o.y);else{var p=this._shape.getAttribute("width"),q=this._shape.getAttribute("height");this._shape.setAttribute("x",o.x-Number(p)/2),this._shape.setAttribute("y",o.y-Number(q)/2)}},_updateStyle:function(a){this.__updateStyle.call(this,a);var b=a?a:this;b.options.stroke&&(b.options.lineCap&&b._path.setAttribute("stroke-linecap",b.options.lineCap),b.options.lineJoin&&b._path.setAttribute("stroke-linejoin",b.options.lineJoin)),b.options.gradient?(b._createGradient(b.options.gradient),b._path.setAttribute("fill","url(#"+b._gradient.getAttribute("id")+")")):b.options.fill||b._path.setAttribute("fill","none"),b.options.dropShadow?(b._createDropShadow(),b._path.setAttribute("filter","url(#"+b._dropShadow.getAttribute("id")+")")):b._path.removeAttribute("filter"),b.options.fillPattern&&b._createFillPattern(b.options.fillPattern),b._applyCustomStyles()}};if(L.SVG){var SVGStyleFunctions=L.Util.extend(PathFunctions,{__updateStyle:L.SVG.prototype._updateStyle}),SVGTextFunctions=L.Util.extend(TextFunctions,{__updatePath:L.SVG.prototype._updatePath});L.SVG.include(SVGStyleFunctions),L.SVG.include(SVGTextFunctions)}var LineTextFunctions=L.extend({},TextFunctions);LineTextFunctions.__updatePath=L.Polyline.prototype._updatePath,LineTextFunctions.getCenter=function(){var a,b,c,d,e,f,g=this._latlngs,h=g.length;for(a=0,b=h-1,area=0,lat=0,lng=0;h>a;b=a++)c=g[a],d=g[b],e=c.lat*d.lng-d.lat*c.lng,lat+=(c.lat+d.lat)*e,lng+=(c.lng+d.lng)*e,area+=e/2;return f=area?new L.LatLng(lat/(6*area),lng/(6*area)):g[0],f.area=area,f},LineTextFunctions.getTextAnchor=function(){var a=this.getCenter();return this._map.latLngToLayerPoint(a)},L.Polyline.include(LineTextFunctions),L.CircleMarker.include(TextFunctions),L.Path.include(PathFunctions),L.Polygon.include(PathFunctions),L.Polyline.include(PathFunctions),L.CircleMarker.include(PathFunctions),L.CircleMarker=L.CircleMarker.extend({_applyCustomStyles:function(){(this.options.shapeImage||this.options.imageCircleUrl)&&this._createShapeImage(this.options.shapeImage)},getTextAnchor:function(){var a=null;return this._point&&(a=new L.Point(this._point.x,this._point.y)),a}}),L.Point.prototype.rotate=function(a,b){var c=this.distanceTo(b),d=a*L.LatLng.DEG_TO_RAD+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d)},L.MapMarker=L.Path.extend({includes:TextFunctions,initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._latlng=a},options:{fill:!0,fillOpacity:1,opacity:1,radius:15,innerRadius:5,position:{x:0,y:0},rotation:0,numberOfSides:50,color:"#000000",fillColor:"#0000FF",weight:1,gradient:!0,dropShadow:!0,clickable:!0},setLatLng:function(a){return this._latlng=a,this.redraw()},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._points=this._getPoints(),this.options.innerRadius>0&&(this._innerPoints=this._getPoints(!0).reverse())},getBounds:function(){var a=this._map,b=3*this.options.radius,c=a.project(this._latlng),d=new L.Point(c.x-this.options.radius,c.y),e=new L.Point(c.x+this.options.radius,c.y-b),f=a.unproject(d),g=a.unproject(e);return new L.LatLngBounds(f,g)},getLatLng:function(){return this._latlng},setRadius:function(a){return this.options.radius=a,this.redraw()},setInnerRadius:function(a){return this.options.innerRadius=a,this.redraw()},setRotation:function(a){return this.options.rotation=a,this.redraw()},setNumberOfSides:function(a){return this.options.numberOfSides=a,this.redraw()},getPathString:function(){var a=this.getTextAnchor();if(this._shape)if("circle"===this._shape.tagName||"ellipse"===this._shape.tagName)this._shape.setAttribute("cx",a.x),this._shape.setAttribute("cy",a.y);else{var b=this._shape.getAttribute("width"),c=this._shape.getAttribute("height");this._shape.setAttribute("x",a.x-Number(b)/2),this._shape.setAttribute("y",a.y-Number(c)/2)}return this._path.setAttribute("shape-rendering","geometricPrecision"),new L.SVGPathBuilder(this._points,this._innerPoints).build(6)},getTextAnchor:function(){var a=null;return this._point&&(a=new L.Point(this._point.x,this._point.y-2*this.options.radius)),a},_getPoints:function(a){var b,c,d=a?360:210,e=a?d/Math.max(this.options.numberOfSides,3):d/50,f=a?d+this.options.rotation:d,g=a?this.options.rotation:-30,h=[],i=this.options.radius,j=Math.sqrt(.75),k=function(a){return a*L.LatLng.DEG_TO_RAD},l=this._point;for(a||(h.push(l),h.push(new L.Point(l.x+j*i,l.y-1.5*i)));f>g;)c=k(g),b=this._getPoint(c,i,a),h.push(b),g+=e;return a||h.push(new L.Point(l.x-j*i,l.y-1.5*i)),h},_getPoint:function(a,b,c){var d=b;return b=c?this.options.innerRadius:b,new L.Point(this._point.x+this.options.position.x+b*Math.cos(a),this._point.y-2*d+this.options.position.y-b*Math.sin(a))},_applyCustomStyles:function(){(this.options.shapeImage||this.options.imageCircleUrl)&&this._createShapeImage(this.options.shapeImage)},toGeoJSON:function(){return L.Util.pointToGeoJSON.call(this)}}),L.mapMarker=function(a,b){return new L.MapMarker(a,b)},L.RegularPolygonMarker=L.Path.extend({includes:TextFunctions,initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._latlng=a,this.options.numberOfSides=Math.max(this.options.numberOfSides,3)},options:{fill:!0,radiusX:10,radiusY:10,rotation:0,numberOfSides:3,position:{x:0,y:0},maxDegrees:360,gradient:!0,dropShadow:!1,clickable:!0},setLatLng:function(a){return this._latlng=a,this.redraw()},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._points=this._getPoints(),(this.options.innerRadius||this.options.innerRadiusX&&this.options.innerRadiusY)&&(this._innerPoints=this._getPoints(!0).reverse())},getBounds:function(){var a=this._map,b=this.options.radius||this.options.radiusX,c=this.options.radius||this.options.radiusY,d=b*Math.cos(Math.PI/4),e=c*Math.sin(Math.PI/4),f=a.project(this._latlng),g=new L.Point(f.x-d,f.y+e),h=new L.Point(f.x+d,f.y-e),i=a.unproject(g),j=a.unproject(h);return new L.LatLngBounds(i,j)},setRadius:function(a){return this.options.radius=a,this.redraw()},setRadiusXY:function(a,b){return this.options.radius=null,this.options.radiusX=a,this.options.radiusY=b,this.redraw()},setInnerRadius:function(a){return this.options.innerRadius=a,this.redraw()},setInnerRadiusXY:function(a,b){return this.options.innerRadius=null,this.options.innerRadiusX=a,this.options.innerRadiusY=b,this.redraw()},setRotation:function(a){return this.options.rotation=a,this.redraw()},setNumberOfSides:function(a){return this.options.numberOfSides=a,this.redraw()},getLatLng:function(){return this._latlng},getPathString:function(){var a=this.getTextAnchor();if(this._shape)if("circle"===this._shape.tagName||"ellipse"===this._shape.tagName)this._shape.setAttribute("cx",a.x),this._shape.setAttribute("cy",a.y);else{var b=this._shape.getAttribute("width"),c=this._shape.getAttribute("height");this._shape.setAttribute("x",a.x-Number(b)/2),this._shape.setAttribute("y",a.y-Number(c)/2)}return this._path.setAttribute("shape-rendering","geometricPrecision"),new L.SVGPathBuilder(this._points,this._innerPoints).build(6)},_getPoints:function(a){for(var b,c,d=this.options.maxDegrees||360,e=d/Math.max(this.options.numberOfSides,3),f=d,g=0,h=[],i=a?this.options.innerRadius||this.options.innerRadiusX:this.options.radius||this.options.radiusX,j=a?this.options.innerRadius||this.options.innerRadiusY:this.options.radius||this.options.radiusY,k=function(a){return a*L.LatLng.DEG_TO_RAD};f>g;)c=k(g),b=this._getPoint(c,i,j),h.push(b),g+=e;return h},_getPoint:function(a,b,c){var d=this.options.position?this._point.add(new L.Point(this.options.position.x,this.options.position.y)):this._point,e=new L.Point(d.x+b*Math.cos(a),d.y+c*Math.sin(a));return e.rotate(this.options.rotation,d),e},_getDefaultDiameter:function(a){var b=Math.PI/this.options.numberOfSides,c=a*Math.cos(b);return 1.75*c},_applyCustomStyles:function(){(this.options.shapeImage||this.options.imageCircleUrl)&&this._createShapeImage(this.options.shapeImage)},toGeoJSON:function(){return L.Util.pointToGeoJSON.call(this)}}),L.regularPolygonMarker=function(a,b){return new L.RegularPolygonMarker(a,b)},L.StarMarker=L.RegularPolygonMarker.extend({options:{numberOfPoints:5,rotation:-15,maxDegrees:360,gradient:!0,dropShadow:!0},setNumberOfPoints:function(a){return this.options.numberOfPoints=a,this.redraw()},_getPoints:function(a){for(var b,c,d,e=this.options.maxDegrees||360,f=e/this.options.numberOfPoints,g=e,h=0,i=[],j=a?this.options.innerRadius||this.options.innerRadiusX:this.options.radius||this.options.radiusX,k=a?this.options.innerRadius||this.options.innerRadiusY:this.options.radius||this.options.radiusY,l=function(a){return a*L.LatLng.DEG_TO_RAD};g>h;)d=l(h),b=this._getPoint(d,j,k),c=this._getPoint(d+l(f)/2,j/2,k/2),i.push(b),i.push(c),h+=f;return i}}),L.starMarker=function(a,b){return new L.StarMarker(a,b)},L.TriangleMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:3,rotation:30,radius:5}}),L.triangleMarker=function(a,b){return new L.TriangleMarker(a,b)},L.DiamondMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:4,radiusX:5,radiusY:10}}),L.diamondMarker=function(a,b){return new L.DiamondMarker(a,b)},L.SquareMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:4,rotation:45,radius:5}}),L.squareMarker=function(a,b){return new L.SquareMarker(a,b)},L.PentagonMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:5,rotation:-18,radius:5}}),L.pentagonMarker=function(a,b){return new L.PentagonMarker(a,b)},L.HexagonMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:6,rotation:30,radius:5}}),L.hexagonMarker=function(a,b){return new L.HexagonMarker(a,b)},L.OctagonMarker=L.RegularPolygonMarker.extend({options:{numberOfSides:8,rotation:22.5,radius:5}}),L.octagonMarker=function(a,b){return new L.OctagonMarker(a,b)},L.SVGMarker=L.Path.extend({initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._svg=b.svg,0===this._svg.indexOf("<")&&(this._data=this._svg),this._latlng=a},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},setLatLng:function(a){this._latlng=a,this.redraw()},getLatLng:function(){return this._latlng},getPathString:function(){var a=this,b=function(){for(var b=a._path.parentNode;"g"!==b.nodeName.toLowerCase();)b=b.parentNode;a.options.clickable&&b.setAttribute("class","leaflet-clickable");var c=a._data,d="svg"===c.nodeName.toLowerCase()?c.cloneNode(!0):c.querySelector("svg").cloneNode(!0);a.options.setStyle&&a.options.setStyle.call(a,d);var e=d.getAttribute("width"),f=d.getAttribute("height"),g=e?e.replace("px",""):"100%",h=f?f.replace("px",""):"100%";"100%"===g&&(g=a.options.size.x,h=a.options.size.y,d.setAttribute("width",g+(-1!==String(g).indexOf("%")?"":"px")),d.setAttribute("height",h+(-1!==String(h).indexOf("%")?"":"px")));var i=a.options.size||new L.Point(g,h),j=new L.Point(i.x/g,i.y/h),k=b.getElementsByTagName("svg");k.length>0&&k[0].parentNode.removeChild(k[0]),b.appendChild(d);var l=[],m=a.options.anchor||new L.Point(-i.x/2,-i.y/2),n=a._point.x+m.x,o=a._point.y+m.y;l.push("translate("+n+" "+o+")"),l.push("scale("+j.x+" "+j.y+")"),a.options.rotation&&l.push("rotate("+a.options.rotation+" "+g/2+" "+h/2+")"),b.setAttribute("transform",l.join(" "))};if(this._data)b();else{var c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(a._data=this.responseXML,b())},c.open("GET",this._svg,!0),c.send(null)}},toGeoJSON:function(){return pointToGeoJSON.call(this)}}),L.MarkerGroup=L.FeatureGroup.extend({initialize:function(a,b){L.FeatureGroup.prototype.initialize.call(this,b),this.setLatLng(a)},setStyle:function(a){return this},setLatLng:function(a){return this._latlng=a,this.eachLayer(function(b){b.setLatLng&&b.setLatLng(a)}),this},getLatLng:function(a){return this._latlng},toGeoJSON:function(){var a={type:"FeatureCollection",features:[]},b=function(a){return function(b){a.features.push(L.Util.pointToGeoJSON.call(b))}};return this.eachLayer(b(a)),a}}),L.BarMarker=L.Path.extend({initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._latlng=a},options:{fill:!0,width:2,maxHeight:10,position:{x:0,y:0},weight:1,color:"#000",opacity:1,gradient:!0,dropShadow:!1,lineCap:"square",lineJoin:"miter"},setLatLng:function(a){return this._latlng=a,this.redraw()},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._points=this._getPoints()},getBounds:function(){var a=this._map,b=a.project(this._latlng),c=this.options.width/2,d=new L.Point(b.x-c,b.y),e=new L.Point(b.x+c,b.y-this.options.maxHeight),f=a.unproject(d),g=a.unproject(e);return new L.LatLngBounds(f,g)},getLatLng:function(){return this._latlng},getPathString:function(){return this._path.setAttribute("shape-rendering","crispEdges"),new L.SVGPathBuilder(this._points).build()},_getPoints:function(){var a,b,c,d,e=[],f=this._point.x+this.options.position.x,g=this._point.y+this.options.position.y,h=this.options.width/2,i=this.options.value/this.options.maxValue*this.options.maxHeight;return a=new L.Point(f+h,g),b=new L.Point(f+h,g-i),c=new L.Point(f-h,g-i),d=new L.Point(f-h,g),e=[a,b,c,d]}}),L.barMarker=function(a,b){return new L.BarMarker(a,b)},L.ChartMarker=L.FeatureGroup.extend({initialize:function(a,b){L.Util.setOptions(this,b),this._layers={},this._latlng=a,this._loadComponents()},setLatLng:function(a){return this._latlng=a,this.redraw()},getLatLng:function(){return this._latlng},_loadComponents:function(){},_highlight:function(a){return a.weight&&(a.weight*=2),a},_unhighlight:function(a){return a.weight&&(a.weight/=2),a},_bindMouseEvents:function(a){var b=this,c=this.options.tooltipOptions;a.on("mouseover",function(a){var d,e=this.options,f=e.key,g=e.value,h=a.layerPoint,i=h.x-this._point.x,j=h.y-this._point.y,k=e.iconSize,l=i,m=j,n=5;l=0>i?k.x-i+n:-i-n,m=0>j?k.y-j+n:-j-n,d=new L.Point(l,m);var o={},p=e.displayText?e.displayText(g):g;o[f]={name:e.displayName,value:p};var q=new L.LegendIcon(o,e,{className:"leaflet-div-icon",iconSize:c?c.iconSize:k,iconAnchor:d});e.marker=new L.Marker(b._latlng,{icon:q}),e=b._highlight(e),this.initialize(b._latlng,e),this.redraw(),this.setStyle(e),b.addLayer(e.marker)}),a.on("mouseout",function(a){var c=this.options;c=b._unhighlight(c),this.initialize(b._latlng,c),this.redraw(),this.setStyle(c),b.removeLayer(c.marker)})},bindPopup:function(a,b){this.eachLayer(function(c){c.bindPopup(a,b)})},openPopup:function(a){for(var b in this._layers){var c=this._layers[b];a=a||this._latlng,c.openPopup(a);break}},closePopup:function(){for(var a in this._layers){var b=this._layers[a];latlng=latlng||this._latlng,b.closePopup();break}},redraw:function(){this.clearLayers(),this._loadComponents()},toGeoJSON:function(){return L.Util.pointToGeoJSON.call(this)}}),L.BarChartMarker=L.ChartMarker.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.ChartMarker.prototype.initialize.call(this,a,b)},options:{weight:1,opacity:1,color:"#000",fill:!0,position:{x:0,y:0},width:10,offset:0,iconSize:new L.Point(50,40)},_loadComponents:function(){var a,b,c,d,e,f,g,h=this.options,i=Object.keys(this.options.data),j=i.length,k=this.options.width,l=this.options.offset||0,m=this.options.data,n=this.options.chartOptions;e=-(k*j+l*(j-1))/2+k/2,f=0;for(var o in m)a=m[o],g=n[o],b=g.minValue||0,c=g.maxValue||100,h.fillColor=g.fillColor||this.options.fillColor,h.value=a,h.minValue=b,h.maxValue=c,h.position={x:e,y:f},h.width=k,h.maxHeight=g.maxHeight||10,h.key=o,h.value=a,h.displayName=g.displayName,h.opacity=this.options.opacity||1,h.fillOpacity=this.options.fillOpacity||.7,h.weight=this.options.weight||1,h.color=g.color||this.options.color,h.displayText=g.displayText,d=new L.BarMarker(this._latlng,h),this._bindMouseEvents(d),this.addLayer(d),e+=k+l}}),L.RadialBarMarker=L.Path.extend({initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._latlng=a},options:{fill:!0,radius:10,rotation:0,numberOfSides:30,position:{x:0,y:0},gradient:!0,dropShadow:!1},setLatLng:function(a){return this._latlng=a,this.redraw()},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._points=this._getPoints()},getBounds:function(){var a=this._map,b=this.options.radiusX||this.options.radius,c=this.options.radiusY||this.options.radius,d=b*Math.cos(Math.PI/4),e=c*Math.sin(Math.PI/4),f=a.project(this._latlng),g=new L.Point(f.x-d,f.y+e),h=new L.Point(f.x+d,f.y-e),i=a.unproject(g),j=a.unproject(h);return new L.LatLngBounds(i,j)},getLatLng:function(){return this._latlng},getPathString:function(){var a=this.options.endAngle-this.options.startAngle,b=a>=180?"1":"0",c=this.options.radiusX||this.options.radius,d=this.options.radiusY||this.options.radius,e="M"+this._points[0].x.toFixed(2)+","+this._points[0].y.toFixed(2)+"A"+c.toFixed(2)+","+d.toFixed(2)+" 0 "+b+",1 "+this._points[1].x.toFixed(2)+","+this._points[1].y.toFixed(2)+"L";return this._innerPoints?(e=e+this._innerPoints[0].x.toFixed(2)+","+this._innerPoints[0].y.toFixed(2),e=e+"A"+(c-this.options.barThickness).toFixed(2)+","+(d-this.options.barThickness).toFixed(2)+" 0 "+b+",0 "+this._innerPoints[1].x.toFixed(2)+","+this._innerPoints[1].y.toFixed(2)+"z"):e=e+this._point.x.toFixed(2)+","+this._point.y.toFixed(2)+"z",L.Browser.vml&&(e=Core.SVG.path(e)),this._path.setAttribute("shape-rendering","geometricPrecision"),e},_getPoints:function(){var a=this.options.endAngle-this.options.startAngle,b=this.options.endAngle+this.options.rotation,c=this.options.startAngle+this.options.rotation,d=[],e="radiusX"in this.options?this.options.radiusX:this.options.radius,f="radiusY"in this.options?this.options.radiusY:this.options.radius,g=function(a){return a*L.LatLng.DEG_TO_RAD};b=b||0,360===a&&(b-=.1);var h=g(c),i=g(b);return d.push(this._getPoint(h,e,f)),d.push(this._getPoint(i,e,f)),this.options.barThickness&&(this._innerPoints=[],this._innerPoints.push(this._getPoint(i,e-this.options.barThickness,f-this.options.barThickness)),this._innerPoints.push(this._getPoint(h,e-this.options.barThickness,f-this.options.barThickness))),d},_getPoint:function(a,b,c){return new L.Point(this._point.x+this.options.position.x+b*Math.cos(a),this._point.y+this.options.position.y+c*Math.sin(a))}}),L.radialBarMarker=function(a,b){return new L.RadialBarMarker(a,b)},L.PieChartMarker=L.ChartMarker.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.ChartMarker.prototype.initialize.call(this,a,b)},options:{weight:1,opacity:1,color:"#000",fill:!0,radius:10,rotation:0,numberOfSides:50,mouseOverExaggeration:1.2,maxDegrees:360,iconSize:new L.Point(50,40)},_highlight:function(a){var b=a.radiusX,c=a.radiusY,d=a.barThickness;return a.oldBarThickness=d,a.oldRadiusX=b,a.oldRadiusY=c,a.radiusX*=a.mouseOverExaggeration,a.radiusY*=a.mouseOverExaggeration,a.barThickness=a.radiusX-b+d,a},_unhighlight:function(a){return a.radiusX=a.oldRadiusX,a.radiusY=a.oldRadiusY,a.barThickness=a.oldBarThickness,a},_loadComponents:function(){var a,b,c,d,e=0,f=0,g=0,h=this.options.maxDegrees||360,i=this.options.rotation,j=this.options,k=this.options.data,l=this.options.chartOptions,m=function(a,b){var c=0;return a[b]&&(c=parseFloat(a[b])),c};for(d in k)a=m(k,d),e+=a;if(e>0)for(d in k)a=parseFloat(k[d])||0,c=l[d],g=a/e,f=g*h,j.startAngle=i,j.endAngle=i+f,j.fillColor=c.fillColor,j.color=c.color||"#000",j.radiusX=this.options.radiusX||this.options.radius,j.radiusY=this.options.radiusY||this.options.radius,j.rotation=0,j.key=d,j.value=a,j.displayName=c.displayName,j.displayText=c.displayText,b=new L.RadialBarMarker(this._latlng,j),this._bindMouseEvents(b),i=j.endAngle,this.addLayer(b)}}),L.pieChartMarker=function(a,b){return new L.PieChartMarker(a,b)},L.CoxcombChartMarker=L.PieChartMarker.extend({statics:{SIZE_MODE_RADIUS:"radius",SIZE_MODE_AREA:"area"}}),L.CoxcombChartMarker=L.CoxcombChartMarker.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.PieChartMarker.prototype.initialize.call(this,a,b)},options:{weight:1,opacity:1,color:"#000",fill:!0,radius:10,rotation:0,numberOfSides:50,mouseOverExaggeration:1.2,maxDegrees:360,iconSize:new L.Point(50,40),sizeMode:L.CoxcombChartMarker.SIZE_MODE_AREA},_loadComponents:function(){var a,b,c,d,e,f=0,g=this.options.maxDegrees||360,h=this.options.rotation,i=this.options,j="radiusX"in this.options?this.options.radiusX:this.options.radius,k="radiusY"in this.options?this.options.radiusY:this.options.radius,l=Object.keys(this.options.data),m=l.length,n=this.options.data,o=this.options.chartOptions;f=g/m;var p=function(a){return Math.sqrt(m*a/Math.PI)};for(var q in n){if(a=parseFloat(n[q])||0,e=o[q],b=e.minValue||0,c=e.maxValue,this.options.sizeMode===L.CoxcombChartMarker.SIZE_MODE_RADIUS){var r=new L.LinearFunction(new L.Point(b,0),new L.Point(c,j)),s=new L.LinearFunction(new L.Point(b,0),new L.Point(c,k));i.radiusX=r.evaluate(a),i.radiusY=s.evaluate(a)}else{var t=Math.max(j,k),u=Math.PI*Math.pow(t,2)/m,v=new L.LinearFunction(new L.Point(b,0),new L.Point(c,u),{postProcess:p});i.radiusX=v.evaluate(a),i.radiusY=i.radiusX}i.startAngle=h,i.endAngle=h+f,i.fillColor=e.fillColor,i.color=e.color||"#000",i.rotation=0,i.key=q,i.value=a,i.displayName=e.displayName,i.displayText=e.displayText,d=new L.RadialBarMarker(this._latlng,i),this._bindMouseEvents(d),h=i.endAngle,this.addLayer(d)}}}),L.coxcombChartMarker=function(a,b){return new L.CoxcombChartMarker(a,b)},L.RadialBarChartMarker=L.ChartMarker.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.ChartMarker.prototype.initialize.call(this,a,b)},options:{weight:1,opacity:1,color:"#000",fill:!0,radius:10,rotation:0,numberOfSides:30,offset:2,barThickness:5,maxDegrees:360,iconSize:new L.Point(50,40)},_loadComponents:function(){var a,b,c,d,e,f=this.options.rotation,g=this.options.maxDegrees||360,h=this.options,i=this.options.radiusX||this.options.radius,j=this.options.radiusY||this.options.radius,k=this.options.data,l=this.options.chartOptions,m=this.options.barThickness||4,n=this.options.offset||2;for(var o in k){a=parseFloat(k[o]),e=l[o],b=e.minValue||0,c=e.maxValue||100;var p=new L.LinearFunction(new L.Point(b,0),new L.Point(c,g));f=p.evaluate(a),h.startAngle=this.options.rotation,h.endAngle=this.options.rotation+f,h.fillColor=e.fillColor,h.radiusX=i,h.radiusY=j,h.barThickness=m,h.rotation=0,h.key=o,h.value=a,h.displayName=e.displayName,h.displayText=e.displayText,h.weight=this.options.weight||1,d=new L.RadialBarMarker(this._latlng,h),this._bindMouseEvents(d),this.addLayer(d),i+=m+n,j+=m+n}}}),L.radialBarChartMarker=function(a,b){return new L.RadialBarChartMarker(a,b)},L.StackedRegularPolygonMarker=L.ChartMarker.extend({options:{iconSize:new L.Point(50,40)},initialize:function(a,b){L.Util.setOptions(this,b),L.ChartMarker.prototype.initialize.call(this,a,b)},_loadComponents:function(){var a,b,c,d,e=0,f=0,g=this.options,h=this.options.data,i=this.options.chartOptions,j=[];for(d in h){a=parseFloat(h[d]),c=i[d],minValue=c.minValue||0,maxValue=c.maxValue||100,minRadius=c.minRadius||0,maxRadius=c.maxRadius||10,g.fillColor=c.fillColor||this.options.fillColor,g.value=a,g.minValue=minValue,g.maxValue=maxValue;var k=new L.LinearFunction(new L.Point(minValue,minRadius),new L.Point(maxValue,maxRadius)),l=k.evaluate(a);g.radiusX=e+l,g.radiusY=f+l,g.innerRadiusX=e,g.innerRadiusY=f,g.key=d,g.displayName=c.displayName,g.opacity=this.options.opacity||1,g.fillOpacity=this.options.fillOpacity||.7,g.weight=this.options.weight||1,g.color=c.color||this.options.color,g.displayText=c.displayText,b=new L.RegularPolygonMarker(this._latlng,g),this._bindMouseEvents(b),e=g.radiusX,f=g.radiusY,this.options.drawReverse?j.push(b):this.addLayer(b)}if(this.options.drawReverse)for(var m=j.pop();m;)this.addLayer(m),m=j.pop()}}),L.RadialMeterMarker=L.ChartMarker.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.ChartMarker.prototype.initialize.call(this,a,b)},options:{weight:1,opacity:1,color:"#000",fill:!0,radius:10,rotation:180,numberOfSides:30,offset:2,barThickness:5,maxDegrees:180,iconSize:new L.Point(50,40),backgroundStyle:{fill:!0,fillColor:"#707070",fillOpacity:.2,opacity:.8,color:"#505050"}},_loadComponents:function(){var a,b,c,d,e,f,g=this.options.rotation,h=this.options.maxDegrees||360,i=this.options,j=this.options.radiusX||this.options.radius,k=this.options.radiusY||this.options.radius,l=this.options.data,m=this.options.chartOptions,n=this.options.barThickness||4,o=g,p=this.options.numSegments||10,q=h/p;for(var r in l){a=parseFloat(l[r]),e=m[r],f=this.options.displayOptions?this.options.displayOptions[r]:{},b=e.minValue||0,c=e.maxValue||100;for(var s,t,u=c-b,v=h/u*(a-b),w=g+v,x=g+h,y=new L.LinearFunction(new L.Point(g,b),new L.Point(x,c));w>o;){i.startAngle=o,s=Math.min(q,w-o),i.endAngle=o+s,i.fillColor=e.fillColor,i.radiusX=j,i.radiusY=k,i.barThickness=n,i.rotation=0,i.key=r,i.value=a,i.displayName=e.displayName,i.displayText=e.displayText,t=y.evaluate(o+s);for(var z in f)i[z]=f[z].evaluate?f[z].evaluate(t):f[z];d=new L.RadialBarMarker(this._latlng,i),this._bindMouseEvents(d),this.addLayer(d),o+=s}if(this.options.backgroundStyle&&x>o){s=x-o,i.endAngle=o+s,i.radiusX=j,i.radiusY=k,i.barThickness=n,i.rotation=0,i.key=r,i.value=a,i.displayName=e.displayName,i.displayText=e.displayText,i.fillColor=null,i.fill=!1,i.gradient=!1;for(var A in this.options.backgroundStyle)i[A]=this.options.backgroundStyle[A];t=y.evaluate(o+s),d=new L.RadialBarMarker(this._latlng,i),this.addLayer(d)}}}}),L.LocationModes={LATLNG:function(a,b){var c=function(b,c){var d=L.Util.getFieldValue(a,b),e=L.Util.getFieldValue(a,c),f=null;if(d&&e){var g=new L.LatLng(d,e);f={location:g,text:[g.lat.toFixed(3),g.lng.toFixed(3)].join(", "),center:g}}return f},d=c(this.options.latitudeField,this.options.longitudeField);if(!d&&this.options.fallbackLocationFields)for(var e,f=0;!d&&f<this.options.fallbackLocationFields.length;)e=this.options.fallbackLocationFields[f],d=c(e.latitudeField,e.longitudeField),f++;return d},GEOHASH:function(a,b){var c,d=this.options.geohashField?L.Util.getFieldValue(a,this.options.geohashField):b,e=decodeGeoHash(d);return e.latitude[2]&&e.longitude[2]&&(c=new L.LatLngBounds(new L.LatLng(e.latitude[0],e.longitude[0]),new L.LatLng(e.latitude[1],e.longitude[1]))),{location:c,text:d,center:c.getCenter()}},GWCOUNTRY:function(a,b){var c,d,e=this.options.codeField?L.Util.getFieldValue(a,this.options.codeField):b,f=L.gwNoLookup||{},g=L.countries||{},h=L.countryCentroids||{},i=e.toUpperCase();e=i;var j=i in f;j&&(e=f[i]||e),e?(c=g[e],d=h[e]):console.log("Code not found: "+i);var k=new L.GeoJSON(c);return{location:k,text:L.GeometryUtils.getName(c)||e,center:d}},COUNTRY:function(a,b){var c,d,e=this.options.codeField?L.Util.getFieldValue(a,this.options.codeField):b,f=L.codeLookup||{},g=L.alpha2Lookup||{},h=L.fips2Lookup||{},i=L.countries||{},j=L.countryCentroids||{},k=e.toUpperCase();e=k,2===e.length?e=g[k]||h[k]:3===e.length&&(e=f[k]||e),e?(c=i[e],d=j[e]):console.log("Code not found: "+k);var l=new L.GeoJSON(c);return{location:l,text:L.GeometryUtils.getName(c)||e,center:d}},STATE:function(a,b){var c,d,e=this.options.codeField?L.Util.getFieldValue(a,this.options.codeField):b,f=L.states||{},g=L.stateCentroids||{},h=e.toUpperCase();e=h,c=f[e],d=g[e];var i=new L.GeoJSON(c);return{location:i,text:L.GeometryUtils.getName(c)||e,center:d}},GEOJSON:function(a,b){var c=this.options.geoJSONField,d=c?L.Util.getFieldValue(a,c):a,e=null;if(d){var f=this,g=function(a,b){return f.recordToLayer(a,b)};e=L.GeometryUtils.getGeoJSONLocation(d,a,this.options.locationTextField,g)}return e},LOOKUP:function(a,b){var c=this.options.codeField?L.Util.getFieldValue(a,this.options.codeField):b;this._lookupIndex=this._lookupIndex||L.GeometryUtils.indexFeatureCollection(this.options.locationLookup,this.options.locationIndexField||this.options.codeField);var d=this._lookupIndex[c],e=null;if(d||0!==c.indexOf("0")||(d=this._lookupIndex[c.substring(1)]),d){var f=this,g=function(a,b){return f.recordToLayer(a,b)};e=L.GeometryUtils.getGeoJSONLocation(d,a,this.options.locationTextField,g)}return e},CUSTOM:function(a,b){var c,d=this.options.codeField,e=L.Util.getFieldValue(a,d),f={};if(f[e]=a,this.options.getLocation){var g=this,h=function(a,b){g.locationToLayer(b,f[a])};c=this.options.getLocation(f,d,[e],h)}return c}},L.DataLayer=L.LayerGroup.extend({includes:L.Mixin.Events,options:{recordsField:"features",locationMode:L.LocationModes.LATLNG,
latitudeField:"geometry.coordinates.1",longitudeField:"geometry.coordinates.0",displayField:null,displayOptions:null,layerOptions:{numberOfSides:4,radius:10,weight:1,color:"#000"},showLegendTooltips:!0,tooltipOptions:{iconSize:new L.Point(60,50),iconAnchor:new L.Point(-5,50),mouseOverExaggeration:2},setHighlight:function(a){return a.weight=a.weight||1,a.fillOpacity=a.fillOpacity||.5,a.weight*=2,a.fillOpacity/=1.5,a},unsetHighlight:function(a){return a.weight=a.weight||1,a.fillOpacity=a.fillOpacity||.25,a.weight/=2,a.fillOpacity*=1.5,a}},initialize:function(a,b){L.Util.setOptions(this,b),L.LayerGroup.prototype.initialize.call(this,b),a=a||{},this._includeFunction=this.options.filter||this.options.includeLayer,this._markerFunction=this.options.getMarker||this._getMarker,this._addChildLayers(),this.addData(a)},_addChildLayers:function(){this._boundaryLayer=new L.LayerGroup,this.addLayer(this._boundaryLayer),this._trackLayer=new L.LayerGroup,this.addLayer(this._trackLayer)},_zoomFunction:function(a){var b=this._map,c=this,d=b.getZoom();if(this.options.maxZoom&&d>this.options.maxZoom)this.hiddenLayers=[],this.eachLayer(function(a){c.hiddenLayers.push(a),b.removeLayer(a)});else if(this.hiddenLayers){for(;this.hiddenLayers.length>0;){var e=this.hiddenLayers.pop();b.addLayer(e),this.options.backgroundLayer&&e.bringToBack&&e.bringToBack()}this.hiddenLayers=null}},onAdd:function(a){L.LayerGroup.prototype.onAdd.call(this,a),a.on("zoomend",this._zoomFunction,this)},onRemove:function(a){L.LayerGroup.prototype.onRemove.call(this,a),a.off("zoomend",this._zoomFunction,this)},bringToBack:function(){this.invoke("bringToBack"),this._trackLayer&&this._trackLayer.invoke("bringToBack"),this._boundaryLayer&&this._boundaryLayer.invoke("bringToBack")},bringToFront:function(){this._boundaryLayer&&this._boundaryLayer.invoke("bringToFront"),this._trackLayer&&this._trackLayer.invoke("bringToFront"),this.invoke("bringToFront")},getBounds:function(){var a;return this.eachLayer(function(b){b.getBounds&&(a?a.extend(b.getBounds()):a=b.getBounds())}),a},_getLocation:function(a,b){return this.options.locationMode.call(this,a,b)},_processLocation:function(a){var b=a.center;return b},_styleBoundary:function(a,b,c){if(a.setStyle){var d;this.options.boundaryStyle instanceof Function&&(d=this.options.boundaryStyle.call(this,c,a)),d=d||this.options.boundaryStyle||L.extend({},b,{fillOpacity:.2,clickable:!1}),a.setStyle(d)}return a},_addBoundary:function(a,b,c){var d,e=a.location;return this.options.includeBoundary&&(e instanceof L.LatLngBounds&&(e=new L.Rectangle(e)),e=this._styleBoundary(e,b,c),this._boundaryLayer.addLayer(e),d=e),d},_getLayer:function(a,b,c){var d=this._addBoundary(a,b,c);a=this._processLocation(a);var e;return a&&(e=this._markerFunction.call(this,a,b,c),e.boundaryLayer=d),e},_getMarker:function(a,b,c){var d;return a&&(d=b.numberOfSides>=30&&!(b.innerRadius||b.innerRadiusX&&b.innerRadiusY)?new L.CircleMarker(a,b):new L.RegularPolygonMarker(a,b)),d},_preProcessRecords:function(a){return a},_shouldLoadRecord:function(a){return this._includeFunction?this._includeFunction.call(this,a):!0},_loadRecords:function(a){var b;a=this._preProcessRecords(a);for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];d=this.options.deriveProperties?this.options.deriveProperties(d):d;var e=this._shouldLoadRecord(d);e&&(b=this._getLocation(d,c),this.locationToLayer(b,d))}},_preloadLocations:function(a){var b=this.options.codeField,c=[],d={};for(var e in a)if(a.hasOwnProperty(e)){var f=a[e],g=L.Util.getFieldValue(f,b);d[g]=f,c.push(g)}if(this.options.getLocation){var h=this,i=function(a,b){h.locationToLayer(b,d[a])};this.options.getLocation(d,b,c,i)}},setDisplayOptions:function(a){return this.options.displayOptions=a,this.reloadData(),this},setDisplayOption:function(a,b){if(this.options.displayOptions=this.options.displayOptions||{},a in this.options.displayOptions){var c=this.options.displayOptions[a];this.options.displayOptions[a]=L.extend({},c,b)}else this.options.displayOptions[a]=b;return this.reloadData(),this},setFilter:function(a){return this.options.filter=a,this.reloadData(),this},setData:function(a){this._data=a,this.reloadData()},reloadData:function(){return this._layerIndex||(this.clearLayers(),this._addChildLayers()),this._data&&this.addData(this._data),this.fire("legendChanged",this),this},addData:function(a){var b=null!==this.options.recordsField&&this.options.recordsField.length>0?L.Util.getFieldValue(a,this.options.recordsField):a;this.options.getIndexKey&&!this._layerIndex&&(this._layerIndex={},this._boundaryIndex={}),this.options.locationMode===L.LocationModes.CUSTOM&&this.options.preload?this._preloadLocations(b):this._loadRecords(b),this._data=a},locationToLayer:function(a,b){var c;c=this.recordToLayer(a,b),c&&this.addLayer(c)},_bindMouseEvents:function(a,b,c){var d=this,e=this.options,f=e.setHighlight,g=e.unsetHighlight,h=e.tooltipOptions,i=function(a){var b=a.target,e=this.options||b.options,g=new L.LegendIcon(c,e,{className:h.className||"leaflet-div-icon",iconSize:h.iconSize,iconAnchor:h.iconAnchor}),i=a.latlng||a.target._latlng,j=new L.Marker(i,{icon:g});d.addLayer(j),d.tooltip&&(d.removeLayer(d.tooltip),d.tooltip=null),d.tooltip=j,f&&(e=f(e)),b.setStyle&&b.setStyle(e),b.isHighlighted=!0},j=function(a){d.tooltip&&d.tooltip.setLatLng(a.latlng)},k=function(a){if(a.target.isHighlighted){a.target.isHighlighted=!1,d.tooltip&&(d.removeLayer(d.tooltip),d.tooltip=null);var b=a.target,c=this.options||b.options;g&&(c=g(c)),b.setStyle&&b.setStyle(c)}},l=function(a){a.off("mouseover"),a.off("mouseout"),a.off("mousemove"),a.on({mouseover:i,mouseout:k,mousemove:j})},m=function(a){a.eachLayer?a.eachLayer(function(a){m(a)}):l(a)};m(a)},_getDynamicOptions:function(a){var b=L.Util.extend({},this.options.layerOptions),c=this.options.displayOptions,d={};if(c)for(var e in c){var f,g=c[e],h=L.Util.getFieldValue(a,e),i=g.displayText?g.displayText(h):h;if(d[e]={name:g.displayName,value:i},g.styles)b=L.Util.extend(b,g.styles[h]),g.styles[h]=b;else for(var j in g)f=g[j],b[j]=f.evaluate?f.evaluate(h):f.call?f.call(this,h):f}return{layerOptions:b,legendDetails:d}},_getIndexedLayer:function(a,b,c,d){if(this.options.getIndexKey){var e=this.options.getIndexKey.call(this,b,d);if(e in a){layer=a[e];var f=function(a){c.radius&&a instanceof L.CircleMarker&&a.setRadius(c.radius),a.setStyle(c),a.setLatLng&&a.getLatLng()!==b.center?a.setLatLng(b.center):a.redraw()};L.Util.updateLayer(layer,f),layer.boundaryLayer&&(layer.boundaryLayer=this._styleBoundary(layer.boundaryLayer,c,d))}else layer=this._getLayer(b,c,d),a[e]=layer;if(this.options.getTrack){var g=!layer.trackLayer;layer.trackLayer=this.options.getTrack.call(this,layer,b,layer.trackLayer),g&&this._trackLayer.addLayer(layer.trackLayer)}}else layer=this._getLayer(b,c,d);return layer},recordToLayer:function(a,b){var c,d=L.Util.extend({},this.options.layerOptions),e={},f=!0;if(this._includeFunction&&(f=this._includeFunction.call(this,b)),f){var g=this._getDynamicOptions(b);d=g.layerOptions,e=g.legendDetails,a&&d&&(d.title=a.text,c=this._getIndexedLayer(this._layerIndex,a,d,b),c&&(this.options.showLegendTooltips&&this._bindMouseEvents(c,d,e),this.options.onEachRecord&&this.options.onEachRecord.call(this,c,b,a,this)))}return c},getLegend:function(a){return this.options.getLegend?this.options.getLegend.call(this,a):this._getLegend(a)},_getLegendElement:function(a){var b,c,d=document.createElement("i"),e=a.displayProperties,f=a.layerOptions,g=a.ignoreProperties,h=a.displayTextFunction,i=a.index,j=a.numSegments,k=a.segmentWidth,l=a.minValue,m=a.maxValue;L.StyleConverter.applySVGStyle(d,f);var n={evaluate:function(b){return a.breaks[b]}};for(var o in e)if(e.hasOwnProperty(o)&&-1===g.indexOf(o)&&(valueFunction=e[o],valueFunction&&(valueFunction.getBounds||e.minValue&&e.maxValue))){var p=valueFunction.getBounds?valueFunction.getBounds():null,q=p?p[0].x:e.minValue,r=p?p[1].x:e.maxValue,s=a.breaks?n:new L.LinearFunction(new L.Point(0,q),new L.Point(j,r));b=q,c=r,h&&(b=h(q),c=h(r)),0===i&&(l.innerHTML=b,m.innerHTML=c);var t=(r-q)/j,u=s.evaluate(i),v=s.evaluate(i+1),w=valueFunction.evaluate?valueFunction.evaluate(u):valueFunction(u),x=valueFunction.evaluate?valueFunction.evaluate(v):valueFunction(v);L.StyleConverter.setCSSProperty(d,o,w),"fillColor"===o&&(a.gradient?d.style.cssText+="background-image:linear-gradient(left , "+w+" 0%, "+x+" 100%);background-image:-ms-linear-gradient(left , "+w+" 0%, "+x+" 100%);background-image:-moz-linear-gradient(left , "+w+" 0%, "+x+" 100%);background-image:-webkit-linear-gradient(left , "+w+" 0%, "+x+" 100%);":d.style.cssText+="background-color:"+w+";"),"color"===o&&(d.style.cssText+="border-top-color:"+w+";border-bottom-color:"+x+";border-left-color:"+w+";border-right-color:"+x+";"),"weight"===o&&(d.style.cssText+="border-top-width:"+w+";border-bottom-width:"+x+";border-left-width:"+w+";border-right-width:"+x+";");var y=a.minX||t*i+q,z=a.maxX||y+t;h&&valueFunction&&(y=h(y),z=h(z)),d.setAttribute("title",y+" - "+z)}return d.style.width=k+"px",d},_getLegend:function(a){a=a||this.options.legendOptions||{};var b,c=a.className,d=document.createElement("div"),e=L.DomUtil.create("div","legend",d),f=a.numSegments||10,g=a.width||100,h=this.options.layerOptions||{},i=h.weight||0,j=g/f-2*i,k=this.options.displayOptions||{};c&&L.DomUtil.addClass(e,c),a.title&&(L.DomUtil.create("legend","",e).innerHTML=a.title);var l=function(a){return a};for(var m in k)if(k.hasOwnProperty(m)){var n=k[m];if(!n.excludeFromLegend){var o=n.displayName||m;b=n.displayText;var p=b?b:l,q=n.styles;if(L.DomUtil.create("div","legend-title",e).innerHTML=o,q)e.innerHTML+=new L.CategoryLegend(q).generate();else{var r=L.DomUtil.create("div","data-layer-legend"),s=L.DomUtil.create("div","min-value",r),t=L.DomUtil.create("div","scale-bars",r),u=L.DomUtil.create("div","max-value",r),v=["displayName","displayText","minValue","maxValue"],w=n.breaks,x=[];if(f=a.numSegments||10,w){for(var y=new L.LinearFunction([w[0],0],[w[w.length-1],g]),z=0,A=0,B=1;B<w.length;++B)A=y.evaluate(w[B]),x.push(A-z-2*i),z=A;f=x.length}for(var C=0;f>C;++C){var D={displayProperties:n,layerOptions:h,ignoreProperties:v,displayTextFunction:p,index:C,numSegments:f,segmentWidth:j,minValue:s,maxValue:u,gradient:a.gradient};w&&x.length>0&&(D.segmentWidth=x[C],D.segmentSize=x[C],D.minX=w[C],D.maxX=w[C+1],D.breaks=w);var E=this._getLegendElement(D);t.appendChild(E)}e.appendChild(r)}}}return d.innerHTML}}),L.dataLayer=function(a,b){return new L.DataLayer(a,b)},L.MapMarkerDataLayer=L.DataLayer.extend({_getMarker:function(a,b,c){return new L.MapMarker(a,b)}}),L.mapMarkerDataLayer=function(a,b){return new L.MapMarkerDataLayer(a,b)},L.MarkerDataLayer=L.DataLayer.extend({initialize:function(a,b){this._markerMap={},L.DataLayer.prototype.initialize.call(this,a,b)},options:{recordsField:"features",locationMode:L.LocationModes.LATLNG,latitudeField:"latitude",longitudeField:"longitude",layerOptions:{icon:null},showLegendTooltips:!1},_getMarker:function(a,b,c){return this.options.setIcon&&(b.icon=this.options.setIcon.call(this,c,b)),new L.Marker(a,b)},_getLegendElement:function(a){},_getLegend:function(a){return"<span>No legend available</span>"}}),L.markerDataLayer=function(a,b){return new L.MarkerDataLayer(a,b)},L.PanoramioLayer=L.MarkerDataLayer.extend({statics:{UPLOAD_DATE_FORMAT:"DD MMM YYYY",SIZE_BY_DATE:"date",SIZE_BY_POPULARITY:"popularity",SIZE_BY_NONE:"none",SIZES:{square:[60,60],mini_square:[32,32]},NUM_PHOTOS:50}}),L.PanoramioLayer=L.PanoramioLayer.extend({initialize:function(a){L.MarkerDataLayer.prototype.initialize.call(this,{},a),this._from=0,this._to=L.PanoramioLayer.NUM_PHOTOS,this._calls=[]},options:{recordsField:"photos",latitudeField:"latitude",longitudeField:"longitude",locationMode:L.LocationModes.LATLNG,showLegendTooltips:!1,sizeBy:L.PanoramioLayer.SIZE_BY_DATE,layerOptions:{opacity:1},onEachRecord:function(a,b){var c=b.photo_file_url,d=b.photo_title,e=this,f=b.width,g=b.height,h=2e4;a.on("click",function(i){var j=document.createElement("div"),k=L.DomUtil.create("div","",j);L.DomUtil.addClass(k,"panoramio-content");var l=L.DomUtil.create("img","photo",k);l.setAttribute("onload","this.style.opacity=1;"),l.setAttribute("src",c),l.style.width=f+"px";var m=L.DomUtil.create("div","photo-info",k);m.style.width=f-20+"px",m.innerHTML="<span>"+d+'</span><a class="photo-link" target="_blank" href="'+b.photo_url+'"><img src="http://www.panoramio.com/img/glass/components/logo_bar/panoramio.png" style="height: 14px;"/></a>';var n=L.DomUtil.create("a","author-link",k);n.setAttribute("target","_blank"),n.setAttribute("href",b.owner_url),n.innerHTML="by "+b.owner_name;var o=new L.DivIcon({className:"photo-details",html:j.innerHTML,iconAnchor:[f/2,g/2]}),p=new L.Marker(i.target._latlng,{icon:o,zIndexOffset:h});p.on("click",function(a){e.removeLayer(a.target)}),a.viewedImage=p,e.viewedImage=p,e.addLayer(p)}),this.options.onEachPhoto&&this.options.onEachPhoto.call(this,a,b)},setIcon:function(a,b){var c=L.Util.getFieldValue(a,"photo_title"),d=null;this._sizeFunction&&(d=this._sizeFunction.evaluate(a.index));var e=d?new L.Point(d,d):L.PanoramioLayer.SIZES[this.options.size],f=a.photo_file_url.replace("/medium/","/"+this.options.size+"/"),g=new L.DivIcon({iconSize:e,className:"",html:'<img class="photo" onload="this.style.opacity=1" title="'+c+'" src="'+f+'"/>'});return g},updateInterval:3e5,size:"square",attributionText:'Photos provided by <a href="http://www.panoramio.com"><img src="http://www.panoramio.com/img/glass/components/logo_bar/panoramio.png" style="height: 10px;"/></a>.  Photos provided by <a href="http://www.panoramio.com"><img src="http://www.panoramio.com/img/glass/components/logo_bar/panoramio.png" style="height: 10px;"/></a> are under the copyright of their owners',refreshEvents:"moveend",photoSet:"public"},includes:L.Mixin.Events,onAdd:function(a){L.DataLayer.prototype.onAdd.call(this,a),a.attributionControl&&a.attributionControl.addAttribution(this.options.attributionText);var b=this,c=function(a){b._from=0,b._to=L.PanoramioLayer.NUM_PHOTOS,b.fire("requestingPhotos"),b._call&&clearTimeout(b._call);var c=function(){b.requestPhotos()};b._call=setTimeout(c,1e3)};this.requestPhotos(),this._interval=setInterval(c,this.options.updateInterval),this._resetFunction=c,a.on(this.options.refreshEvents,c)},onRemove:function(a){L.DataLayer.prototype.onRemove.call(this,a),a.attributionControl&&a.attributionControl.removeAttribution(this.options.attributionText),this._interval&&(clearInterval(this._interval),this._interval=null),a.off(this.options.refreshEvents,this._resetFunction)},calculateSizeByDate:function(a){for(var b=a.photos,c=[],d=0;d<b.length;++d){var e=b[d],f=moment(e.upload_date,L.PanoramioLayer.UPLOAD_DATE_FORMAT);c.push(f),b[d].index=f}c.sort(function(a,b){return a-b});var g=L.PanoramioLayer.SIZES[this.options.size][0];return this._sizeFunction=new L.LinearFunction([c[0],g/2],[c[c.length-1],g]),a},calculateSizeByPopularity:function(a){for(var b=a.photos,c=0;c<b.length;++c)b[c].index=c;var d=L.PanoramioLayer.SIZES[this.options.size][0];return this._sizeFunction=new L.LinearFunction([0,d/2],[b.length,d]),a},next:function(){this._from=this._to,this._to=this._from+L.PanoramioLayer.NUM_PHOTOS,this.requestPhotos()},previous:function(){this._to=this._from,this._from=this._from-L.PanoramioLayer.NUM_PHOTOS,this.requestPhotos()},requestJsonp:function(a,b,c){var d=this,e="function"+(new Date).getTime(),f=[];b.callback="window.LeafletDvfJsonpCallbacks."+e;for(var g in b)b.hasOwnProperty(g)&&f.push(g+"="+encodeURIComponent(b[g]));return a+=(a.indexOf("?")>0?"&":"?")+f.join("&"),"undefined"==typeof window.LeafletDvfJsonpCallbacks&&(window.LeafletDvfJsonpCallbacks={}),window.LeafletDvfJsonpCallbacks[e]=function(a){c.call(d,a),delete window.LeafletDvfJsonpCallbacks[e]},this.jsonpScript&&(document.head.removeChild(this.jsonpScript),this.jsonpScript=null),this.jsonpScript=document.createElement("script"),this.jsonpScript.setAttribute("type","text/javascript"),this.jsonpScript.setAttribute("async","true"),this.jsonpScript.setAttribute("src",a),document.head.appendChild(this.jsonpScript),{abort:function(){e in window.LeafletDvfJsonpCallbacks&&(window.LeafletDvfJsonpCallbacks[e]=function(){delete window.LeafletDvfJsonpCallbacks[e]})}}},requestPhotos:function(){for(var a=this,b=this._map.getBounds(),c=b.getSouthWest(),d=b.getNorthEast();a._calls.length>0;)a._calls.pop().abort();var e=this.requestJsonp("http://www.panoramio.com/map/get_panoramas.php",{set:this.options.photoSet,from:a._from,to:a._to,minx:c.lng,miny:c.lat,maxx:d.lng,maxy:d.lat,size:"medium",mapfilter:"true"},function(b){a._count=b.count,moment&&a.options.sizeBy===L.PanoramioLayer.SIZE_BY_DATE?b=a.calculateSizeByDate(b):a.options.sizeBy===L.PanoramioLayer.SIZE_BY_POPULARITY&&(b=a.calculateSizeByPopularity(b)),a.fire("photosAvailable",b),a.clearLayers(),a.addData(b)});a._calls.push(e)}}),L.panoramioLayer=function(a){return new L.PanoramioLayer(a)},L.GeohashDataLayer=L.DataLayer.extend({initialize:function(a,b){L.DataLayer.prototype.initialize.call(this,a,b)},options:{recordsField:"features",locationMode:L.LocationModes.GEOHASH,geohashField:"geohash",displayField:null,displayOptions:null,layerOptions:{weight:1,color:"#000"},getIndexKey:function(a,b){return a.text}},_getLayer:function(a,b,c){return new L.Rectangle(a.location,b)}}),L.geohashDataLayer=function(a,b){return new L.GeohashDataLayer(a,b)},L.ChoroplethDataLayer=L.DataLayer.extend({initialize:function(a,b){L.DataLayer.prototype.initialize.call(this,a,b)},options:{recordsField:"features",locationMode:L.LocationModes.COUNTRY,codeField:"ISO",displayField:null,displayOptions:null,layerOptions:{weight:1,color:"#000"},maxZoom:16,backgroundLayer:!0},_getLayer:function(a,b,c){return a.location instanceof L.LatLng?a.location=this._markerFunction.call(this,a.location,b,c):a.location instanceof L.LatLngBounds&&(a.location=new L.Rectangle(a.location,b)),a.location.setStyle&&(b.gradient=a.location instanceof L.Polyline?!1:b.gradient,a.location.setStyle(b)),a.location}}),L.choroplethDataLayer=function(a,b){return new L.ChoroplethDataLayer(a,b)},L.ChartDataLayer=L.DataLayer.extend({options:{showLegendTooltips:!1},initialize:function(a,b){L.DataLayer.prototype.initialize.call(this,a,b)},_getLayer:function(a,b,c){var d=this._addBoundary(a,b,c);a=this._processLocation(a);var e=this.options.chartOptions,f=this.options.tooltipOptions,g={};g=b,g.data={},g.chartOptions=e;for(var h in this.options.chartOptions)g.data[h]=this.options.getFieldValue?this.options.getFieldValue.call(this,c,h):L.Util.getFieldValue(c,h);for(h in f)g[h]=f[h];var i;return a&&(i=this._getMarker(a,g),i.boundaryLayer=d),i},_getMarker:function(a,b){},_getLegend:function(a){var b=(L.DataLayer.prototype._getLegend.call(this,a),new L.CategoryLegend(this.options.chartOptions));return a=a||this.options.legendOptions,b.generate(a)}}),L.BarChartDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.BarChartMarker(a,b)}}),L.barChartDataLayer=function(a,b){return new L.BarChartDataLayer(a,b)},L.RadialBarChartDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.RadialBarChartMarker(a,b)}}),L.radialBarChartDataLayer=function(a,b){return new L.RadialBarChartDataLayer(a,b)},L.PieChartDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.PieChartMarker(a,b)}}),L.pieChartDataLayer=function(a,b){return new L.PieChartDataLayer(a,b)},L.CoxcombChartDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.CoxcombChartMarker(a,b)}}),L.coxcombChartDataLayer=function(a,b){return new L.CoxcombChartDataLayer(a,b)},L.StackedRegularPolygonDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.StackedRegularPolygonMarker(a,b)}}),L.stackedRegularPolygonDataLayer=function(a,b){return new L.StackedRegularPolygonDataLayer(a,b)},L.StackedPieChartDataLayer=L.ChartDataLayer.extend({initialize:function(a,b){L.ChartDataLayer.prototype.initialize.call(this,a,b)},_getMarker:function(a,b){return new L.StackedPieChartMarker(a,b)}}),L.stackedPieChartDataLayer=function(a,b){return new L.StackedPieChartDataLayer(a,b)},L.RadialMeterMarkerDataLayer=L.DataLayer.extend({options:{showLegendTooltips:!1},initialize:function(a,b){L.DataLayer.prototype.initialize.call(this,a,b)},_getLayer:function(a,b,c){this._addBoundary(a,b),a=this._processLocation(a);var d=this.options.chartOptions,e=this.options.tooltipOptions,f=this.options.displayOptions,g={};g=b,g.data={},g.chartOptions=d,g.displayOptions=f;for(var h in this.options.chartOptions)g.data[h]=L.Util.getFieldValue(c,h);for(h in e)g[h]=e[h];var i;return a&&(i=this._getMarker(a,g)),i},_getMarker:function(a,b){return new L.RadialMeterMarker(a,b)}}),L.radialMeterMarkerDataLayer=function(a,b){return new L.RadialMeterMarkerDataLayer(a,b)},L.CalloutLine=L.Path.extend({statics:{LINESTYLE:{ARC:"arc",ANGLE:"angle",STRAIGHT:"straight"},DIRECTION:{NE:"ne",NW:"nw",SE:"se",SW:"sw"}}}),L.CalloutLine=L.CalloutLine.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.Path.prototype.initialize.call(this,b),this._latlng=a},options:{size:new L.Point(60,30),position:new L.Point(0,0),color:"#FFFFFF",opacity:1,weight:2,fillColor:"#000000",fill:!1,gradient:!1,dropShadow:!1,direction:L.CalloutLine.DIRECTION.NE,lineStyle:L.CalloutLine.LINESTYLE.ANGLE,lineCap:"butt",lineJoin:"miter",arrow:!1},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._points=this._getPoints()},getEndPoint:function(){return this.projectLatlngs(),this._points[this._points.length-1]},_getPathAngle:function(){return new L.SVGPathBuilder(this._points,[],{closePath:!1}).build(6)},_getPathArc:function(){var a=(this.options.direction||L.CalloutLine.DIRECTION.NE).toLowerCase(),b=a[0],c="n"===b?-1:1,d=this._points[0],e=this._points[this._points.length-1],f=["M",d.x,",",d.y," Q",d.x,",",d.y+c*this.options.size.y," ",e.x,",",e.y];return f.join(" ")},_getPoints:function(){var a=this._point.x+this.options.position.x,b=this._point.y+this.options.position.y,c=this.options.size.x,d=this.options.size.y,e=(this.options.direction||L.CalloutLine.DIRECTION.NE).toLowerCase(),f=[],g=e[1],h=e[0],i="w"===g?-1:1,j="n"===h?-1:1;f.push(new L.Point(a,b));var k=b+j*d,l=c/2,m=Math.atan(d/l);if(this.options.lineStyle===L.CalloutLine.LINESTYLE.ARC?m=Math.atan(Math.pow(d,2)/l):this.options.lineStyle===L.CalloutLine.LINESTYLE.STRAIGHT&&(m=Math.atan(d/c)),this._angle=m,this.options.lineStyle!==L.CalloutLine.LINESTYLE.STRAIGHT){var n=new L.Point(a+i*l,k);f.push(n)}var o=new L.Point(a+i*c,k);return f.push(o),f},getBounds:function(){var a=this._map,b=a.project(this._latlng),c=new L.Point(b.x+this.options.position.x,b.y+this.options.position.y),d=new L.Point(c.x+this.options.size.x,c.y-this.options.size.y),e=a.unproject(c),f=a.unproject(d);return new L.LatLngBounds(e,f)},setLatLng:function(a){this._latlng=a,this.redraw()},getLatLng:function(){return this._latlng},getPathString:function(){this._path.setAttribute("shape-rendering","geometricPrecision");var a=this.options.lineStyle||L.CalloutLine.LINESTYLE.ANGLE,b="";return b+=a===L.CalloutLine.LINESTYLE.ANGLE||a===L.CalloutLine.LINESTYLE.STRAIGHT?this._getPathAngle():this._getPathArc()}}),L.calloutLine=function(a,b){return new L.CalloutLine(a,b)},L.Callout=L.LayerGroup.extend({options:{color:"#FFFFFF",fillColor:"#FFFFFF"},initialize:function(a,b){L.Util.setOptions(this,b),L.LayerGroup.prototype.initialize.call(this,b),this._latlng=a},onAdd:function(a){L.LayerGroup.prototype.onAdd.call(this,a),this.addLayers()},onRemove:function(a){L.LayerGroup.prototype.onRemove.call(this,a),this.clearLayers()},addArrow:function(a,b,c){if(this.options.arrow){a=L.LatLng.RAD_TO_DEG*a;var d=this.options.numberOfSides||3,e=this.options.radius||6,f=180/d,g={se:f+a,sw:180+f-a,nw:180+f+a,ne:f-a},h=g[b],i=new L.RegularPolygonMarker(this._latlng,{position:c,numberOfSides:d,rotation:h,fillColor:this.options.fillColor,color:this.options.color,gradient:this.options.gradient,weight:this.options.weight,opacity:this.options.opacity,fillOpacity:this.options.fillOpacity,radius:e,lineCap:"butt",lineJoin:"miter"});this.addLayer(i)}},addLine:function(){var a={};for(var b in this.options)"icon"!==b&&(a[b]=this.options[b]);var c=new L.CalloutLine(this._latlng,a);return this.addLayer(c),c},addIcon:function(a,b){var c=this.options.size,d=this.options.icon,e=d.options.iconSize,f=a[0],g=a[1],h="w"===g?e.x+c.x-b.x:-1*(c.x+b.x),i="n"===f?e.y/2+c.y-b.y:-1*(-e.y/2+c.y+b.y);d.options.iconAnchor=new L.Point(h,i);var j=new L.Marker(this._latlng,{icon:d});this.addLayer(j)},addLayers:function(){var a,b=(this.options.direction||"ne").toLowerCase(),c=this.options.position||new L.Point(0,0);a=this.addLine(),this.addIcon(b,c),this.addArrow(a._angle,b,c)}}),L.callout=function(a,b){return new L.Callout(a,b)},L.FlowLine=L.DataLayer.extend({statics:{LINE_FUNCTION:function(a,b,c){return new L.Polyline([a,b],c)},LINE_FUNCTION_INTERPOLATED:function(a,b,c){var d=this._map.latlngToLayerPoint(a),e=this._map.latlngToLayerPoint(b),f=new L.LinearFunction(d,e),g=Math.ceil(d.distanceTo(e)/c.interpolationOptions.segmentLength);f.samplePoints(g)}}}),L.FlowLine=L.FlowLine.extend({initialize:function(a,b){L.Util.setOptions(this,b),L.DataLayer.prototype.initialize.call(this,a,b)},options:{getLine:L.FlowLine.LINE_FUNCTION,showLegendTooltips:!0,setHighlight:function(a){return a.opacity=a.opacity||1,a.opacity/=1.5,a},unsetHighlight:function(a){return a.opacity=a.opacity||.66,a.opacity*=1.5,a}},onEachSegment:function(a,b,c){var d={};if(this.options.timeField){var e=L.Util.getFieldValue(a,this.options.timeField),f=L.Util.getFieldValue(b,this.options.timeField),g=this.options.timeFormat,h=g?moment(e,g):moment(e),i=g?moment(f,g):moment(f),j=i.valueOf()-h.valueOf();d.time=j}for(var k in this.options.displayOptions){var l=L.Util.getFieldValue(a,k),m=L.Util.getFieldValue(b,k),n=m-l,o=n/l*100;d[k]={from:l,to:m,change:n,percentChange:o},d.time&&(d[k].changeOverTime=n/d.time)}var p,q=c.getLatLngs(),r=q[0].distanceTo(q[1]);d.time&&(p=r/(1e3*d.time)),this.options.onEachSegment&&this.options.onEachSegment.call(this,a,b,c,d,r,p)},_loadRecords:function(a){var b=[];this._lastRecord=null;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];d=this.options.deriveProperties?this.options.deriveProperties(d):d,b=this._addRecord(d,c,b)}for(;b.length>0;)this.addLayer(b.pop())},addRecord:function(a){return this._addRecord(a),this},_addRecord:function(a,b,c){var d=this._getLocation(a,b),e=this.options.layerOptions;if(d){var f,g=this._getLayer(d,e,a),h=!0;this.options.includeLayer&&(h=this.options.includeLayer(a)),this._lastRecord&&h&&(e=this._getDynamicOptions(this._lastRecord),f=this.options.getLine.call(this,this._lastMarker.getLatLng(),g.getLatLng(),e.layerOptions),this.addLayer(f),this.options.showLegendTooltips&&this._bindMouseEvents(f,e.layerOptions,e.legendDetails),this.onEachSegment(this._lastRecord,a,f)),h&&(this._lastRecord=a,this._lastMarker=g)}return c}}),L.flowLine=function(a,b){return new L.FlowLine(a,b)},L.ArcedFlowLine=L.FlowLine.extend({options:{getLine:function(a,b,c){return new L.ArcedPolyline([a,b],c)}},initialize:function(a,b){L.FlowLine.prototype.initialize.call(this,a,b)}}),L.arcedFlowLine=function(a,b){return new L.ArcedFlowLine(a,b)},L.ArcedPolyline=L.Path.extend({includes:TextFunctions,initialize:function(a,b){L.Path.prototype.initialize.call(this,b),this._latlngs=a},options:{distanceToHeight:new L.LinearFunction([0,5],[1e3,200]),color:"#FFFFFF",opacity:1,weight:1,fillColor:"#000000",fill:!1,gradient:!1,dropShadow:!1,optimizeSpeed:!1},projectLatlngs:function(){this._points=[];for(var a=0;a<this._latlngs.length;++a)this._points.push(this._map.latLngToLayerPoint(this._latlngs[a]))},getBounds:function(){for(var a=new L.LatLngBounds,b=0;b<this._latlngs.length;++b)a.extend(this._latlngs[b]);return a},setLatLngs:function(a){this._latlngs=a,this.redraw()},getLatLngs:function(){return this._latlngs},drawSegment:function(a,b){var c=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),d=this.options.distanceToHeight.evaluate(c),e=["M",a.x,",",a.y," C",a.x,",",a.y-d," ",b.x,",",b.y-d," ",b.x,",",b.y];return e.join(" ")},getPathString:function(){this.options.optimizeSpeed&&this._path.setAttribute("shape-rendering","optimizeSpeed");for(var a=[],b=0;b<this._points.length-1;++b)a.push(this.drawSegment(this._points[b],this._points[b+1]));return a.join("")}}),L.arcedPolyline=function(a,b){return new L.ArcedPolyline(a,b)},L.Control.Legend=L.Control.extend({options:{position:"bottomright",autoAdd:!0},onAdd:function(a){var b="leaflet-control-legend",c=L.DomUtil.create("div",b),d=this;return this.options.autoAdd&&(a.on("layeradd",function(a){var b=a.layer;d.addLayer(b)}),a.on("layerremove",function(a){var b=a.layer;d.removeLayer(b)})),this.toggleSize=L.bind(this.toggleSize,this),L.DomEvent.addListener(c,"mouseover",this.toggleSize).addListener(c,"mouseout",this.toggleSize).addListener(c,"touchstart",this.toggleSize).addListener(c,"touchend",this.toggleSize).addListener(c,"click",L.DomEvent.stopPropagation).addListener(c,"click",L.DomEvent.preventDefault),c},clear:function(){this._container.innerHTML=""},toggleSize:function(){L.DomUtil.hasClass(this._container,"larger")?L.DomUtil.removeClass(this._container,"larger"):L.DomUtil.addClass(this._container,"larger")},redrawLayer:function(a){this.removeLayer(a),this.addLayer(a)},addLayer:function(a){var b=L.Util.stamp(a),c=this;a.getLegend&&(this.addLegend(b,a.getLegend()),a.on("legendChanged",function(){c.redrawLayer(a)}))},removeLayer:function(a){var b=L.Util.stamp(a);if(a.getLegend){var c=document.getElementById(b);c.parentNode.removeChild(c),a.off("legendChanged")}},addLegend:function(a,b){var c=this._container,d=document.getElementById(a);d||(d=L.DomUtil.create("div","",c),d.id=a),d.innerHTML=b}}),L.control.legend=function(a){return new L.Control.Legend(a)},function(){L.Control.FullScreen=L.Control.extend({options:{position:"topleft",title:"Full Screen",forceSeparateButton:!1,forcePseudoFullscreen:!1},onAdd:function(a){var b,c="leaflet-control-zoom-fullscreen",d="";return b=a.zoomControl&&!this.options.forceSeparateButton?a.zoomControl._container:L.DomUtil.create("div","leaflet-bar"),this.options.content?d=this.options.content:c+=" fullscreen-icon",this._createButton(this.options.title,c,d,b,this.toggleFullScreen,this),b},_createButton:function(b,c,d,e,f,g){var h=L.DomUtil.create("a",c,e);return h.href="#",h.title=b,h.innerHTML=d,L.DomEvent.addListener(h,"click",L.DomEvent.stopPropagation).addListener(h,"click",L.DomEvent.preventDefault).addListener(h,"click",f,g),L.DomEvent.addListener(e,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(e,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(e,a.fullScreenEventName,this._handleEscKey,g),L.DomEvent.addListener(document,a.fullScreenEventName,L.DomEvent.stopPropagation).addListener(document,a.fullScreenEventName,L.DomEvent.preventDefault).addListener(document,a.fullScreenEventName,this._handleEscKey,g),h},toggleFullScreen:function(){var b=this._map;b._exitFired=!1,b._isFullscreen?(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.cancelFullScreen(b._container.parentElement):L.DomUtil.removeClass(b._container.parentElement,"leaflet-pseudo-fullscreen"),b.invalidateSize(),b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1):(a.supportsFullScreen&&!this.options.forcePseudoFullscreen?a.requestFullScreen(b._container.parentElement):L.DomUtil.addClass(b._container.parentElement,"leaflet-pseudo-fullscreen"),b.invalidateSize(),b.fire("enterFullscreen"),b._isFullscreen=!0)},_handleEscKey:function(){var b=this._map;
a.isFullScreen(b)||b._exitFired||(b.fire("exitFullscreen"),b._exitFired=!0,b._isFullscreen=!1)}}),L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=L.control.fullscreen(this.options.fullscreenControlOptions),this.addControl(this.fullscreenControl))}),L.control.fullscreen=function(a){return new L.Control.FullScreen(a)};var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.exitFullscreen)a.supportsFullScreen=!0;else for(var c=0,d=b.length;d>c;c++)if(a.prefix=b[c],"undefined"!=typeof document[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullscreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(a){return""===this.prefix?document.exitFullscreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var b=jQuery(this);a.supportsFullScreen&&a.requestFullScreen(b)})}),window.fullScreenApi=a}(),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h}),L.SpinMapMixin={spin:function(a,b){a?(this._spinner||(this._spinner=new Spinner(b).spin(this._container),this._spinning=0),this._spinning++):(this._spinning--,this._spinning<=0&&this._spinner&&(this._spinner.stop(),this._spinner=null))}},L.Map.include(L.SpinMapMixin),L.Map.addInitHook(function(){this.on("layeradd",function(a){a.layer.loading&&this.spin(!0),"function"==typeof a.layer.on&&(a.layer.on("data:loading",function(){this.spin(!0)},this),a.layer.on("data:loaded",function(){this.spin(!1)},this))},this),this.on("layerremove",function(a){a.layer.loading&&this.spin(!1),"function"==typeof a.layer.on&&(a.layer.off("data:loaded"),a.layer.off("data:loading"))},this)}),L.Control.ZoomMin=L.Control.Zoom.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out",zoomMinText:"Zoom min",zoomMinTitle:"Zoom min"},onAdd:function(a){var b="leaflet-control-zoom",c=L.DomUtil.create("div",b+" leaflet-bar"),d=this.options;return this._map=a,this._zoomInButton=this._createButton(d.zoomInText,d.zoomInTitle,b+"-in",c,this._zoomIn,this),this._zoomOutButton=this._createButton(d.zoomOutText,d.zoomOutTitle,b+"-out",c,this._zoomOut,this),this._zoomMinButton=this._createButton(d.zoomMinText,d.zoomMinTitle,b+"-min",c,this._zoomMin,this),this._updateDisabled(),a.on("zoomend zoomlevelschange",this._updateDisabled,this),c},_zoomMin:function(){this._map.setView([23.079,3.515],3,{animation:!0})},_updateDisabled:function(){var a=this._map,b="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,b),L.DomUtil.removeClass(this._zoomOutButton,b),L.DomUtil.removeClass(this._zoomMinButton,b),a._zoom===a.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,b),a._zoom===a.getMinZoom()&&L.DomUtil.addClass(this._zoomMinButton,b)}}),L.Control.Sidebar=L.Control.extend({includes:L.Mixin.Events,initialize:function(a,b){var c,d;for(L.setOptions(this,b),this._sidebar=L.DomUtil.get(a),L.Browser.touch&&L.DomUtil.addClass(this._sidebar,"leaflet-touch"),c=this._sidebar.children.length-1;c>=0;c--)d=this._sidebar.children[c],"UL"==d.tagName&&L.DomUtil.hasClass(d,"sidebar-tabs")?this._tabs=d:"DIV"==d.tagName&&L.DomUtil.hasClass(d,"sidebar-content")&&(this._container=d);for(this._tabitems=[],c=this._tabs.children.length-1;c>=0;c--)d=this._tabs.children[c],"LI"==d.tagName&&(this._tabitems.push(d),d._sidebar=this);for(this._panes=[],c=this._container.children.length-1;c>=0;c--)d=this._container.children[c],"DIV"==d.tagName&&L.DomUtil.hasClass(d,"sidebar-pane")&&this._panes.push(d)},addTo:function(a){this._map=a;for(var b="click",c=this._tabitems.length-1;c>=0;c--){var d=this._tabitems[c];L.DomEvent.on(d.firstChild,b,this._onClick,d)}return this},removeFrom:function(a){this._map=null;for(var b="click",c=this._tabitems.length-1;c>=0;c--){var d=this._tabitems[c];L.DomEvent.off(d.firstChild,b,this._onClick)}return this},open:function(a){var b,c;for(b=this._panes.length-1;b>=0;b--)c=this._panes[b],c.id==a?L.DomUtil.addClass(c,"active"):L.DomUtil.hasClass(c,"active")&&L.DomUtil.removeClass(c,"active");for(b=this._tabitems.length-1;b>=0;b--){c=this._tabitems[b];c.firstChild.id;c.firstChild.id=="#"+a?L.DomUtil.addClass(c,"active"):L.DomUtil.hasClass(c,"active")&&L.DomUtil.removeClass(c,"active")}return this.fire("content",{id:a}),L.DomUtil.hasClass(this._sidebar,"collapsed")&&(this.fire("opening"),L.DomUtil.removeClass(this._sidebar,"collapsed")),this},close:function(){for(var a=this._tabitems.length-1;a>=0;a--){var b=this._tabitems[a];L.DomUtil.hasClass(b,"active")&&L.DomUtil.removeClass(b,"active")}return L.DomUtil.hasClass(this._sidebar,"collapsed")||(this.fire("closing"),L.DomUtil.addClass(this._sidebar,"collapsed")),this},_onClick:function(a){L.DomUtil.hasClass(this,"active")?this._sidebar.close():this._sidebar.open(this.firstChild.id.slice(1))}}),L.control.sidebar=function(a,b){return new L.Control.Sidebar(a,b)},+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.toggle"),f="object"==typeof b&&b;e||d.data("bs.toggle",e=new c(this,f)),"string"==typeof b&&e[b]&&e[b]()})}var c=function(b,c){this.$element=a(b),this.options=a.extend({},this.defaults(),c),this.render()};c.VERSION="2.2.0",c.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:"",width:null,height:null},c.prototype.defaults=function(){return{on:this.$element.attr("data-on")||c.DEFAULTS.on,off:this.$element.attr("data-off")||c.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||c.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||c.DEFAULTS.offstyle,size:this.$element.attr("data-size")||c.DEFAULTS.size,style:this.$element.attr("data-style")||c.DEFAULTS.style,width:this.$element.attr("data-width")||c.DEFAULTS.width,height:this.$element.attr("data-height")||c.DEFAULTS.height}},c.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var b="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",c=a('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+b),d=a('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+b+" active"),e=a('<span class="toggle-handle btn btn-default">').addClass(b),f=a('<div class="toggle-group">').append(c,d,e),g=a('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(b).addClass(this.options.style);this.$element.wrap(g),a.extend(this,{$toggle:this.$element.parent(),$toggleOn:c,$toggleOff:d,$toggleGroup:f}),this.$toggle.append(f);var h=(this.options.width||Math.max(c.outerWidth(),d.outerWidth())+e.outerWidth()/2,this.options.height||Math.max(c.outerHeight(),d.outerHeight()));c.addClass("toggle-on"),d.addClass("toggle-off"),this.$toggle.css({height:h}),this.options.height&&(c.css("line-height",c.height()+"px"),d.css("line-height",d.height()+"px")),this.update(!0),this.trigger(!0)},c.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},c.prototype.on=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),void(a||this.trigger()))},c.prototype.off=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),void(a||this.trigger()))},c.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},c.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},c.prototype.update=function(a){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(a):this.off(a)},c.prototype.trigger=function(b){this.$element.off("change.bs.toggle"),b||this.$element.change(),this.$element.on("change.bs.toggle",a.proxy(function(){this.update()},this))},c.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var d=a.fn.bootstrapToggle;a.fn.bootstrapToggle=b,a.fn.bootstrapToggle.Constructor=c,a.fn.toggle.noConflict=function(){return a.fn.bootstrapToggle=d,this},a(function(){a("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),a(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(b){var c=a(this).find("input[type=checkbox]");c.bootstrapToggle("toggle"),b.preventDefault()})}(jQuery),function(a){if("function"==typeof define&&define.amd)define(["jquery"],a);else if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports){var b;try{b=require("jquery")}catch(c){b=null}module.exports=a(b)}else window&&(window.bslider=a(window.jQuery))}(function(a){var b;return function(a){"use strict";function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function c(b,c){function d(a,b){var c="data-bslider-"+b.replace(/_/g,"-"),d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b),c=c?c:{};for(var f=Object.keys(this.defaultOptions),g=0;g<f.length;g++){var h=f[g],i=c[h];i="undefined"!=typeof i?i:d(this.element,h),i=null!==i?i:this.defaultOptions[h],this.options||(this.options={}),this.options[h]=i}"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.tooltip_position="right";var j,k,l,m,n,o=this.element.style.width,p=!1,q=this.element.parentNode;if(this.bsliderElem)p=!0;else{this.bsliderElem=document.createElement("div"),this.bsliderElem.className="bslider";var r=document.createElement("div");r.className="bslider-track",k=document.createElement("div"),k.className="bslider-track-low",j=document.createElement("div"),j.className="bslider-selection",l=document.createElement("div"),l.className="bslider-track-high",m=document.createElement("div"),m.className="bslider-handle min-bslider-handle",m.setAttribute("role","bslider"),m.setAttribute("aria-valuemin",this.options.min),m.setAttribute("aria-valuemax",this.options.max),n=document.createElement("div"),n.className="bslider-handle max-bslider-handle",n.setAttribute("role","bslider"),n.setAttribute("aria-valuemin",this.options.min),n.setAttribute("aria-valuemax",this.options.max),r.appendChild(k),r.appendChild(j),r.appendChild(l);var s=Array.isArray(this.options.labelledby);if(s&&this.options.labelledby[0]&&m.setAttribute("aria-labelledby",this.options.labelledby[0]),s&&this.options.labelledby[1]&&n.setAttribute("aria-labelledby",this.options.labelledby[1]),!s&&this.options.labelledby&&(m.setAttribute("aria-labelledby",this.options.labelledby),n.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(g=0;g<this.options.ticks.length;g++){var t=document.createElement("div");t.className="bslider-tick",this.ticks.push(t),r.appendChild(t)}j.className+=" tick-bslider-selection"}if(r.appendChild(m),r.appendChild(n),this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="bslider-tick-label-container",g=0;g<this.options.ticks_labels.length;g++){var u=document.createElement("div"),v=0===this.options.ticks_positions.length,w=this.options.reversed&&v?this.options.ticks_labels.length-(g+1):g;u.className="bslider-tick-label",u.innerHTML=this.options.ticks_labels[w],this.tickLabels.push(u),this.tickLabelContainer.appendChild(u)}var x=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},y=document.createElement("div");y.className="tooltip tooltip-main",y.setAttribute("role","presentation"),x(y);var z=document.createElement("div");z.className="tooltip tooltip-min",z.setAttribute("role","presentation"),x(z);var A=document.createElement("div");A.className="tooltip tooltip-max",A.setAttribute("role","presentation"),x(A),this.bsliderElem.appendChild(r),this.bsliderElem.appendChild(y),this.bsliderElem.appendChild(z),this.bsliderElem.appendChild(A),this.tickLabelContainer&&this.bsliderElem.appendChild(this.tickLabelContainer),q.insertBefore(this.bsliderElem,this.element),this.element.style.display="none"}if(a&&(this.$element=a(this.element),this.$bsliderElem=a(this.bsliderElem)),this.eventToCallbackMap={},this.bsliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.bsliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.bsliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.bsliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),e[this.options.scale]&&(this.options.scale=e[this.options.scale]),p===!0&&(this._removeClass(this.bsliderElem,"bslider-horizontal"),this._removeClass(this.bsliderElem,"bslider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackLow,a),this._removeProperty(this.trackSelection,a),this._removeProperty(this.trackHigh,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.bsliderElem,"bslider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.bsliderElem,"bslider-horizontal"),this.bsliderElem.style.width=o,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this._settooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=k||this.trackLow,this.trackSelection=j||this.trackSelection,this.trackHigh=l||this.trackHigh,"none"===this.options.selection&&(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")),this.handle1=m||this.handle1,this.handle2=n||this.handle2,p===!0)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),g=0;g<this.ticks.length;g++)this._removeClass(this.ticks[g],"round triangle hide");var B=["round","triangle","custom"],C=-1!==B.indexOf(this.options.handle);if(C)for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),g=0;g<this.ticks.length;g++)this._addClass(this.ticks[g],this.options.handle);this._state.offset=this._offset(this.bsliderElem),this._state.size=this.bsliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable&&(this.bsliderElem.addEventListener("touchstart",this.touchstart,!1),this.bsliderElem.addEventListener("touchmove",this.touchmove,!1)),this.bsliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showtooltip(),this._alwaysShowtooltip=!0):(this.showtooltip=this._showtooltip.bind(this),this.hidetooltip=this._hidetooltip.bind(this),this.bsliderElem.addEventListener("mouseenter",this.showtooltip,!1),this.bsliderElem.addEventListener("mouseleave",this.hidetooltip,!1),this.handle1.addEventListener("focus",this.showtooltip,!1),this.handle1.addEventListener("blur",this.hidetooltip,!1),this.handle2.addEventListener("focus",this.showtooltip,!1),this.handle2.addEventListener("blur",this.hidetooltip,!1)),this.options.enabled?this.enable():this.disable()}var d={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotbsliderInstance:"Calling context element does not have instance of bslider bound to it. Check your code to make sure the JQuery object returned from the call to the bslider() initializer is calling the method"},e={linear:{toValue:function(a){var b=a/100*(this.options.max-this.options.min),c=!0;if(this.options.ticks_positions.length>0){for(var d,e,f,g=0,h=1;h<this.options.ticks_positions.length;h++)if(a<=this.options.ticks_positions[h]){d=this.options.ticks[h-1],f=this.options.ticks_positions[h-1],e=this.options.ticks[h],g=this.options.ticks_positions[h];break}var i=(a-f)/(g-f);b=d+i*(e-d),c=!1}var j=c?this.options.min:0,k=j+Math.round(b/this.options.step)*this.options.step;return k<this.options.min?this.options.min:k>this.options.max?this.options.max:k},toPercentage:function(a){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var b,c,d,e=0,f=0;f<this.options.ticks.length;f++)if(a<=this.options.ticks[f]){b=f>0?this.options.ticks[f-1]:0,d=f>0?this.options.ticks_positions[f-1]:0,c=this.options.ticks[f],e=this.options.ticks_positions[f];break}if(f>0){var g=(a-b)/(c-b);return d+g*(e-d)}}return 100*(a-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(a){var b=0===this.options.min?0:Math.log(this.options.min),c=Math.log(this.options.max),d=Math.exp(b+(c-b)*a/100);return d=this.options.min+Math.round((d-this.options.min)/this.options.step)*this.options.step,d<this.options.min?this.options.min:d>this.options.max?this.options.max:d},toPercentage:function(a){if(this.options.max===this.options.min)return 0;var b=Math.log(this.options.max),c=0===this.options.min?0:Math.log(this.options.min),d=0===a?0:Math.log(a);return 100*(d-c)/(b-c)}}};if(b=function(a,b){return c.call(this,a,b),this},b.prototype={_init:function(){},constructor:b,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return Array.isArray(a)?a[0]+" : "+a[1]:a},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,scale:"linear",focus:!1,tooltip_position:null,labelledby:null},getElement:function(){return this.bsliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(a,b,c){a||(a=0);var d=this.getValue();this._state.value=this._validateInputValue(a);var e=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=e(this._state.value[0]),this._state.value[1]=e(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=e(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var f=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(f),b===!0&&this._trigger("slide",f),d!==f&&c===!0&&this._trigger("change",{oldValue:d,newValue:f}),this},destroy:function(){this._removebsliderEventHandlers(),this.bsliderElem.parentNode.removeChild(this.bsliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("bslider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.bsliderElem,"bslider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.bsliderElem,"bslider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(a,b){return this._bindNonQueryEventHandler(a,b),this},off:function(b,c){a?(this.$element.off(b,c),this.$bsliderElem.off(b,c)):this._unbindNonQueryEventHandler(b,c)},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removebsliderEventHandlers(),c.call(this,this.element,this.options),a&&a.data(this.element,"bslider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removebsliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.showtooltip&&(this.handle1.removeEventListener("focus",this.showtooltip,!1),this.handle2.removeEventListener("focus",this.showtooltip,!1)),this.hidetooltip&&(this.handle1.removeEventListener("blur",this.hidetooltip,!1),this.handle2.removeEventListener("blur",this.hidetooltip,!1)),this.showtooltip&&this.bsliderElem.removeEventListener("mouseenter",this.showtooltip,!1),this.hidetooltip&&this.bsliderElem.removeEventListener("mouseleave",this.hidetooltip,!1),this.bsliderElem.removeEventListener("touchstart",this.touchstart,!1),this.bsliderElem.removeEventListener("touchmove",this.touchmove,!1),this.bsliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(a,b){void 0===this.eventToCallbackMap[a]&&(this.eventToCallbackMap[a]=[]),this.eventToCallbackMap[a].push(b)},_unbindNonQueryEventHandler:function(a,b){var c=this.eventToCallbackMap[a];if(void 0!==c)for(var d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showtooltip:function(){this.options.tooltip_split===!1?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hidetooltip:function(){this._state.inDrag===!1&&this.alwaysShowtooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),this.handle2.style[this.stylePos]=a[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var b="vertical"===this.options.orientation?"height":"width",c="vertical"===this.options.orientation?"marginTop":"marginLeft",d=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var e=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[c]=-d/2+"px"),e=this.tickLabelContainer.offsetHeight;else for(f=0;f<this.tickLabelContainer.childNodes.length;f++)this.tickLabelContainer.childNodes[f].offsetHeight>e&&(e=this.tickLabelContainer.childNodes[f].offsetHeight);"horizontal"===this.options.orientation&&(this.bsliderElem.style.marginBottom=e+"px")}for(var f=0;f<this.options.ticks.length;f++){var g=this.options.ticks_positions[f]||this._toPercentage(this.options.ticks[f]);this.options.reversed&&(g=100-g),this.ticks[f].style[this.stylePos]=g+"%",this._removeClass(this.ticks[f],"in-selection"),this.options.range?g>=a[0]&&g<=a[1]&&this._addClass(this.ticks[f],"in-selection"):"after"===this.options.selection&&g>=a[0]?this._addClass(this.ticks[f],"in-selection"):"before"===this.options.selection&&g<=a[0]&&this._addClass(this.ticks[f],"in-selection"),this.tickLabels[f]&&(this.tickLabels[f].style[b]=d+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[f]?(this.tickLabels[f].style.position="absolute",this.tickLabels[f].style[this.stylePos]=g+"%",this.tickLabels[f].style[c]=-d/2+"px"):"vertical"===this.options.orientation&&(this.tickLabels[f].style.marginLeft=this.bsliderElem.offsetWidth+"px",this.tickLabelContainer.style.marginTop=this.bsliderElem.offsetWidth/2*-1+"px"))}}var h;if(this.options.range){h=this.options.formatter(this._state.value),this._setText(this.tooltipInner,h),
this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var i=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,i);var j=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,j),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else h=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,h),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(a[0],a[1])+"%",this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";else{this.trackLow.style.left="0",this.trackLow.style.width=Math.min(a[0],a[1])+"%",this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";var k=this.tooltip_min.getBoundingClientRect(),l=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?k.right>l.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):k.right>l.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_resize:function(a){this._state.offset=this._offset(this.bsliderElem),this._state.size=this.bsliderElem[this.sizePos],this._layout()},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.bsliderElem),this._state.size=this.bsliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this._state.percentage[0]-b),d=Math.abs(this._state.percentage[1]-b);this._state.dragged=d>c?0:1}else this._state.dragged=0;this._state.percentage[this._state.dragged]=b,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e,!1,!0),this._pauseEvent(a),this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(a){if(void 0===a.changedTouches)return void this._mousedown(a);var b=a.changedTouches[0];this.touchX=b.pageX,this.touchY=b.pageY},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this._state.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-c)}var f=this._state.value[a]+c*this.options.step;return this.options.range&&(f=[a?this._state.value[0]:f,a?f:this._state.value[1]]),this._trigger("slideStart",f),this._setDataVal(f),this.setValue(f,!0,!0),this._setDataVal(f),this._trigger("slideStop",f),this._layout(),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){if(!this._state.enabled)return!1;var b=this._getPercentage(a);this._adjustPercentageForRangebsliders(b),this._state.percentage[this._state.dragged]=b,this._layout();var c=this._calculateValue(!0);return this.setValue(c,!0,!0),!1},_touchmove:function(a){if(void 0!==a.changedTouches){var b=a.changedTouches[0],c=b.pageX-this.touchX,d=b.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&5>=c&&c>=-5&&(d>=15||-15>=d)?this._mousedown(a):5>=d&&d>=-5&&(c>=15||-15>=c)&&this._mousedown(a))}},_adjustPercentageForRangebsliders:function(a){if(this.options.range){var b=this._getNumDigitsAfterDecimalPlace(a);b=b?b-1:0;var c=this._applyToFixedAndParseFloat(a,b);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],b)<c?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],b)>c&&(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0)}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,this._state.over===!1&&this._hidetooltip();var a=this._calculateValue(!0);return this._layout(),this._setDataVal(a),this._trigger("slideStop",a),!1},_calculateValue:function(a){var b;if(this.options.range?(b=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(b[0]=this._toValue(this._state.percentage[0]),b[0]=this._applyPrecision(b[0])),100!==this._state.percentage[1]&&(b[1]=this._toValue(this._state.percentage[1]),b[1]=this._applyPrecision(b[1]))):(b=this._toValue(this._state.percentage[0]),b=parseFloat(b),b=this._applyPrecision(b)),a){for(var c=[b,1/0],d=0;d<this.options.ticks.length;d++){var e=Math.abs(this.options.ticks[d]-b);e<=c[1]&&(c=[this.options.ticks[d],e])}if(c[1]<=this.options.ticks_snap_bounds)return c[0]}return b},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=a[this.mousePos],c=this._state.offset[this.stylePos],d=b-c,e=d/this._state.size*100;return e=Math.round(e/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(e=100-e),Math.max(0,Math.min(100,e))},_validateInputValue:function(a){if("number"==typeof a)return a;if(Array.isArray(a))return this._validateArray(a),a;throw new Error(d.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"!=typeof c)throw new Error(d.formatInvalidInputErrorMsg(c))}},_setDataVal:function(a){this.element.setAttribute("data-value",a),this.element.setAttribute("value",a),this.element.value=a},_trigger:function(b,c){c=c||0===c?c:void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$bsliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$bsliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.textContent?a.textContent=b:"undefined"!=typeof a.innerText&&(a.innerText=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offsetLeft:function(a){return a.getBoundingClientRect().left},_offsetTop:function(a){for(var b=a.offsetTop;(a=a.offsetParent)&&!isNaN(a.offsetTop);)b+=a.offsetTop,"BODY"!==a.tagName&&(b-=a.scrollTop);return b},_offset:function(a){return{left:this._offsetLeft(a),top:this._offsetTop(a)}},_css:function(b,c,d){if(a)a.style(b,c,d);else{var e=c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(a,b){return b.toUpperCase()});b.style[e]=d}},_toValue:function(a){return this.options.scale.toValue.apply(this,[a])},_toPercentage:function(a){return this.options.scale.toPercentage.apply(this,[a])},_settooltipPosition:function(){var a=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var b=this.options.tooltip_position||"right",c="left"===b?"right":"left";a.forEach(function(a){this._addClass(a,b),a.style[c]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?a.forEach(function(a){this._addClass(a,"bottom"),a.style.top="22px"}.bind(this)):a.forEach(function(a){this._addClass(a,"top"),a.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},a){var f=a.fn.bslider?"bootstrapbslider":"bslider";a.bridget(f,b),a(function(){a("input[data-provide=bslider]")[f]()})}}(a),b}),BITS=[16,8,4,2,1],BASE32="0123456789bcdefghjkmnpqrstuvwxyz",NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},NEIGHBORS.bottom.odd=NEIGHBORS.left.even,NEIGHBORS.top.odd=NEIGHBORS.right.even,NEIGHBORS.left.odd=NEIGHBORS.bottom.even,NEIGHBORS.right.odd=NEIGHBORS.top.even,BORDERS.bottom.odd=BORDERS.left.even,BORDERS.top.odd=BORDERS.right.even,BORDERS.left.odd=BORDERS.bottom.even,BORDERS.right.odd=BORDERS.top.even;for(var BASE32_CODES="0123456789bcdefghjkmnpqrstuvwxyz",BASE32_CODES_DICT={},i=0;i<BASE32_CODES.length;i++)BASE32_CODES_DICT[BASE32_CODES.charAt(i)]=i;var ENCODE_AUTO="auto",SIGFIG_HASH_LENGTH=[0,5,7,8,11,12,13,15,16,17,18],encode=function(a,b,c){if(c===ENCODE_AUTO){if("number"==typeof a||"number"==typeof b)throw new Error("string notation required for auto precision.");var d=a.split(".")[1].length,e=b.split(".")[1].length,f=Math.max(d,e);c=SIGFIG_HASH_LENGTH[f]}else void 0===c&&(c=9);for(var g,h=[],i=0,j=0,k=0,l=90,m=-90,n=180,o=-180;h.length<c;)if(j%2===0?(g=(n+o)/2,b>g?(k=(k<<1)+1,o=g):(k=(k<<1)+0,n=g)):(g=(l+m)/2,a>g?(k=(k<<1)+1,m=g):(k=(k<<1)+0,l=g)),i++,j++,5===i){var p=BASE32_CODES[k];h.push(p),i=0,k=0}return h.join("")},encode_int=function(a,b,c){c=c||52;for(var d,e=0,f=90,g=-90,h=180,i=-180,j=0;c>e;)j*=2,e%2===0?(d=(h+i)/2,b>d?(j+=1,i=d):h=d):(d=(f+g)/2,a>d?(j+=1,g=d):f=d),e++;return j},decode_bbox=function(a){for(var b,c=!0,d=90,e=-90,f=180,g=-180,h=0,i=0,j=a.length;j>i;i++){var k=a[i].toLowerCase();h=BASE32_CODES_DICT[k];for(var l=4;l>=0;l--){var m=h>>l&1;c?(b=(f+g)/2,1===m?g=b:f=b):(b=(d+e)/2,1===m?e=b:d=b),c=!c}}return[e,g,d,f]},decode_bbox_int=function(a,b){b=b||52;for(var c=90,d=-90,e=180,f=-180,g=0,h=0,i=b/2,j=0;i>j;j++)h=get_bit(a,2*(i-j)-1),g=get_bit(a,2*(i-j)-2),0===g?c=(c+d)/2:d=(c+d)/2,0===h?e=(e+f)/2:f=(e+f)/2;return[d,f,c,e]},decode=function(a){var b=decode_bbox(a),c=(b[0]+b[2])/2,d=(b[1]+b[3])/2,e=b[2]-c,f=b[3]-d;return{latitude:c,longitude:d,error:{latitude:e,longitude:f}}},decode_int=function(a,b){var c=decode_bbox_int(a,b),d=(c[0]+c[2])/2,e=(c[1]+c[3])/2,f=c[2]-d,g=c[3]-e;return{latitude:d,longitude:e,error:{latitude:f,longitude:g}}},neighbor=function(a,b){var c=decode(a),d=c.latitude+b[0]*c.error.latitude*2,e=c.longitude+b[1]*c.error.longitude*2;return encode(d,e,a.length)},neighbor_int=function(a,b,c){c=c||52;var d=decode_int(a,c),e=d.latitude+b[0]*d.error.latitude*2,f=d.longitude+b[1]*d.error.longitude*2;return encode_int(e,f,c)},neighbors=function(a){function b(a,b){return c=g+a*i,d=h+b*j,encode(c,d,e)}var c,d,e=a.length,f=decode(a),g=f.latitude,h=f.longitude,i=2*f.error.latitude,j=2*f.error.longitude,k=[b(1,0),b(1,1),b(0,1),b(-1,1),b(-1,0),b(-1,-1),b(0,-1),b(1,-1)];return k},neighbors_int=function(a,b){function c(a,c){return d=g+a*i,e=h+c*j,encode_int(d,e,b)}b=b||52;var d,e,f=decode_int(a,b),g=f.latitude,h=f.longitude,i=2*f.error.latitude,j=2*f.error.longitude,k=[c(1,0),c(1,1),c(0,1),c(-1,1),c(-1,0),c(-1,-1),c(0,-1),c(1,-1)];return k},bboxes=function(a,b,c,d,e){e=e||9;for(var f=encode(a,b,e),g=encode(c,d,e),h=decode(f),i=2*h.error.latitude,j=2*h.error.longitude,k=decode_bbox(f),l=decode_bbox(g),m=Math.round((l[0]-k[0])/i),n=Math.round((l[1]-k[1])/j),o=[],p=0;m>=p;p++)for(var q=0;n>=q;q++)o.push(neighbor(f,[p,q]));return o},bboxes_int=function(a,b,c,d,e){e=e||52;for(var f=encode_int(a,b,e),g=encode_int(c,d,e),h=decode_int(f,e),i=2*h.error.latitude,j=2*h.error.longitude,k=decode_bbox_int(f,e),l=decode_bbox_int(g,e),m=Math.round((l[0]-k[0])/i),n=Math.round((l[1]-k[1])/j),o=[],p=0;m>=p;p++)for(var q=0;n>=q;q++)o.push(neighbor_int(f,[p,q],e));return o},geohash={ENCODE_AUTO:ENCODE_AUTO,encode:encode,encode_uint64:encode_int,encode_int:encode_int,decode:decode,decode_int:decode_int,decode_uint64:decode_int,decode_bbox:decode_bbox,decode_bbox_uint64:decode_bbox_int,decode_bbox_int:decode_bbox_int,neighbor:neighbor,neighbor_int:neighbor_int,neighbors:neighbors,neighbors_int:neighbors_int,bboxes:bboxes,bboxes_int:bboxes_int};L.Control.EasyButtons=L.Control.extend({options:{position:"bottomright",title:"",intendedIcon:"fa-circle-o"},onAdd:function(){var a=L.DomUtil.create("div","leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-bar-part",a),this._addImage(),this.link.href="#",L.DomEvent.on(this.link,"click",this._click,this),this.link.title=this.options.title,a},intendedFunction:function(){alert("no function selected")},_click:function(a){L.DomEvent.stopPropagation(a),L.DomEvent.preventDefault(a),this.intendedFunction(),this.link.blur()},_addImage:function(){var a=0===this.options.intendedIcon.lastIndexOf("fa",0)?" fa fa-lg":" glyphicon",b=L.DomUtil.create("i",this.options.intendedIcon+a,this.link);b.id=this.options.id}}),L.easyButton=function(a,b,c,d,e){var f=new L.Control.EasyButtons;return a&&(f.options.intendedIcon=a),e&&(f.options.id=e),"function"==typeof b&&(f.intendedFunction=b),c&&(f.options.title=c),""===d||(d?d.addControl(f):map.addControl(f)),f},L.Control.MapLegend=L.Control.extend({options:{position:"bottomright",numberOfColors:20,sortType:"color",lum:.7},addLegendIcon:function(){this._legendDiv=L.DomUtil.create("div","info legend"),legendDiv=this._legendDiv,L.easyButton("fa-info",function(){L.DomUtil.hasClass(legendDiv,"active")?(legend.removeFrom(map),L.DomUtil.removeClass(legendDiv,"active")):(legend.addTo(map),L.DomUtil.addClass(legendDiv,"active"))},"Toggle legend ON of OFF")},sortHashByValue:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push([c,a[c]]);return b.sort(function(a,b){return b[1]-a[1]}),b},generatePalette:function(a){for(var b=[],c=[],d=["#FFB300","#803E75","#FF6800","#A6BDD7","#C10020","#CEA262","#817066","#007D34","#F6768E","#00538A","#FF7A5C","#53377A","#FF8E00","#B32851","#F4C800","#7F180D","#93AA00","#593315","#F13A13","#232C16"],e=a.length,f=e,g=0;g<this.options.numberOfColors;g++)if("undefined"!=typeof a[g]){var h=a[g][0];b[h]=d[g],e--}c=b;var i=.5/e;this.lum=.7;for(var j=0;e>j;j++){var k=f-e+j,h=a[k][0];b[h]=this.colorLuminance("#FFFFFF",-this.lum),this.lum-=i}return b.Unknown="black",c.Unknown="black",[b,c]},Color:function(a){this.hex=a},constructColor:function(a){var b=a.hex.substring(1),c=parseInt(b.substring(0,2),16)/255,d=parseInt(b.substring(2,4),16)/255,e=parseInt(b.substring(4,6),16)/255,f=Math.max.apply(Math,[c,d,e]),g=Math.min.apply(Math,[c,d,e]),h=f-g,i=0,j=f,k=0;return j>0&&(k=h/j,k>0&&(c==f?(i=60*((d-g-(e-g))/h),0>i&&(i+=360)):d==f?i=120+60*((e-g-(c-g))/h):e==f&&(i=240+60*((c-g-(d-g))/h)))),a.chroma=h,a.hue=i,a.sat=k,a.val=j,a.luma=.3*c+.59*d+.11*e,a.red=parseInt(b.substring(0,2),16),a.green=parseInt(b.substring(2,4),16),a.blue=parseInt(b.substring(4,6),16),a},sortColorsByHue:function(a){var b=[],c={};for(var d in a)a.hasOwnProperty(d)&&b.push([d,a[d]]);b.sort(function(a,b){return a=a[1],b=b[1],a.hue-b.hue});for(var e=0;e<b.length;e++){var f=b[e][0],g=b[e][1];c[f]=g.hex}return c},colorLuminance:function(a,b){"use strict";a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},outputColors:function(a){var b={},c=1;for(var d in palette)if(palette.hasOwnProperty(d)){if(c>legendSpecies)break;var e=new this.Color(palette[d]);this.constructColor(e),b[d]=e,c++}return this.sortColorsByHue(b)},generateHTML:function(a){var b="",c=1;for(var d in a)if(a.hasOwnProperty(d)){var e=d.replace(/^(\w{2})\S+\s(\w+)/,"$1. $2");b+='<span class="active-legend" type="Taxonomy" value="'+d+'"> <i style="background:'+a[d]+';" title="'+d+'"></i> '+(d?"<em>"+e+"</em><br>":"+"),b+="</span>",c++}var f="radial-gradient("+this.colorLuminance("#FFFFFF",-.7)+", "+this.colorLuminance("#FFFFFF",-this.lum)+")";if(b+='<i style="background:'+f+';"></i> Others<br />',$("#legend").html(b),"ir"===$("#view-mode").val()){b+='<div class="data-layer-legend" style="border: 0">',b+="<p>Resistance</p>",b+='<div class="min-value" style="border: 0">Low</div>',b+='<div class="scale-bars">';var g=L.ColorBrewer.Diverging.RdYlBu[10].slice();$.each(g.reverse(),function(a,c){b+='<i style="margin: 0; border-radius: 0; border: 0; color: '+c+"; width: 10px; background-color: "+c+' ;"></i>'}),b+='</div><div class="max-value" style="border: 0;">High</div></div><p style="font-size: smaller; word-wrap: break-word; width: 200px; margin-top: 20px;">Values have been rescaled globally and only give a relative indication of resistance/susceptibility</p>'}legend.onAdd=function(a){return this._legendDiv.innerHTML=b,this._legendDiv},L.DomUtil.hasClass(this._legendDiv,"active")&&(legend.removeFrom(map),legend.addTo(map))},populateLegend:function(a,b){var c="geohash_2";b||(b="species_category");var d=c+","+b,e=a.facet_counts.facet_pivot[d],f=[];for(var g in e)if(e.hasOwnProperty(g)){var h=e[g].count,i=e[g].pivot;for(var j in i)if(i.hasOwnProperty(j)){var k,l=i[j].count/h,m=i[j].value,n=parseInt(j);switch(n){case 1:k=7*l;break;case 2:k=3*l;break;case 3:k=1*l;break;default:k=0}f.hasOwnProperty(m)?f[m]+=k:f[m]=k}}var o=this.sortHashByValue(f),p=[],q=[];p=this.generatePalette(o),palette=p[0],q=p[1];var r=[];r="name"===this.options.sortType?q:this.outputColors(q),this.generateHTML(r),loadSolr({clear:1,zoomLevel:map.getZoom()})}}),L.control.legend=function(a,b){var c=new L.Control.MapLegend(b);return c.addLegendIcon(),$.getJSON(a,function(a){c.populateLegend(a,"species_category")}),c},L.Icon.Canvas=L.Icon.extend({options:{iconSize:new L.Point(20,20),className:"leaflet-canvas-icon",population:0,stats:[]},createIcon:function(){var a=document.createElement("canvas");this._setIconStyles(a,"icon");var b=this.options.iconSize;this.options.population;return a.width=b.x,a.height=b.y,a.id=this.options.id,this.draw(a.getContext("2d"),b.x,b.y),a},createShadow:function(){return null},draw:function(a,b,c){var d=this.options.iconSize.x,e=d/2,f=d/2.5,g=2*Math.PI,h=1.5*Math.PI;for(var i in this.options.stats)if(this.options.stats.hasOwnProperty(i)){var j=this.options.stats[i]/this.options.population;if(j>0){a.beginPath(),a.moveTo(e,e),palette.hasOwnProperty(i)?a.fillStyle=palette[i]:a.fillStyle=palette.others;var k=h,l=h+j*g;k>l&&(k=h),a.arc(e,e,e,k,l),h+=j*g,a.lineTo(e,e),a.fill(),a.closePath()}}a.beginPath(),a.fillStyle="white",a.arc(e,e,f,0,2*Math.PI),a.fill(),a.closePath();var m=markerColor(this.options.trafficlight);"ir"===$("#view-mode").val()&&(a.beginPath(),a.fillStyle=m[0],a.arc(e,e,e-7,0,2*Math.PI),a.fill(),a.closePath()),a.fillStyle="ir"===$("#view-mode").val()?m[1]:"#555",a.textAlign="center",a.textBaseline="middle",a.font="bold 12px sans-serif",a.fillText(this.options.population,e,e,d)}});var nv=window.nv||{};window.nv=nv,nv.dev=!1,nv.tooltip=nv.tooltip||{},nv.utils=nv.utils||{},nv.models=nv.models||{},nv.charts={},nv.graphs=[],nv.logs={},nv.dispatch=d3.dispatch("render_start","render_end"),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),nv.dev&&(nv.dispatch.on("render_start",function(a){nv.logs.startTime=+new Date}),nv.dispatch.on("render_end",function(a){nv.logs.endTime=+new Date,nv.logs.totalTime=nv.logs.endTime-nv.logs.startTime,nv.log("total",nv.logs.totalTime)})),nv.log=function(){if(nv.dev&&window.console&&console.log&&console.log.apply)console.log.apply(console,arguments);else if(nv.dev&&window.console&&"function"==typeof console.log&&Function.prototype.bind){var a=Function.prototype.bind.call(console.log,console);a.apply(console,arguments)}return arguments[arguments.length-1]},nv.deprecated=function(a){nv.dev&&console&&console.warn&&console.warn("`"+a+"` has been deprecated.")},nv.render=function(a){a=a||1,nv.render.active=!0,nv.dispatch.render_start(),setTimeout(function(){for(var b,c,d=0;a>d&&(c=nv.render.queue[d]);d++)b=c.generate(),typeof c.callback==typeof Function&&c.callback(b),nv.graphs.push(b);nv.render.queue.splice(0,d),nv.render.queue.length?setTimeout(arguments.callee,0):(nv.dispatch.render_end(),nv.render.active=!1)},0)},nv.render.active=!1,nv.render.queue=[],nv.addGraph=function(a){typeof arguments[0]==typeof Function&&(a={generate:arguments[0],callback:arguments[1]}),nv.render.queue.push(a),nv.render.active||nv.render()},nv.interactiveGuideline=function(){"use strict";function a(k){k.each(function(k){function l(){var c=d3.mouse(this),d=c[0],h=c[1],i=!0,k=!1;if(j&&(d=d3.event.offsetX,h=d3.event.offsetY,"svg"!==d3.event.target.tagName&&(i=!1),d3.event.target.className.baseVal.match("nv-legend")&&(k=!0)),i&&(d-=e.left,h-=e.top),0>d||0>h||d>n||h>o||d3.event.relatedTarget&&void 0===d3.event.relatedTarget.ownerSVGElement||k){if(j&&d3.event.relatedTarget&&void 0===d3.event.relatedTarget.ownerSVGElement&&d3.event.relatedTarget.className.match(b.nvPointerEventsClass))return;return g.elementMouseout({mouseX:d,mouseY:h}),void a.renderGuideLine(null)}var l=f.invert(d);g.elementMousemove({mouseX:d,mouseY:h,pointXValue:l}),"dblclick"===d3.event.type&&g.elementDblclick({mouseX:d,mouseY:h,pointXValue:l}),"click"===d3.event.type&&g.elementClick({mouseX:d,mouseY:h,pointXValue:l})}var m=d3.select(this),n=c||960,o=d||400,p=m.selectAll("g.nv-wrap.nv-interactiveLineLayer").data([k]),q=p.enter().append("g").attr("class"," nv-wrap nv-interactiveLineLayer");q.append("g").attr("class","nv-interactiveGuideLine"),i&&(i.on("mousemove",l,!0).on("mouseout",l,!0).on("dblclick",l).on("click",l),a.renderGuideLine=function(a){if(h){var b=p.select(".nv-interactiveGuideLine").selectAll("line").data(null!=a?[nv.utils.NaNtoZero(a)]:[],String);b.enter().append("line").attr("class","nv-guideline").attr("x1",function(a){return a}).attr("x2",function(a){return a}).attr("y1",o).attr("y2",0),b.exit().remove()}})})}var b=nv.models.tooltip(),c=null,d=null,e={left:0,top:0},f=d3.scale.linear(),g=(d3.scale.linear(),d3.dispatch("elementMousemove","elementMouseout","elementClick","elementDblclick")),h=!0,i=null,j="ActiveXObject"in window;return a.dispatch=g,a.tooltip=b,a.margin=function(b){return arguments.length?(e.top="undefined"!=typeof b.top?b.top:e.top,e.left="undefined"!=typeof b.left?b.left:e.left,a):e},a.width=function(b){return arguments.length?(c=b,a):c},a.height=function(b){return arguments.length?(d=b,a):d},a.xScale=function(b){return arguments.length?(f=b,a):f},a.showGuideLine=function(b){return arguments.length?(h=b,a):h},a.svgContainer=function(b){return arguments.length?(i=b,a):i},a},nv.interactiveBisect=function(a,b,c){"use strict";if(!(a instanceof Array))return null;"function"!=typeof c&&(c=function(a,b){return a.x});var d=d3.bisector(c).left,e=d3.max([0,d(a,b)-1]),f=c(a[e],e);if("undefined"==typeof f&&(f=e),f===b)return e;var g=d3.min([e+1,a.length-1]),h=c(a[g],g);return"undefined"==typeof h&&(h=g),Math.abs(h-b)>=Math.abs(f-b)?e:g},nv.nearestValueIndex=function(a,b,c){"use strict";var d=1/0,e=null;return a.forEach(function(a,f){var g=Math.abs(b-a);d>=g&&c>g&&(d=g,e=f)}),e},function(){"use strict";window.nv.tooltip={},window.nv.models.tooltip=function(){function a(){if(k){var a=d3.select(k);"svg"!==a.node().tagName&&(a=a.select("svg"));var b=a.node()?a.attr("viewBox"):null;if(b){b=b.split(" ");var c=parseInt(a.style("width"))/b[2];m.left=m.left*c,m.top=m.top*c}}}function b(a){var b;b=k?d3.select(k):d3.select("body");var c=b.select(".nvtooltip");return null===c.node()&&(c=b.append("div").attr("class","nvtooltip "+(j?j:"xy-tooltip")).attr("id",o)),c.node().innerHTML=a,c.style("top",0).style("left",0).style("opacity",0),c.selectAll("div, table, td, tr").classed(p,!0),c.classed(p,!0),c.node()}function c(){if(n&&t(e)){a();var d=m.left,j=null!=i?i:m.top,o=b(s(e));if(l=o,k){var p=k.getElementsByTagName("svg")[0],q=(p?p.getBoundingClientRect():k.getBoundingClientRect(),{left:0,top:0});if(p){var r=p.getBoundingClientRect(),u=k.getBoundingClientRect(),v=r.top;if(0>v){var w=k.getBoundingClientRect();v=Math.abs(v)>w.height?0:v}q.top=Math.abs(v-u.top),q.left=Math.abs(r.left-u.left)}d+=k.offsetLeft+q.left-2*k.scrollLeft,j+=k.offsetTop+q.top-2*k.scrollTop}return h&&h>0&&(j=Math.floor(j/h)*h),nv.tooltip.calcTooltipPosition([d,j],f,g,o),c}}var d=null,e=null,f="w",g=50,h=25,i=null,j=null,k=null,l=null,m={left:null,top:null},n=!0,o="nvtooltip-"+Math.floor(1e5*Math.random()),p="nv-pointer-events-none",q=function(a,b){return a},r=function(a){return a},s=function(a){if(null!=d)return d;if(null==a)return"";var b=d3.select(document.createElement("table")),c=b.selectAll("thead").data([a]).enter().append("thead");c.append("tr").append("td").attr("colspan",3).append("strong").classed("x-value",!0).html(r(a.value));var e=b.selectAll("tbody").data([a]).enter().append("tbody"),f=e.selectAll("tr").data(function(a){return a.series}).enter().append("tr").classed("highlight",function(a){return a.highlight});f.append("td").classed("legend-color-guide",!0).append("div").style("background-color",function(a){return a.color}),f.append("td").classed("key",!0).html(function(a){return a.key}),f.append("td").classed("value",!0).html(function(a,b){return q(a.value,b)}),f.selectAll("td").each(function(a){if(a.highlight){var b=d3.scale.linear().domain([0,1]).range(["#fff",a.color]),c=.6;d3.select(this).style("border-bottom-color",b(c)).style("border-top-color",b(c))}});var g=b.node().outerHTML;return void 0!==a.footer&&(g+="<div class='footer'>"+a.footer+"</div>"),g},t=function(a){return!!(a&&a.series&&a.series.length>0)};return c.nvPointerEventsClass=p,c.content=function(a){return arguments.length?(d=a,c):d},c.tooltipElem=function(){return l},c.contentGenerator=function(a){return arguments.length?("function"==typeof a&&(s=a),c):s},c.data=function(a){return arguments.length?(e=a,c):e},c.gravity=function(a){return arguments.length?(f=a,c):f},c.distance=function(a){return arguments.length?(g=a,c):g},c.snapDistance=function(a){return arguments.length?(h=a,c):h},c.classes=function(a){return arguments.length?(j=a,c):j},c.chartContainer=function(a){return arguments.length?(k=a,c):k},c.position=function(a){return arguments.length?(m.left="undefined"!=typeof a.left?a.left:m.left,m.top="undefined"!=typeof a.top?a.top:m.top,c):m},c.fixedTop=function(a){return arguments.length?(i=a,c):i},c.enabled=function(a){return arguments.length?(n=a,c):n},c.valueFormatter=function(a){return arguments.length?("function"==typeof a&&(q=a),c):q},c.headerFormatter=function(a){return arguments.length?("function"==typeof a&&(r=a),c):r},c.id=function(){return o},c},nv.tooltip.show=function(a,b,c,d,e,f){var g=document.createElement("div");g.className="nvtooltip "+(f?f:"xy-tooltip");var h=e;e&&!e.tagName.match(/g|svg/i)||(h=document.getElementsByTagName("body")[0]),g.style.left=0,g.style.top=0,g.style.opacity=0,"string"!=typeof b?g.appendChild(b):g.innerHTML=b,h.appendChild(g),e&&(a[0]=a[0]-e.scrollLeft,a[1]=a[1]-e.scrollTop),nv.tooltip.calcTooltipPosition(a,c,d,g)},nv.tooltip.findFirstNonSVGParent=function(a){for(;null!==a.tagName.match(/^g|svg$/i);)a=a.parentNode;return a},nv.tooltip.findTotalOffsetTop=function(a,b){var c=b;do isNaN(a.offsetTop)||(c+=a.offsetTop);while(a=a.offsetParent);return c},nv.tooltip.findTotalOffsetLeft=function(a,b){var c=b;do isNaN(a.offsetLeft)||(c+=a.offsetLeft);while(a=a.offsetParent);return c},nv.tooltip.calcTooltipPosition=function(a,b,c,d){var e,f,g=parseInt(d.offsetHeight),h=parseInt(d.offsetWidth),i=nv.utils.windowSize().width,j=nv.utils.windowSize().height,k=window.pageYOffset,l=window.pageXOffset;j=window.innerWidth>=document.body.scrollWidth?j:j-16,i=window.innerHeight>=document.body.scrollHeight?i:i-16,b=b||"s",c=c||20;var m=function(a){return nv.tooltip.findTotalOffsetTop(a,f)},n=function(a){return nv.tooltip.findTotalOffsetLeft(a,e)};switch(b){case"e":e=a[0]-h-c,f=a[1]-g/2;var o=n(d),p=m(d);l>o&&(e=a[0]+c>l?a[0]+c:l-o+e),k>p&&(f=k-p+f),p+g>k+j&&(f=k+j-p+f-g);break;case"w":e=a[0]+c,f=a[1]-g/2;var o=n(d),p=m(d);o+h>i&&(e=a[0]-h-c),k>p&&(f=k+5),p+g>k+j&&(f=k+j-p+f-g);break;case"n":e=a[0]-h/2-5,f=a[1]+c;var o=n(d),p=m(d);l>o&&(e=l+5),o+h>i&&(e=e-h/2+5),p+g>k+j&&(f=k+j-p+f-g);break;case"s":e=a[0]-h/2,f=a[1]-g-c;var o=n(d),p=m(d);l>o&&(e=l+5),o+h>i&&(e=e-h/2+5),k>p&&(f=k);break;case"none":e=a[0],f=a[1]-c;var o=n(d),p=m(d)}return d.style.left=e+"px",d.style.top=f+"px",d.style.opacity=1,d.style.position="absolute",d},nv.tooltip.cleanup=function(){for(var a=document.getElementsByClassName("nvtooltip"),b=[];a.length;)b.push(a[0]),a[0].style.transitionDelay="0 !important",a[0].style.opacity=0,a[0].className="nvtooltip-pending-removal";setTimeout(function(){for(;b.length;){var a=b.pop();a.parentNode.removeChild(a)}},500)}}(),nv.utils.windowSize=function(){var a={width:640,height:480};return document.body&&document.body.offsetWidth&&(a.width=document.body.offsetWidth,a.height=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(a.width=document.documentElement.offsetWidth,a.height=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(a.width=window.innerWidth,
a.height=window.innerHeight),a},nv.utils.windowResize=function(a){return window.addEventListener?window.addEventListener("resize",a):nv.log("ERROR: Failed to bind to window.resize with: ",a),{callback:a,clear:function(){window.removeEventListener("resize",a)}}},nv.utils.getColor=function(a){return arguments.length?a instanceof Array?function(b,c){return b.color||a[c%a.length]}:a:nv.utils.defaultColor()},nv.utils.defaultColor=function(){var a=d3.scale.category20().range();return function(b,c){return b.color||a[c%a.length]}},nv.utils.customTheme=function(a,b,c){b=b||function(a){return a.key},c=c||d3.scale.category20().range();var d=c.length;return function(e,f){var g=b(e);return"function"==typeof a[g]?a[g]():void 0!==a[g]?a[g]:(d||(d=c.length),d-=1,c[d])}},nv.utils.pjax=function(a,b){var c=function(c){d3.html(c,function(c){var d=d3.select(b).node();d.parentNode.replaceChild(d3.select(c).select(b).node(),d),nv.utils.pjax(a,b)})};d3.selectAll(a).on("click",function(){history.pushState(this.href,this.textContent,this.href),c(this.href),d3.event.preventDefault()}),d3.select(window).on("popstate",function(){d3.event.state&&c(d3.event.state)})},nv.utils.calcApproxTextWidth=function(a){if("function"==typeof a.style&&"function"==typeof a.text){var b=parseInt(a.style("font-size").replace("px","")),c=a.text().length;return c*b*.5}return 0},nv.utils.NaNtoZero=function(a){return"number"!=typeof a||isNaN(a)||null===a||a===1/0||a===-(1/0)?0:a},d3.selection.prototype.watchTransition=function(a){var b=[this].concat([].slice.call(arguments,1));return a.transition.apply(a,b)},nv.utils.renderWatch=function(a,b){if(!(this instanceof nv.utils.renderWatch))return new nv.utils.renderWatch(a,b);var c=void 0!==b?b:250,d=[],e=this;this.models=function(a){return a=[].slice.call(arguments,0),a.forEach(function(a){a.__rendered=!1,function(a){a.dispatch.on("renderEnd",function(b){a.__rendered=!0,e.renderEnd("model")})}(a),d.indexOf(a)<0&&d.push(a)}),this},this.reset=function(a){void 0!==a&&(c=a),d=[]},this.transition=function(a,b,f){if(b=arguments.length>1?[].slice.call(arguments,1):[],f=b.length>1?b.pop():void 0!==c?c:250,a.__rendered=!1,d.indexOf(a)<0&&d.push(a),0===f)return a.__rendered=!0,a.delay=function(){return this},a.duration=function(){return this},a;0===a.length?a.__rendered=!0:a.every(function(a){return!a.length})?a.__rendered=!0:a.__rendered=!1;var g=0;return a.transition().duration(f).each(function(){++g}).each("end",function(c,d){0===--g&&(a.__rendered=!0,e.renderEnd.apply(this,b))})},this.renderEnd=function(){d.every(function(a){return a.__rendered})&&(d.forEach(function(a){a.__rendered=!1}),a.renderEnd.apply(this,arguments))}},nv.utils.deepExtend=function(a){var b=arguments.length>1?[].slice.call(arguments,1):[];b.forEach(function(b){for(key in b){var c=a[key]instanceof Array,d="object"==typeof a[key],e="object"==typeof b[key];d&&!c&&e?nv.utils.deepExtend(a[key],b[key]):a[key]=b[key]}})},nv.utils.state=function(){if(!(this instanceof nv.utils.state))return new nv.utils.state;var a={},b=function(){},c=function(){return{}},d=null,e=null;this.dispatch=d3.dispatch("change","set"),this.dispatch.on("set",function(a){b(a,!0)}),this.getter=function(a){return c=a,this},this.setter=function(a,c){return c||(c=function(){}),b=function(b,d){a(b),d&&c()},this},this.init=function(a){d=d||{},nv.utils.deepExtend(d,a)};var f=function(){var b=c();if(JSON.stringify(b)===JSON.stringify(a))return!1;for(var d in b)void 0===a[d]&&(a[d]={}),a[d]=b[d],e=!0;return!0};this.update=function(){d&&(b(d,!1),d=null),f.call(this)&&this.dispatch.change(a)}},nv.utils.optionsFunc=function(a){return nv.deprecated("nv.utils.optionsFunc"),a&&d3.map(a).forEach(function(a,b){"function"==typeof this[a]&&this[a](b)}.bind(this)),this},nv.utils.calcTicksX=function(a,b){var c=1,d=0;for(d;d<b.length;d+=1){var e=b[d]&&b[d].values?b[d].values.length:0;c=e>c?e:c}return nv.log("Requested number of ticks: ",a),nv.log("Calculated max values to be: ",c),a=a>c?a=c-1:a,a=1>a?1:a,a=Math.floor(a),nv.log("Calculating tick count as: ",a),a},nv.utils.calcTicksY=function(a,b){return nv.utils.calcTicksX(a,b)},nv.utils.initOption=function(a,b){a._calls&&a._calls[b]?a[b]=a._calls[b]:a[b]=function(c){return arguments.length?(a._options[b]=c,a):a._options[b]}},nv.utils.initOptions=function(a){var b=Object.getOwnPropertyNames(a._options||{}),c=Object.getOwnPropertyNames(a._calls||{});b=b.concat(c);for(var d in b)nv.utils.initOption(a,b[d])},nv.utils.inheritOptionsD3=function(a,b,c){a._d3options=c.concat(a._d3options||[]),c.unshift(b),c.unshift(a),d3.rebind.apply(this,c)},nv.utils.arrayUnique=function(a){return a.sort().filter(function(b,c){return!c||b!=a[c-1]})},nv.utils.symbolMap=d3.map(),nv.utils.symbol=function(){function a(a,d){var e=b.call(this,a,d),f=c.call(this,a,d);return-1!==d3.svg.symbolTypes.indexOf(e)?d3.svg.symbol().type(e).size(f)():nv.utils.symbolMap.get(e)(f)}var b,c=64;return a.type=function(c){return arguments.length?(b=d3.functor(c),a):b},a.size=function(b){return arguments.length?(c=d3.functor(b),a):c},a},nv.utils.inheritOptions=function(a,b){var c=Object.getOwnPropertyNames(b._options||{}),d=Object.getOwnPropertyNames(b._calls||{}),e=b._inherited||[],f=b._d3options||[],g=c.concat(d).concat(e).concat(f);g.unshift(b),g.unshift(a),d3.rebind.apply(this,g),a._inherited=nv.utils.arrayUnique(c.concat(d).concat(e).concat(c).concat(a._inherited||[])),a._d3options=nv.utils.arrayUnique(f.concat(a._d3options||[]))},nv.utils.initSVG=function(a){a.classed({"nvd3-svg":!0})},nv.models.legend=function(){"use strict";function a(l){return l.each(function(a){var l=c-b.left-b.right,m=d3.select(this);nv.utils.initSVG(m);var n=m.selectAll("g.nv-legend").data([a]),o=(n.enter().append("g").attr("class","nvd3 nv-legend").append("g"),n.select("g"));n.attr("transform","translate("+b.left+","+b.top+")");var p=o.selectAll(".nv-series").data(function(a){return a}),q=p.enter().append("g").attr("class","nv-series").on("mouseover",function(a,b){k.legendMouseover(a,b)}).on("mouseout",function(a,b){k.legendMouseout(a,b)}).on("click",function(b,c){k.legendClick(b,c),i&&(j?(a.forEach(function(a){a.disabled=!0}),b.disabled=!1):(b.disabled=!b.disabled,a.every(function(a){return a.disabled})&&a.forEach(function(a){a.disabled=!1})),k.stateChange({disabled:a.map(function(a){return!!a.disabled})}))}).on("dblclick",function(b,c){k.legendDblclick(b,c),i&&(a.forEach(function(a){a.disabled=!0}),b.disabled=!1,k.stateChange({disabled:a.map(function(a){return!!a.disabled})}))});if(q.append("circle").style("stroke-width",2).attr("class","nv-legend-symbol").attr("r",5),q.append("text").attr("text-anchor","start").attr("class","nv-legend-text").attr("dy",".32em").attr("dx","8"),p.classed("nv-disabled",function(a){return a.disabled}),p.exit().remove(),p.select("circle").style("fill",function(a,b){return a.color||f(a,b)}).style("stroke",function(a,b){return a.color||f(a,b)}),p.select("text").text(e),g){var r=[];p.each(function(a,b){var c,d=d3.select(this).select("text");try{if(c=d.node().getComputedTextLength(),0>=c)throw Error()}catch(e){c=nv.utils.calcApproxTextWidth(d)}r.push(c+28)});for(var s=0,t=0,u=[];l>t&&s<r.length;)u[s]=r[s],t+=r[s++];for(0===s&&(s=1);t>l&&s>1;){u=[],s--;for(var v=0;v<r.length;v++)r[v]>(u[v%s]||0)&&(u[v%s]=r[v]);t=u.reduce(function(a,b,c,d){return a+b})}for(var w=[],x=0,y=0;s>x;x++)w[x]=y,y+=u[x];p.attr("transform",function(a,b){return"translate("+w[b%s]+","+(5+20*Math.floor(b/s))+")"}),h?o.attr("transform","translate("+(c-b.right-t)+","+b.top+")"):o.attr("transform","translate(0,"+b.top+")"),d=b.top+b.bottom+20*Math.ceil(r.length/s)}else{var z,A=5,B=5,C=0;p.attr("transform",function(a,d){var e=d3.select(this).select("text").node().getComputedTextLength()+28;return z=B,c<b.left+b.right+z+e&&(B=z=5,A+=20),B+=e,B>C&&(C=B),"translate("+z+","+A+")"}),o.attr("transform","translate("+(c-b.right-C)+","+b.top+")"),d=b.top+b.bottom+A+15}}),a}var b={top:5,right:0,bottom:5,left:0},c=400,d=20,e=function(a){return a.key},f=nv.utils.defaultColor(),g=!0,h=!1,i=!0,j=!1,k=d3.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout","stateChange");return a.dispatch=k,a.options=nv.utils.optionsFunc.bind(a),a._options=Object.create({},{width:{get:function(){return c},set:function(a){c=a}},height:{get:function(){return d},set:function(a){d=a}},key:{get:function(){return e},set:function(a){e=a}},align:{get:function(){return g},set:function(a){g=a}},rightAlign:{get:function(){return h},set:function(a){h=a}},updateState:{get:function(){return i},set:function(a){i=a}},radioButtonMode:{get:function(){return j},set:function(a){j=a}},margin:{get:function(){return b},set:function(a){b.top=void 0!==a.top?a.top:b.top,b.right=void 0!==a.right?a.right:b.right,b.bottom=void 0!==a.bottom?a.bottom:b.bottom,b.left=void 0!==a.left?a.left:b.left}},color:{get:function(){return f},set:function(a){f=nv.utils.getColor(a)}}}),nv.utils.initOptions(a),a},nv.models.pie=function(){"use strict";function a(j){return B.reset(),j.each(function(a){function j(a){a.endAngle=isNaN(a.endAngle)?0:a.endAngle,a.startAngle=isNaN(a.startAngle)?0:a.startAngle,q||(a.innerRadius=0);var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return M(b(a))}}var C=c-b.left-b.right,D=e-b.top-b.bottom,E=Math.min(C,D)/2,F=E-E/5,G=d3.select(this);nv.utils.initSVG(G);var H=G.selectAll(".nv-wrap.nv-pie").data(a),I=H.enter().append("g").attr("class","nvd3 nv-wrap nv-pie nv-chart-"+h),J=I.append("g"),K=H.select("g"),L=J.append("g").attr("class","nv-pie");J.append("g").attr("class","nv-pieLabels"),H.attr("transform","translate("+b.left+","+b.top+")"),K.select(".nv-pie").attr("transform","translate("+C/2+","+D/2+")"),K.select(".nv-pieLabels").attr("transform","translate("+C/2+","+D/2+")"),G.on("click",function(a,b){A.chartClick({data:a,index:b,pos:d3.event,id:h})});var M=d3.svg.arc().outerRadius(F),N=d3.svg.arc().outerRadius(F+5);v&&(M.startAngle(v),N.startAngle(v)),x&&(M.endAngle(x),N.endAngle(x)),q&&(M.innerRadius(E*z),N.innerRadius(E*z));var O=d3.layout.pie().sort(null).value(function(a){return a.disabled?0:g(a)});if(O.padAngle&&w&&O.padAngle(w),M.cornerRadius&&y&&(M.cornerRadius(y),N.cornerRadius(y)),q&&r){var P=L.append("g").attr("class","nv-pie");P.append("text").style("text-anchor","middle").attr("class","nv-pie-title").text(function(a){return r}).attr("dy","0.35em").attr("transform",function(a,b){return"translate(0, "+t+")"})}var Q=H.select(".nv-pie").selectAll(".nv-slice").data(O),R=H.select(".nv-pieLabels").selectAll(".nv-label").data(O);Q.exit().remove(),R.exit().remove();var S=Q.enter().append("g");S.attr("class","nv-slice"),S.on("mouseover",function(a,b){d3.select(this).classed("hover",!0),s&&d3.select(this).select("path").transition().duration(70).attr("d",N),A.elementMouseover({label:f(a.data),value:g(a.data),point:a.data,pointIndex:b,pos:[d3.event.pageX,d3.event.pageY],id:h,color:d3.select(this).style("fill")})}),S.on("mouseout",function(a,b){d3.select(this).classed("hover",!1),s&&d3.select(this).select("path").transition().duration(50).attr("d",M),A.elementMouseout({label:f(a.data),value:g(a.data),point:a.data,index:b,id:h})}),Q.attr("fill",function(a,b){return i(a,b)}),Q.attr("stroke",function(a,b){return i(a,b)});var T=S.append("path").each(function(a){this._current=a});if(T.on("click",function(a,b){A.elementClick({label:f(a.data),value:g(a.data),point:a.data,index:b,pos:d3.event,id:h}),d3.event.stopPropagation()}),T.on("dblclick",function(a,b){A.elementDblClick({label:f(a.data),value:g(a.data),point:a.data,index:b,pos:d3.event,id:h}),d3.event.stopPropagation()}),Q.select("path").transition().attr("d",M).attrTween("d",j),l){var U=d3.svg.arc().innerRadius(0);if(m)var U=M;n&&(U=d3.svg.arc().outerRadius(M.outerRadius())),R.enter().append("g").classed("nv-label",!0).each(function(a,b){var c=d3.select(this);c.attr("transform",function(a){if(u){a.outerRadius=F+10,a.innerRadius=F+15;var b=(a.startAngle+a.endAngle)/2*(180/Math.PI);return(a.startAngle+a.endAngle)/2<Math.PI?b-=90:b+=90,"translate("+U.centroid(a)+") rotate("+b+")"}return a.outerRadius=E+10,a.innerRadius=E+15,"translate("+U.centroid(a)+")"}),c.append("rect").style("stroke","#fff").style("fill","#fff").attr("rx",3).attr("ry",3),c.append("text").style("text-anchor",u?(a.startAngle+a.endAngle)/2<Math.PI?"start":"end":"middle").style("fill","#fff")});var V={},W=14,X=140,Y=function(a){return Math.floor(a[0]/X)*X+","+Math.floor(a[1]/W)*W};R.watchTransition(B,"pie labels").attr("transform",function(a){if(u){a.outerRadius=F+10,a.innerRadius=F+15;var b=(a.startAngle+a.endAngle)/2*(180/Math.PI);return(a.startAngle+a.endAngle)/2<Math.PI?b-=90:b+=90,"translate("+U.centroid(a)+") rotate("+b+")"}a.outerRadius=E+10,a.innerRadius=E+15;var c=U.centroid(a);if(a.value){var d=Y(c);V[d]&&(c[1]-=W),V[Y(c)]=!0}return"translate("+c+")"}),R.select(".nv-label text").style("text-anchor",u?(d.startAngle+d.endAngle)/2<Math.PI?"start":"end":"middle").text(function(a,b){var c=(a.endAngle-a.startAngle)/(2*Math.PI),d={key:f(a.data),value:g(a.data),percent:k(c)};return a.value&&c>p?d[o]:""})}}),B.renderEnd("pie immediate"),a}var b={top:0,right:0,bottom:0,left:0},c=500,e=500,f=function(a){return a.x},g=function(a){return a.y},h=Math.floor(1e4*Math.random()),i=nv.utils.defaultColor(),j=d3.format(",.0f"),k=d3.format("%"),l=!0,m=!0,n=!1,o="key",p=.02,q=!1,r=!1,s=!0,t=0,u=!1,v=!1,w=!1,x=!1,y=0,z=.5,A=d3.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout","renderEnd"),B=nv.utils.renderWatch(A);return a.dispatch=A,a.options=nv.utils.optionsFunc.bind(a),a._options=Object.create({},{width:{get:function(){return c},set:function(a){c=a}},height:{get:function(){return e},set:function(a){e=a}},showLabels:{get:function(){return l},set:function(a){l=a}},title:{get:function(){return r},set:function(a){r=a}},titleOffset:{get:function(){return t},set:function(a){t=a}},labelThreshold:{get:function(){return p},set:function(a){p=a}},labelFormat:{get:function(){return k},set:function(a){k=a}},valueFormat:{get:function(){return j},set:function(a){j=a}},x:{get:function(){return f},set:function(a){f=a}},id:{get:function(){return h},set:function(a){h=a}},endAngle:{get:function(){return x},set:function(a){x=a}},startAngle:{get:function(){return v},set:function(a){v=a}},padAngle:{get:function(){return w},set:function(a){w=a}},cornerRadius:{get:function(){return y},set:function(a){y=a}},donutRatio:{get:function(){return z},set:function(a){z=a}},pieLabelsOutside:{get:function(){return m},set:function(a){m=a}},donutLabelsOutside:{get:function(){return n},set:function(a){n=a}},labelSunbeamLayout:{get:function(){return u},set:function(a){u=a}},donut:{get:function(){return q},set:function(a){q=a}},growOnHover:{get:function(){return s},set:function(a){s=a}},margin:{get:function(){return b},set:function(a){b.top="undefined"!=typeof a.top?a.top:b.top,b.right="undefined"!=typeof a.right?a.right:b.right,b.bottom="undefined"!=typeof a.bottom?a.bottom:b.bottom,b.left="undefined"!=typeof a.left?a.left:b.left}},y:{get:function(){return g},set:function(a){g=d3.functor(a)}},color:{get:function(){return i},set:function(a){i=nv.utils.getColor(a)}},labelType:{get:function(){return o},set:function(a){o=a||"key"}}}),nv.utils.initOptions(a),a},nv.models.pieChart=function(){"use strict";function a(h){return q.reset(),q.models(b),h.each(function(h){var i=d3.select(this);nv.utils.initSVG(i);var j=(e||parseInt(i.style("width"),10)||960)-d.left-d.right,n=(f||parseInt(i.style("height"),10)||400)-d.top-d.bottom;if(a.update=function(){i.transition().call(a)},a.container=this,k.setter(s(h),a.update).getter(r(h)).update(),k.disabled=h.map(function(a){return!!a.disabled}),!l){var p;l={};for(p in k)k[p]instanceof Array?l[p]=k[p].slice(0):l[p]=k[p]}if(!h||!h.length){var q=i.selectAll(".nv-noData").data([m]);return q.enter().append("text").attr("class","nvd3 nv-noData").attr("dy","-.7em").style("text-anchor","middle"),q.attr("x",d.left+j/2).attr("y",d.top+n/2).text(function(a){return a}),a}i.selectAll(".nv-noData").remove();var t=i.selectAll("g.nv-wrap.nv-pieChart").data([h]),u=t.enter().append("g").attr("class","nvd3 nv-wrap nv-pieChart").append("g"),v=t.select("g");u.append("g").attr("class","nv-pieWrap"),u.append("g").attr("class","nv-legendWrap"),g&&(c.width(j).key(b.x()),t.select(".nv-legendWrap").datum(h).call(c),d.top!=c.height()&&(d.top=c.height(),n=(f||parseInt(i.style("height"))||400)-d.top-d.bottom),t.select(".nv-legendWrap").attr("transform","translate(0,"+-d.top+")")),t.attr("transform","translate("+d.left+","+d.top+")"),b.width(j).height(n);var w=v.select(".nv-pieWrap").datum([h]);d3.transition(w).call(b),c.dispatch.on("stateChange",function(b){for(var c in b)k[c]=b[c];o.stateChange(k),a.update()}),b.dispatch.on("elementMouseout.tooltip",function(a){o.tooltipHide(a)}),o.on("changeState",function(b){"undefined"!=typeof b.disabled&&(h.forEach(function(a,c){a.disabled=b.disabled[c]}),k.disabled=b.disabled),a.update()})}),q.renderEnd("pieChart immediate"),a}var b=nv.models.pie(),c=nv.models.legend(),d={top:0,right:20,bottom:20,left:20},e=null,f=null,g=!0,h=nv.utils.defaultColor(),i=!0,j=function(a,b,c,d){return'<h3 style="background-color: '+c.color+'"><font color="white">'+a+"</font></h3><p>"+b+"</p>"},k=nv.utils.state(),l=null,m="No Data Available.",n=250,o=d3.dispatch("tooltipShow","tooltipHide","stateChange","changeState","renderEnd"),p=function(c,d){var e=b.x()(c.point),f=c.pos[0]+(d&&d.offsetLeft||0),g=c.pos[1]+(d&&d.offsetTop||0),h=b.valueFormat()(b.y()(c.point)),i=j(e,h,c,a);nv.tooltip.show([f,g],i,c.value<0?"n":"s",null,d)},q=nv.utils.renderWatch(o),r=function(a){return function(){return{active:a.map(function(a){return!a.disabled})}}},s=function(a){return function(b){void 0!==b.active&&a.forEach(function(a,c){a.disabled=!b.active[c]})}};return b.dispatch.on("elementMouseover.tooltip",function(a){a.pos=[a.pos[0]+d.left,a.pos[1]+d.top],o.tooltipShow(a)}),o.on("tooltipShow",function(a){i&&p(a)}),o.on("tooltipHide",function(){i&&nv.tooltip.cleanup()}),a.legend=c,a.dispatch=o,a.pie=b,a.options=nv.utils.optionsFunc.bind(a),a._options=Object.create({},{noData:{get:function(){return m},set:function(a){m=a}},tooltipContent:{get:function(){return j},set:function(a){j=a}},tooltips:{get:function(){return i},set:function(a){i=a}},showLegend:{get:function(){return g},set:function(a){g=a}},defaultState:{get:function(){return l},set:function(a){l=a}},color:{get:function(){return h},set:function(a){h=a,c.color(h),b.color(h)}},duration:{get:function(){return n},set:function(a){n=a,q.reset(n)}}}),nv.utils.inheritOptions(a,b),nv.utils.initOptions(a),a},function(a){var b=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return"undefined"==typeof a},toStr:function(a){return b.isUndefined(a)||null===a?"":a+""},bind:a.proxy,each:function(b,c){function d(a,b){return c(b,a)}a.each(b,d)},map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?void 0:!1}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?!1:void 0}),!!d):d},mixin:a.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),templatify:function(b){function c(){return String(b)}return a.isFunction(b)?b:c},defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},noop:function(){}}}(),c="0.10.5",d=function(){"use strict";function a(a){return a=b.toStr(a),a?a.split(/\s+/):[]}function c(a){return a=b.toStr(a),a?a.split(/\W+/):[]}function d(a){return function(){var c=[].slice.call(arguments,0);return function(d){var e=[];return b.each(c,function(c){e=e.concat(a(b.toStr(d[c])))}),e}}}return{nonword:c,whitespace:a,obj:{nonword:d(c),whitespace:d(a)}}}(),e=function(){"use strict";function c(c){this.maxSize=b.isNumber(c)?c:100,this.reset(),this.maxSize<=0&&(this.set=this.get=a.noop)}function d(){this.head=this.tail=null}function e(a,b){this.key=a,this.val=b,this.prev=this.next=null}return b.mixin(c.prototype,{set:function(a,b){var c,d=this.list.tail;this.size>=this.maxSize&&(this.list.remove(d),delete this.hash[d.key]),(c=this.hash[a])?(c.val=b,this.list.moveToFront(c)):(c=new e(a,b),this.list.add(c),this.hash[a]=c,this.size++)},get:function(a){var b=this.hash[a];return b?(this.list.moveToFront(b),b.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new d}}),b.mixin(d.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=a),this.head=a,this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next,a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a),this.add(a)}}),c}(),f=function(){"use strict";function a(a){this.prefix=["__",a,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+b.escapeRegExChars(this.prefix))}function c(){return(new Date).getTime()}function d(a){return JSON.stringify(b.isUndefined(a)?null:a)}function e(a){return JSON.parse(a)}var f,g;try{f=window.localStorage,f.setItem("~~~","!"),f.removeItem("~~~")}catch(h){f=null}return g=f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){return this.isExpired(a)&&this.remove(a),e(f.getItem(this._prefix(a)))},set:function(a,e,g){return b.isNumber(g)?f.setItem(this._ttlKey(a),d(c()+g)):f.removeItem(this._ttlKey(a)),f.setItem(this._prefix(a),d(e))},remove:function(a){return f.removeItem(this._ttlKey(a)),f.removeItem(this._prefix(a)),this},clear:function(){var a,b,c=[],d=f.length;for(a=0;d>a;a++)(b=f.key(a)).match(this.keyMatcher)&&c.push(b.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(a){var d=e(f.getItem(this._ttlKey(a)));return!!(b.isNumber(d)&&c()>d)}}:{get:b.noop,set:b.noop,remove:b.noop,clear:b.noop,isExpired:b.noop},b.mixin(a.prototype,g),a}(),g=function(){"use strict";function c(b){b=b||{},this.cancelled=!1,this.lastUrl=null,this._send=b.transport?d(b.transport):a.ajax,this._get=b.rateLimiter?b.rateLimiter(this._get):this._get,this._cache=b.cache===!1?new e(0):i}function d(c){return function(d,e){function f(a){b.defer(function(){h.resolve(a)})}function g(a){b.defer(function(){h.reject(a)})}var h=a.Deferred();return c(d,e,f,g),h}}var f=0,g={},h=6,i=new e(10);return c.setMaxPendingRequests=function(a){h=a},c.resetCache=function(){i.reset()},b.mixin(c.prototype,{_get:function(a,b,c){function d(b){c&&c(null,b),k._cache.set(a,b)}function e(){c&&c(!0)}function i(){f--,delete g[a],k.onDeckRequestArgs&&(k._get.apply(k,k.onDeckRequestArgs),k.onDeckRequestArgs=null)}var j,k=this;this.cancelled||a!==this.lastUrl||((j=g[a])?j.done(d).fail(e):h>f?(f++,g[a]=this._send(a,b).done(d).fail(e).always(i)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(a,c,d){var e;return b.isFunction(c)&&(d=c,c={}),this.cancelled=!1,this.lastUrl=a,(e=this._cache.get(a))?b.defer(function(){d&&d(null,e)}):this._get(a,c,d),!!e},cancel:function(){this.cancelled=!0}}),c}(),h=function(){"use strict";function c(b){b=b||{},b.datumTokenizer&&b.queryTokenizer||a.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=b.datumTokenizer,this.queryTokenizer=b.queryTokenizer,this.reset()}function d(a){return a=b.filter(a,function(a){return!!a}),a=b.map(a,function(a){return a.toLowerCase()})}function e(){return{ids:[],children:{}}}function f(a){for(var b={},c=[],d=0,e=a.length;e>d;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c}function g(a,b){function c(a,b){return a-b}var d=0,e=0,f=[];a=a.sort(c),b=b.sort(c);for(var g=a.length,h=b.length;g>d&&h>e;)a[d]<b[e]?d++:a[d]>b[e]?e++:(f.push(a[d]),d++,e++);return f}return b.mixin(c.prototype,{bootstrap:function(a){this.datums=a.datums,this.trie=a.trie},add:function(a){var c=this;a=b.isArray(a)?a:[a],b.each(a,function(a){var f,g;f=c.datums.push(a)-1,g=d(c.datumTokenizer(a)),b.each(g,function(a){var b,d,g;for(b=c.trie,d=a.split("");g=d.shift();)b=b.children[g]||(b.children[g]=e()),b.ids.push(f)})})},get:function(a){var c,e,h=this;return c=d(this.queryTokenizer(a)),b.each(c,function(a){var b,c,d,f;if(e&&0===e.length)return!1;for(b=h.trie,c=a.split("");b&&(d=c.shift());)b=b.children[d];return b&&0===c.length?(f=b.ids.slice(0),void(e=e?g(e,f):f)):(e=[],!1)}),e?b.map(f(e),function(a){return h.datums[a]}):[]},reset:function(){this.datums=[],this.trie=e()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),c}(),i=function(){"use strict";function d(a){return a.local||null}function e(d){var e,f;return f={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(e=d.prefetch||null)&&(e=b.isString(e)?{url:e}:e,e=b.mixin(f,e),e.thumbprint=c+e.thumbprint,e.ajax.type=e.ajax.type||"GET",e.ajax.dataType=e.ajax.dataType||"json",!e.url&&a.error("prefetch requires url to be set")),e}function f(c){function d(a){return function(c){return b.debounce(c,a)}}function e(a){return function(c){return b.throttle(c,a)}}var f,g;return g={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(f=c.remote||null)&&(f=b.isString(f)?{url:f}:f,f=b.mixin(g,f),f.rateLimiter=/^throttle$/i.test(f.rateLimitBy)?e(f.rateLimitWait):d(f.rateLimitWait),f.ajax.type=f.ajax.type||"GET",f.ajax.dataType=f.ajax.dataType||"json",delete f.rateLimitBy,delete f.rateLimitWait,!f.url&&a.error("remote requires url to be set")),f}return{local:d,prefetch:e,remote:f}}();!function(c){"use strict";function e(b){b&&(b.local||b.prefetch||b.remote)||a.error("one of local, prefetch, or remote is required"),this.limit=b.limit||5,this.sorter=j(b.sorter),this.dupDetector=b.dupDetector||k,this.local=i.local(b),this.prefetch=i.prefetch(b),this.remote=i.remote(b),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new h({datumTokenizer:b.datumTokenizer,queryTokenizer:b.queryTokenizer}),this.storage=this.cacheKey?new f(this.cacheKey):null}function j(a){function c(b){return b.sort(a)}function d(a){return a}return b.isFunction(a)?c:d}function k(){return!1}var l,m;return l=c.Bloodhound,m={data:"data",protocol:"protocol",thumbprint:"thumbprint"},c.Bloodhound=e,e.noConflict=function(){return c.Bloodhound=l,e},e.tokenizers=d,b.mixin(e.prototype,{_loadPrefetch:function(b){function c(a){f.clear(),f.add(b.filter?b.filter(a):a),f._saveToStorage(f.index.serialize(),b.thumbprint,b.ttl)}var d,e,f=this;return(d=this._readFromStorage(b.thumbprint))?(this.index.bootstrap(d),e=a.Deferred().resolve()):e=a.ajax(b.url,b.ajax).done(c),e},_getFromRemote:function(a,b){function c(a,c){b(a?[]:f.remote.filter?f.remote.filter(c):c)}var d,e,f=this;if(this.transport)return a=a||"",e=encodeURIComponent(a),d=this.remote.replace?this.remote.replace(this.remote.url,a):this.remote.url.replace(this.remote.wildcard,e),this.transport.get(d,this.remote.ajax,c)},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(a,b,c){this.storage&&(this.storage.set(m.data,a,c),this.storage.set(m.protocol,location.protocol,c),this.storage.set(m.thumbprint,b,c))},_readFromStorage:function(a){var b,c={};return this.storage&&(c.data=this.storage.get(m.data),c.protocol=this.storage.get(m.protocol),c.thumbprint=this.storage.get(m.thumbprint)),b=c.thumbprint!==a||c.protocol!==location.protocol,c.data&&!b?c.data:null},_initialize:function(){function c(){e.add(b.isFunction(f)?f():f)}var d,e=this,f=this.local;return d=this.prefetch?this._loadPrefetch(this.prefetch):a.Deferred().resolve(),f&&d.done(c),this.transport=this.remote?new g(this.remote):null,this.initPromise=d.promise()},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(a,c){function d(a){var d=f.slice(0);b.each(a,function(a){var c;return c=b.some(d,function(b){return e.dupDetector(a,b)}),!c&&d.push(a),d.length<e.limit}),c&&c(e.sorter(d))}var e=this,f=[],g=!1;f=this.index.get(a),f=this.sorter(f).slice(0,this.limit),f.length<this.limit?g=this._getFromRemote(a,d):this._cancelLastRemoteRequest(),g||(f.length>0||!this.transport)&&c&&c(f)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&g.resetCache()},ttAdapter:function(){return b.bind(this.get,this)}}),e}(this);var j=function(){return{wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'}}(),k=function(){"use strict";var a={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return b.isMsie()&&b.mixin(a.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),b.isMsie()&&b.isMsie()<=7&&b.mixin(a.input,{marginTop:"-1px"}),a}(),l=function(){"use strict";function c(b){b&&b.el||a.error("EventBus initialized without el"),this.$el=a(b.el)}var d="typeahead:";return b.mixin(c.prototype,{trigger:function(a){var b=[].slice.call(arguments,1);this.$el.trigger(d+a,b)}}),c}(),m=function(){"use strict";function a(a,b,c,d){var e;if(!c)return this;for(b=b.split(i),c=d?h(c,d):c,this._callbacks=this._callbacks||{};e=b.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][a].push(c);return this}function b(b,c,d){return a.call(this,"async",b,c,d)}function c(b,c,d){return a.call(this,"sync",b,c,d)}function d(a){var b;if(!this._callbacks)return this;for(a=a.split(i);b=a.shift();)delete this._callbacks[b];return this}function e(a){var b,c,d,e,g;if(!this._callbacks)return this;for(a=a.split(i),d=[].slice.call(arguments,1);(b=a.shift())&&(c=this._callbacks[b]);)e=f(c.sync,this,[b].concat(d)),g=f(c.async,this,[b].concat(d)),e()&&j(g);return this}function f(a,b,c){function d(){for(var d,e=0,f=a.length;!d&&f>e;e+=1)d=a[e].apply(b,c)===!1;return!d}return d}function g(){var a;return a=window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}function h(a,b){return a.bind?a.bind(b):function(){a.apply(b,[].slice.call(arguments,0))}}var i=/\s+/,j=g();return{onSync:c,onAsync:b,off:d,trigger:e}}(),n=function(a){"use strict";function c(a,c,d){for(var e,f=[],g=0,h=a.length;h>g;g++)f.push(b.escapeRegExChars(a[g]));return e=d?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")",c?new RegExp(e):new RegExp(e,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(e){function f(b){var c,d,f;return(c=h.exec(b.data))&&(f=a.createElement(e.tagName),e.className&&(f.className=e.className),d=b.splitText(c.index),d.splitText(c[0].length),f.appendChild(d.cloneNode(!0)),b.parentNode.replaceChild(f,d)),
!!c}function g(a,b){for(var c,d=3,e=0;e<a.childNodes.length;e++)c=a.childNodes[e],c.nodeType===d?e+=b(c)?1:0:g(c,b)}var h;e=b.mixin({},d,e),e.node&&e.pattern&&(e.pattern=b.isArray(e.pattern)?e.pattern:[e.pattern],h=c(e.pattern,e.caseSensitive,e.wordsOnly),g(e.node,f))}}(window.document),o=function(){"use strict";function c(c){var e,f,h,i,j=this;c=c||{},c.input||a.error("input is missing"),e=b.bind(this._onBlur,this),f=b.bind(this._onFocus,this),h=b.bind(this._onKeydown,this),i=b.bind(this._onInput,this),this.$hint=a(c.hint),this.$input=a(c.input).on("blur.tt",e).on("focus.tt",f).on("keydown.tt",h),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=b.noop),b.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){g[a.which||a.keyCode]||b.defer(b.bind(j._onInput,j,a))}):this.$input.on("input.tt",i),this.query=this.$input.val(),this.$overflowHelper=d(this.$input)}function d(b){return a('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform")}).insertAfter(b)}function e(a,b){return c.normalizeQuery(a)===c.normalizeQuery(b)}function f(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var g;return g={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},c.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},b.mixin(c.prototype,m,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var b=g[a.which||a.keyCode];this._managePreventDefault(b,a),b&&this._shouldTrigger(b,a)&&this.trigger(b+"Keyed",a)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(a,b){var c,d,e;switch(a){case"tab":d=this.getHint(),e=this.getInputValue(),c=d&&d!==e&&!f(b);break;case"up":case"down":c=!f(b);break;default:c=!1}c&&b.preventDefault()},_shouldTrigger:function(a,b){var c;switch(a){case"tab":c=!f(b);break;default:c=!0}return c},_checkInputValue:function(){var a,b,c;a=this.getInputValue(),b=e(a,this.query),c=b?this.query.length!==a.length:!1,this.query=a,b?c&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,b){this.$input.val(a),b?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,b,c,d;a=this.getInputValue(),b=this.getHint(),c=a!==b&&0===b.indexOf(a),d=""!==a&&c&&!this.hasOverflow(),!d&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,c,d;return a=this.$input.val().length,c=this.$input[0].selectionStart,b.isNumber(c)?c===a:document.selection?(d=document.selection.createRange(),d.moveStart("character",-a),a===d.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),c}(),p=function(){"use strict";function c(c){c=c||{},c.templates=c.templates||{},c.source||a.error("missing source"),c.name&&!f(c.name)&&a.error("invalid dataset name: "+c.name),this.query=null,this.highlight=!!c.highlight,this.name=c.name||b.getUniqueId(),this.source=c.source,this.displayFn=d(c.display||c.displayKey),this.templates=e(c.templates,this.displayFn),this.$el=a(j.dataset.replace("%CLASS%",this.name))}function d(a){function c(b){return b[a]}return a=a||"value",b.isFunction(a)?a:c}function e(a,c){function d(a){return"<p>"+c(a)+"</p>"}return{empty:a.empty&&b.templatify(a.empty),header:a.header&&b.templatify(a.header),footer:a.footer&&b.templatify(a.footer),suggestion:a.suggestion||d}}function f(a){return/^[_a-zA-Z0-9-]+$/.test(a)}var g="ttDataset",h="ttValue",i="ttDatum";return c.extractDatasetName=function(b){return a(b).data(g)},c.extractValue=function(b){return a(b).data(h)},c.extractDatum=function(b){return a(b).data(i)},b.mixin(c.prototype,m,{_render:function(c,d){function e(){return p.templates.empty({query:c,isEmpty:!0})}function f(){function e(b){var c;return c=a(j.suggestion).append(p.templates.suggestion(b)).data(g,p.name).data(h,p.displayFn(b)).data(i,b),c.children().each(function(){a(this).css(k.suggestionChild)}),c}var f,l;return f=a(j.suggestions).css(k.suggestions),l=b.map(d,e),f.append.apply(f,l),p.highlight&&n({className:"tt-highlight",node:f[0],pattern:c}),f}function l(){return p.templates.header({query:c,isEmpty:!o})}function m(){return p.templates.footer({query:c,isEmpty:!o})}if(this.$el){var o,p=this;this.$el.empty(),o=d&&d.length,!o&&this.templates.empty?this.$el.html(e()).prepend(p.templates.header?l():null).append(p.templates.footer?m():null):o&&this.$el.html(f()).prepend(p.templates.header?l():null).append(p.templates.footer?m():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(a){function b(b){c.canceled||a!==c.query||c._render(a,b)}var c=this;this.query=a,this.canceled=!1,this.source(a,b)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),c}(),q=function(){"use strict";function c(c){var e,f,g,h=this;c=c||{},c.menu||a.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=b.map(c.datasets,d),e=b.bind(this._onSuggestionClick,this),f=b.bind(this._onSuggestionMouseEnter,this),g=b.bind(this._onSuggestionMouseLeave,this),this.$menu=a(c.menu).on("click.tt",".tt-suggestion",e).on("mouseenter.tt",".tt-suggestion",f).on("mouseleave.tt",".tt-suggestion",g),b.each(this.datasets,function(a){h.$menu.append(a.getRoot()),a.onSync("rendered",h._onRendered,h)})}function d(a){return new p(a)}return b.mixin(c.prototype,m,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",a(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor(),this._setCursor(a(b.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function a(a){return a.isEmpty()}this.isEmpty=b.every(this.datasets,a),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(a,b){a.first().addClass("tt-cursor"),!b&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(a){var b,c,d,e;if(this.isOpen){if(c=this._getCursor(),b=this._getSuggestions(),this._removeCursor(),d=b.index(c)+a,d=(d+1)%(b.length+1)-1,-1===d)return void this.trigger("cursorRemoved");-1>d&&(d=b.length-1),this._setCursor(e=b.eq(d)),this._ensureVisible(e)}},_ensureVisible:function(a){var b,c,d,e;b=a.position().top,c=b+a.outerHeight(!0),d=this.$menu.scrollTop(),e=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>b?this.$menu.scrollTop(d+b):c>e&&this.$menu.scrollTop(d+(c-e))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(a){this.$menu.css("ltr"===a?k.ltr:k.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(a){var b=null;return a.length&&(b={raw:p.extractDatum(a),value:p.extractValue(a),datasetName:p.extractDatasetName(a)}),b},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(a){function c(b){b.update(a)}b.each(this.datasets,c)},empty:function(){function a(a){a.clear()}b.each(this.datasets,a),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function a(a){a.destroy()}this.$menu.off(".tt"),this.$menu=null,b.each(this.datasets,a)}}),c}(),r=function(){"use strict";function c(c){var e,f,g;c=c||{},c.input||a.error("missing input"),this.isActivated=!1,this.autoselect=!!c.autoselect,this.minLength=b.isNumber(c.minLength)?c.minLength:1,this.$node=d(c.input,c.withHint),e=this.$node.find(".tt-dropdown-menu"),f=this.$node.find(".tt-input"),g=this.$node.find(".tt-hint"),f.on("blur.tt",function(a){var c,d,g;c=document.activeElement,d=e.is(c),g=e.has(c).length>0,b.isMsie()&&(d||g)&&(a.preventDefault(),a.stopImmediatePropagation(),b.defer(function(){f.focus()}))}),e.on("mousedown.tt",function(a){a.preventDefault()}),this.eventBus=c.eventBus||new l({el:f}),this.dropdown=new q({menu:e,datasets:c.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new o({input:f,hint:g}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function d(b,c){var d,f,h,i;d=a(b),f=a(j.wrapper).css(k.wrapper),h=a(j.dropdown).css(k.dropdown),i=d.clone().css(k.hint).css(e(d)),i.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1}),d.data(g,{dir:d.attr("dir"),autocomplete:d.attr("autocomplete"),spellcheck:d.attr("spellcheck"),style:d.attr("style")}),d.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(c?k.input:k.inputWithNoHint);try{!d.attr("dir")&&d.attr("dir","auto")}catch(l){}return d.wrap(f).parent().prepend(c?i:null).append(h)}function e(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function f(a){var c=a.find(".tt-input");b.each(c.data(g),function(a,d){b.isUndefined(a)?c.removeAttr(d):c.attr(d,a)}),c.detach().removeData(g).removeClass("tt-input").insertAfter(a),a.remove()}var g="ttAttrs";return b.mixin(c.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,!0),this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(a,b){var c,d;c=this.dropdown.getDatumForCursor(),d=this.dropdown.getDatumForTopSuggestion(),c?(this._select(c),b.preventDefault()):this.autoselect&&d&&(this._select(d),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHintIfInvalid(),b.length>=this.minLength?this.dropdown.update(b):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,c,d,e,f,g;a=this.dropdown.getDatumForTopSuggestion(),a&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(c=this.input.getInputValue(),d=o.normalizeQuery(c),e=b.escapeRegExChars(d),f=new RegExp("^(?:"+e+")(.+$)","i"),g=f.exec(a.value),g?this.input.setHint(c+g[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(a){var b,c,d,e;b=this.input.getHint(),c=this.input.getQuery(),d=a||this.input.isCursorAtEnd(),b&&c!==b&&d&&(e=this.dropdown.getDatumForTopSuggestion(),e&&this.input.setInputValue(e.value),this.eventBus.trigger("autocompleted",e.raw,e.datasetName))},_select:function(a){this.input.setQuery(a.value),this.input.setInputValue(a.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",a.raw,a.datasetName),this.dropdown.close(),b.defer(b.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){a=b.toStr(a),this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),this.input.setInputValue(a,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),f(this.$node),this.$node=null}}),c}();!function(){"use strict";var c,d,e;c=a.fn.typeahead,d="ttTypeahead",e={initialize:function(c,e){function f(){var f,g,h=a(this);b.each(e,function(a){a.highlight=!!c.highlight}),g=new r({input:h,eventBus:f=new l({el:h}),withHint:b.isUndefined(c.hint)?!0:!!c.hint,minLength:c.minLength,autoselect:c.autoselect,datasets:e}),h.data(d,g)}return e=b.isArray(e)?e:[].slice.call(arguments,1),c=c||{},this.each(f)},open:function(){function b(){var b,c=a(this);(b=c.data(d))&&b.open()}return this.each(b)},close:function(){function b(){var b,c=a(this);(b=c.data(d))&&b.close()}return this.each(b)},val:function(b){function c(){var c,e=a(this);(c=e.data(d))&&c.setVal(b)}function e(a){var b,c;return(b=a.data(d))&&(c=b.getVal()),c}return arguments.length?this.each(c):e(this.first())},destroy:function(){function b(){var b,c=a(this);(b=c.data(d))&&(b.destroy(),c.removeData(d))}return this.each(b)}},a.fn.typeahead=function(b){var c;return e[b]&&"initialize"!==b?(c=this.filter(function(){return!!a(this).data(d)}),e[b].apply(c,[].slice.call(arguments,1))):e.initialize.apply(this,arguments)},a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this}}()}(window.jQuery),function(a){"use strict";function b(b,c){this.itemsArray=[],this.$element=a(b),this.$element.hide(),this.isSelect="SELECT"===b.tagName,this.multiple=this.isSelect&&b.hasAttribute("multiple"),this.objectItems=c&&c.itemValue,this.placeholderText=b.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=a('<div class="bootstrap-tagsinput"></div>'),this.$input=a('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var d="100%";this.$input.get(0).style.cssText="width: "+d+" !important;",this.build(c)}function c(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(a){return a[c]}}}function d(a,b){if("function"!=typeof a[b]){var c=a[b];a[b]=function(){return c}}}function e(a){return a?i.text(a).html():""}function f(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b}function g(b,c){var d=!1;return a.each(c,function(a,c){if("number"==typeof c&&b.which===c)return d=!0,!1;if(b.which===c.which){var e=!c.hasOwnProperty("altKey")||b.altKey===c.altKey,f=!c.hasOwnProperty("shiftKey")||b.shiftKey===c.shiftKey,g=!c.hasOwnProperty("ctrlKey")||b.ctrlKey===c.ctrlKey;if(e&&f&&g)return d=!0,!1}}),d}var h={tagClass:function(a){return"label label-info"},itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(a,b){b.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};b.prototype={constructor:b,add:function(b,c){var d=this;if(!(d.options.maxTags&&d.itemsArray.length>=d.options.maxTags)&&(b===!1||b)){if("string"==typeof b&&d.options.trimValue&&(b=a.trim(b)),"object"==typeof b&&!d.objectItems)throw"Can't add objects when itemValue option is not set";if(!b.toString().match(/^\s*$/)){if(d.isSelect&&!d.multiple&&d.itemsArray.length>0&&d.remove(d.itemsArray[0]),"string"==typeof b&&"INPUT"===this.$element[0].tagName){var f=b.split(",");if(f.length>1){for(var g=0;g<f.length;g++)this.add(f[g],!0);return void(c||d.pushVal())}}var h=d.options.itemValue(b),i=d.options.itemText(b),j=d.options.tagClass(b),k=a.grep(d.itemsArray,function(a){return d.options.itemValue(a)===h&&d.options.tagClass(a)===j})[0];if(!k||d.options.allowDuplicates){if(!(d.items().toString().length+b.length+1>d.options.maxInputLength)){var l=a.Event("beforeItemAdd",{item:b,cancel:!1});if(d.$element.trigger(l),!l.cancel){if(d.itemsArray.push(b),b.html)var m=a('<span class="tag '+e(j)+'"> '+b.html+'<span data-role="remove"></span></span>');else var m=a('<span class="tag '+e(j)+'">'+e(i)+'<span data-role="remove"></span></span>');if(m.data("item",b),d.findInputWrapper().before(m),m.after(" "),d.isSelect&&!a('option[value="'+encodeURIComponent(h)+'"]',d.$element)[0]){var n=a("<option selected>"+e(i)+"</option>");n.data("item",b),n.attr("value",h),d.$element.append(n)}c||d.pushVal(),d.options.maxTags!==d.itemsArray.length&&d.items().toString().length!==d.options.maxInputLength||d.$container.addClass("bootstrap-tagsinput-max"),d.$element.trigger(a.Event("itemAdded",{item:b}))}}}else if(d.options.onTagExists){var o=a(".tag",d.$container).filter(function(){return a(this).data("item")===k});d.options.onTagExists(b,o)}}}},remove:function(b,c){var d=this;if(d.objectItems&&(b="object"==typeof b?a.grep(d.itemsArray,function(a){return d.options.itemValue(a)==d.options.itemValue(b)}):a.grep(d.itemsArray,function(a){return d.options.itemValue(a)==b}),b=b[b.length-1]),b){var e=a.Event("beforeItemRemove",{item:b,cancel:!1});if(d.$element.trigger(e),e.cancel)return;a(".tag",d.$container).filter(function(){return a(this).data("item")===b}).remove(),a("option",d.$element).filter(function(){return a(this).data("item")===b}).remove(),-1!==a.inArray(b,d.itemsArray)&&d.itemsArray.splice(a.inArray(b,d.itemsArray),1)}c||d.pushVal(),d.options.maxTags>d.itemsArray.length&&d.$container.removeClass("bootstrap-tagsinput-max"),d.$element.trigger(a.Event("itemRemoved",{item:b}))},removeAll:function(){var b=this;for(a(".tag",b.$container).remove(),a("option",b.$element).remove();b.itemsArray.length>0;)b.itemsArray.pop();b.$input.val(""),b.$input.typeahead("val",""),b.pushVal()},refresh:function(){var b=this;a(".tag",b.$container).each(function(){var c=a(this),d=c.data("item"),f=b.options.itemValue(d),g=b.options.itemText(d),h=b.options.tagClass(d);if(c.attr("class",null),c.addClass("tag "+e(h)),c.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=e(g),b.isSelect){var i=a("option",b.$element).filter(function(){return a(this).data("item")===d});i.attr("value",f)}})},items:function(){return this.itemsArray},pushVal:function(){var b=this,c=a.map(b.items(),function(a){return b.options.itemValue(a).toString()});b.$element.val(c,!0).trigger("change")},build:function(b){var e=this;if(e.options=a.extend({},h,b),c(e.options,"itemValue"),c(e.options,"itemText"),d(e.options,"tagClass"),e.options.typeahead){var i=e.options.typeahead||{};d(i,"source"),e.$input.typeahead(a.extend({},i,{source:function(b,c){function d(a){for(var b=[],d=0;d<a.length;d++){var g=e.options.itemText(a[d]);f[g]=a[d],b.push(g)}c(b)}this.map={};var f=this.map,g=i.source(b);a.isFunction(g.success)?g.success(d):a.isFunction(g.then)?g.then(d):a.when(g).then(d)},updater:function(a){e.add(this.map[a])},matcher:function(a){return-1!==a.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(a){return a.sort()},highlighter:function(a){var b=new RegExp("("+this.query+")","gi");return a.replace(b,"<strong>$1</strong>")}}))}if(e.options.typeaheadjs){var j=e.options.typeaheadjs||{options:{},datasets:{}},k=Object.keys(j),l={};k.indexOf("datasets")<0&&k.indexOf("options")<0&&(l.datasets=j,j=l,l=null),k.indexOf("options")<0&&(j.options={}),e.$input.typeahead(j.options,j.datasets).on("typeahead:selected",a.proxy(function(a,b){j.datasets.valueKey?e.add(b[j.datasets.valueKey]):e.add(b),e.$input.typeahead("val","")},e))}e.$container.on("click",a.proxy(function(a){e.$element.attr("disabled")||e.$input.removeAttr("disabled"),e.$input.focus()},e)),e.options.addOnBlur&&e.options.freeInput&&e.$input.on("focusout",a.proxy(function(b){0===a(".typeahead, .twitter-typeahead",e.$container).length&&(e.add(e.$input.val()),e.$input.val(""))},e)),e.$container.on("keydown","input",a.proxy(function(b){var c=a(b.target),d=e.findInputWrapper();if(e.$element.attr("disabled"))return void e.$input.attr("disabled","disabled");switch(b.which){case 8:if(0===f(c[0])){var g=d.prev();g&&e.remove(g.data("item"))}break;case 46:if(0===f(c[0])){var h=d.next();h&&e.remove(h.data("item"))}break;case 37:var i=d.prev();0===c.val().length&&i[0]&&(i.before(d),c.focus());break;case 39:var j=d.next();0===c.val().length&&j[0]&&(j.after(d),c.focus())}var k=c.val().length;Math.ceil(k/5);c.attr("size",Math.max(this.inputSize,c.val().length))},e)),e.$container.on("keypress","input",a.proxy(function(b){var c=a(b.target);if(e.$element.attr("disabled"))return void e.$input.attr("disabled","disabled");var d=c.val(),f=e.options.maxChars&&d.length>=e.options.maxChars;e.options.freeInput&&(g(b,e.options.confirmKeys)||f)&&(e.add(f?d.substr(0,e.options.maxChars):{id:Math.random().toString(36).substring(7),text:d,value:d,type:"Anywhere",field:"anywhere"}),c.val(""),a(".typeahead, .twitter-typeahead",e.$container).length>0&&e.$input.typeahead("val",""),b.preventDefault());var h=c.val().length;Math.ceil(h/5);c.attr("size",Math.max(this.inputSize,c.val().length))},e)),e.$container.on("click","[data-role=remove]",a.proxy(function(b){e.$element.attr("disabled")||e.remove(a(b.target).closest(".tag").data("item"))},e)),e.options.itemValue===h.itemValue&&("INPUT"===e.$element[0].tagName?e.add(e.$element.val()):a("option",e.$element).each(function(){e.add(a(this).attr("value"),!0)}))},destroy:function(){var a=this;a.$container.off("keypress","input"),a.$container.off("click","[role=remove]"),a.$container.remove(),a.$element.removeData("tagsinput"),a.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var b=this.$input[0],c=this.$container[0];b&&b.parentNode!==c;)b=b.parentNode;return a(b)}},a.fn.tagsinput=function(c,d){var e=[];return this.each(function(){var f=a(this).data("tagsinput");if(f)if(c||d){if(void 0!==f[c]){var g=f[c](d);void 0!==g&&e.push(g)}}else e.push(f);else f=new b(this,c),a(this).data("tagsinput",f),e.push(f),"SELECT"===this.tagName&&a("option",a(this)).attr("selected","selected"),a(this).val(a(this).val())}),"string"==typeof c?e.length>1?e:e[0]:e},a.fn.tagsinput.Constructor=b;var i=a("<div />");a(function(){a("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery),function(){function a(a,b){var c=b-a.y,d=2*a.radius;if(!(c-d>0)){var e=a.x,f=Math.sqrt(d*d-c*c),g=a.index;return{p1:{index:g,isEnd:!1,isValid:!0,x:e+f,y:b},p2:{index:g,isEnd:!1,isValid:!0,x:e-f,y:b}}}}function b(b,c){for(var d=0,e=c.length,f=[];e--;){var g=a(c[d],b);void 0!==g?(f.push(g.p1),f.push(g.p2),++d):c.splice(d,1)}return f}function c(a,b){return function(c,d){return c[a]===d[a]?void 0===b?0:c[b]===d[b]?0:c[b]<d[b]?-1:1:c[a]<d[a]?-1:1}}function d(a){var b=a.length,d=[];if(1>b)return d;var e,f,g=b-1;for(a.sort(c("x","index")),e=0;g>e;++e)if(!a[e].isEnd)for(f=e+1;b>f;++f){if(a[e].index===a[f].index){a[f].isEnd=!0;break}a[f].isValid=!1}for(e=0;b>e;++e)a[e].isValid&&d.push(a[e]);return d}function e(a,b){var d,e=a.length,f=[];for(d=0;e>d;++d)f.push({i:d,d:Math.abs(b-a[d].x)});return f.sort(c("d")),a[f[0].i].x}function f(a,c,f,g,h,i){var j,k=c.y*i,l=b(k,f),m={index:a,isEnd:!1,isValid:!0,x:g,y:k};return l.push(m),l.push(m),l=d(l),j=e(l,g),f.push({index:a,x:j,y:k,radius:h}),j}Beeswarm=function(a,b,d,e){var g=0;this.data=a,this.xaxis=b,this.radius=d,this.scaleFactor=e;var h,i=[],j=[],k=a.length;for(a.sort(c("y")),h=0;k>h;++h){i.push({x:f(h,a[h],j,b,d,e)/e,y:a[h].y});var l=Math.abs(i[h].x);l>g&&(g=l)}this.swarm=i,0===g&&(g=1),this.domain=[-g,g],this.maxPoints=Math.ceil(g*e/d)}}(),function(a){if("function"==typeof define&&define.amd)define(a);else if("object"==typeof exports){var b=module.exports=a(!0,require("fs"));b.renderFile=b.__express=function(a,c,d){var e=b.templates("@"+a).render(c);return d&&d(null,e),e}}else a(!1)}(function(a,b){"use strict";function c(a,b){return function(){var c,d=this,e=d.base;return d.base=a,c=b.apply(d,arguments),d.base=e,c}}function d(a,b){return za(b)&&(b=c(a?a._d?a:c(g,a):g,b),b._d=1),b}function e(a,b){for(var c in b.props)ma.test(c)&&(a[c]=d(a[c],b.props[c]))}function f(a){return a}function g(){return""}function h(a){try{throw"dbg breakpoint"}catch(b){}return this.base?this.baseApply(arguments):a}function i(a){Ga._dbgMode=a!==!1}function j(a){this.name=(X.link?"JsViews":"JsRender")+" Error",this.message=a||this.name}function k(a,b){var c;for(c in b)a[c]=b[c];return a}function l(a,b,c){return(0!==this||a)&&(Z=a?a.charAt(0):Z,$=a?a.charAt(1):$,_=b?b.charAt(0):_,aa=b?b.charAt(1):aa,ba=c||ba,a="\\"+Z+"(\\"+ba+")?\\"+$,b="\\"+_+"\\"+aa,R="(?:(?:(\\w+(?=[\\/\\s\\"+_+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+_+"]|\\"+_+"(?!\\"+aa+"))*?)",Fa.rTag=R+")",R=new RegExp(a+R+"(\\/)?|(?:\\/(\\w+)))"+b,"g"),S=new RegExp("<.*>|([^\\\\]|^)[{}]|"+a+".*"+b)),[Z,$,_,aa,ba]}function m(a,b){b||(b=a,a=void 0);var c,d,e,f,g=this,h=!b||"root"===b;if(a){if(f=g.type===b?g:void 0,!f)if(c=g.views,g._.useKey){for(d in c)if(f=c[d].get(a,b))break}else for(d=0,e=c.length;!f&&e>d;d++)f=c[d].get(a,b)}else if(h)for(;g.parent.parent;)f=g=g.parent;else for(;g&&!f;)f=g.type===b?g:void 0,g=g.parent;return f}function n(){var a=this.get("item");return a?a.index:void 0}function o(){return this.index}function p(a){var b,c=this,d=c.linkCtx,e=(c.ctx||{})[a];return void 0===e&&d&&d.ctx&&(e=d.ctx[a]),void 0===e&&(e=Da[a]),e&&za(e)&&!e._wrp&&(b=function(){return e.apply(this&&this!==W?this:c,arguments)},b._wrp=!0,k(b,e)),b||e}function q(a,b,c,d){var f,g,h="number"==typeof c&&b.tmpl.bnds[c-1],i=b.linkCtx;return void 0!==d?c=d={props:{},args:[d]}:h&&(c=h(b.data,b,xa)),g=c.args[0],(a||h)&&(f=i&&i.tag,f||(f=k(new Fa._tg,{_:{inline:!i,bnd:h,unlinked:!0},tagName:":",cvt:a,flow:!0,tagCtx:c}),i&&(i.tag=f,f.linkCtx=i),c.ctx=M(c.ctx,(i?i.view:b).ctx)),f._er=d&&g,e(f,c),c.view=b,f.ctx=c.ctx||{},c.ctx=void 0,b._.tag=f,g=f.cvtArgs(f.convert||"true"!==a&&a)[0],g=h&&b._.onRender?b._.onRender(g,b,h):g,b._.tag=void 0),void 0!=g?g:""}function r(a){var b=this,c=b.tagCtx,d=c.view,e=c.args;return a=b.convert||a,a=a&&(""+a===a?d.getRsc("converters",a)||E("Unknown converter: '"+a+"'"):a),e=e.length||c.index?a?e.slice():e:[d.data],a&&(a.depends&&(b.depends=Fa.getDeps(b.depends,b,a.depends,a)),e[0]=a.apply(b,e)),e}function s(a,b){for(var c,d,e=this;void 0===c&&e;)d=e.tmpl&&e.tmpl[a],c=d&&d[b],e=e.parent;return c||xa[a][b]}function t(a,b,c,d,f,g){b=b||T;var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z="",A=b.linkCtx||0,B=b.ctx,D=c||b.tmpl,F="number"==typeof d&&b.tmpl.bnds[d-1];for("tag"===a._is?(h=a,a=h.tagName,d=h.tagCtxs,j=h.template):(i=b.getRsc("tags",a)||E("Unknown tag: {{"+a+"}} "),j=i.template),void 0!==g?(z+=g,d=g=[{props:{},args:[]}]):F&&(d=F(b.data,b,xa)),o=d.length,n=0;o>n;n++)q=d[n],(!A||!A.tag||n&&!A.tag._.inline||h._er)&&((s=q.tmpl)&&(s=q.content=D.tmpls[s-1]),q.index=n,q.tmpl=j||s,q.render=C,q.view=b,q.ctx=M(q.ctx,B)),(c=q.props.tmpl)&&(c=""+c===c?b.getRsc("templates",c)||Ba(c):c,q.tmpl=c),h||(h=new i._ctr,t=!!h.init,h.parent=m=B&&B.tag,h.tagCtxs=d,A&&(h._.inline=!1,A.tag=h,h.linkCtx=A),(h._.bnd=F||A.fn)?h._.arrVws={}:h.dataBoundOnly&&E("{^{"+a+"}} tag must be data-bound")),q.tag=h,h.dataMap&&h.tagCtxs&&(q.map=h.tagCtxs[n].map),h.flow||(r=q.ctx=q.ctx||{},k=h.parents=r.parentTags=B&&M(r.parentTags,B.parentTags)||{},m&&(k[m.tagName]=m),k[h.tagName]=r.tag=h);if((F||A)&&(b._.tag=h),!(h._er=g)){for(e(h,d[0]),h.rendering={},n=0;o>n;n++)q=h.tagCtx=h.tagCtxs[n],x=q.props,w=h.cvtArgs(),(u=x.dataMap||h.dataMap)&&(w.length||x.dataMap)&&(v=q.map,v&&v.src===w[0]&&!f||(v&&v.src&&v.unmap(),v=q.map=u.map(w[0],x)),w=[v.tgt]),h.ctx=q.ctx,n||(t&&(y=h.template,h.init(q,A,h.ctx),t=void 0,h.template!==y&&(h._.tmpl=h.template)),A&&(A.attr=h.attr=A.attr||h.attr),l=h.attr,h._.noVws=l&&l!==ra),p=void 0,h.render&&(p=h.render.apply(h,w)),w.length||(w=[b]),void 0===p&&(p=q.render(w.length?w[0]:b,!0)||(f?void 0:"")),z=z?z+(p||""):p;h.rendering=void 0}return h.tagCtx=h.tagCtxs[0],h.ctx=h.tagCtx.ctx,h._.noVws&&h._.inline&&(z="text"===l?Ca.html(z):""),F&&b._.onRender?b._.onRender(z,b,F):z}function u(a,b,c,d,e,f,g,h){var i,j,k,l,m=this,o="array"===b;m.content=g,m.views=o?[]:{},m.parent=c,m.type=b||"top",m.data=d,m.tmpl=e,l=m._={key:0,useKey:o?0:1,id:""+pa++,onRender:h,bnds:{}},m.linked=!!h,c?(i=c.views,j=c._,j.useKey?(i[l.key="_"+j.useKey++]=m,m.index=ua,m.getIndex=n,k=j.tag,l.bnd=o&&(!k||!!k._.bnd&&k)):i.length===(l.key=m.index=f)?i.push(m):i.splice(f,0,m),m.ctx=a||c.ctx):m.ctx=a}function v(a){var b,c,d,e,f,g,h;for(b in wa)if(f=wa[b],(g=f.compile)&&(c=a[b+"s"]))for(d in c)e=c[d]=g(d,c[d],a,0),e._is=b,e&&(h=Fa.onStore[b])&&h(d,e,g)}function w(a,b,c){function e(){var b=this;b._={inline:!0,unlinked:!0},b.tagName=a}var f,g,h,i=new Fa._tg;if(za(b)?b={depends:b.depends,render:b}:""+b===b&&(b={template:b}),g=b.baseTag){b.flow=!!b.flow,b.baseTag=g=""+g===g?c&&c.tags[g]||Ea[g]:g,i=k(i,g);for(h in b)i[h]=d(g[h],b[h])}else i=k(i,b);return void 0!==(f=i.template)&&(i.template=""+f===f?Ba[f]||Ba(f):f),i.init!==!1&&((e.prototype=i).constructor=i._ctr=e),c&&(i._parentTmpl=c),i}function x(a){return this.base.apply(this,a)}function y(a,c,d,e){function f(c){var f;if(""+c===c||c.nodeType>0&&(g=c)){if(!g)if("@"===c.charAt(0))b?c=Ba[a=a||(c=b.realpathSync(c.slice(1)))]=Ba[a]||y(a,b.readFileSync(c,"utf8"),d,e):g=Y.getElementById(c);else if(X.fn&&!S.test(c))try{
g=X(Y).find(c)[0]}catch(h){}g&&(e?c=g.innerHTML:((f=g.getAttribute(ta))&&(c=Ba[f])&&a!==f&&delete Ba[f],a=a||f||"_"+oa++,f||(c=y(a,g.innerHTML,d,e)),g.setAttribute(ta,a),Ba[c.tmplName=a]=c),g=void 0)}else c.fn||(c=void 0);return c}var g,h,i=c=c||"";return 0===e&&(e=void 0,i=f(i)),e=e||(c.markup?c:{}),e.tmplName=a,d&&(e._parentTmpl=d),!i&&c.markup&&(i=f(c.markup))&&i.fn&&(i=i.markup),void 0!==i?(i.fn||c.fn?i.fn&&(h=i):(c=A(i,e),G(i.replace(ga,"\\$&"),c)),h||(v(e),h=k(function(){return c.render.apply(c,arguments)},c)),a&&!d&&(va[a]=h),h):void 0}function z(a){function b(b,c){this.tgt=a.getTgt(b,c)}return za(a)&&(a={getTgt:a}),a.baseMap&&(a=k(k({},a.baseMap),a)),a.map=function(a,c){return new b(a,c)},a}function A(a,b){var c,d=Ga.wrapMap||{},e=k({tmpls:[],links:{},bnds:[],_is:"template",render:C},b);return e.markup=a,b.htmlTag||(c=ja.exec(a),e.htmlTag=c?c[1].toLowerCase():""),c=d[e.htmlTag],c&&c!==d.div&&(e.markup=X.trim(e.markup)),e}function B(a,b){function c(e,f,g){var h,i,j,k;if(e&&typeof e===sa&&!e.nodeType&&!e.markup&&!e.getTgt){for(j in e)c(j,e[j],f);return xa}return void 0===f&&(f=e,e=void 0),e&&""+e!==e&&(g=f,f=e,e=void 0),k=g?g[d]=g[d]||{}:c,i=b.compile,null===f?e&&delete k[e]:(f=i?i(e,f,g,0):f,e&&(k[e]=f)),i&&f&&(f._is=a),f&&(h=Fa.onStore[a])&&h(e,f,i),f}var d=a+"s";xa[d]=c}function C(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=d,p="";if(b===!0?(c=b,b=void 0):typeof b!==sa&&(b=void 0),(i=this.tag)?(k=this,j=i._.tmpl||k.tmpl,o=o||k.view,arguments.length||(a=o)):j=this,j){if(!o&&a&&"view"===a._is&&(o=a),o&&a===o&&(a=o.data),j.fn||(j=i._.tmpl=Ba[j]||Ba(j)),U=U||(l=!o),o||((b=b||{}).root=a),!U||j.useViews)p=D(j,a,b,c,o,e,f,i);else{if(o?(m=o.data,n=o.index,o.index=ua):(o=T,o.data=a,o.ctx=b),Aa(a)&&!c)for(g=0,h=a.length;h>g;g++)o.index=g,o.data=a[g],p+=j.fn(a[g],o,xa);else p+=j.fn(a,o,xa);o.data=m,o.index=n}l&&(U=void 0)}return p}function D(a,b,c,d,e,f,g,h){function i(a){v=k({},c),v[t]=a}var j,l,m,n,o,p,q,r,s,t,v,w,x="";if(h&&(s=h.tagName,w=h.tagCtx,c=c?M(c,h.ctx):h.ctx,q=w.content,w.props.link===!1&&(c=c||{},c.link=!1),(t=w.props.itemVar)&&("~"!==t.charAt(0)&&F("Use itemVar='~myItem'"),t=t.slice(1))),e&&(q=q||e.content,g=g||e._.onRender,c=c||e.ctx),f===!0&&(p=!0,f=0),g&&(c&&c.link===!1||h&&h._.noVws)&&(g=void 0),r=g,g===!0&&(r=void 0,g=e._.onRender),c=a.helpers?M(a.helpers,c):c,v=c,Aa(b)&&!d)for(m=p?e:void 0!==f&&e||new u(c,"array",e,b,a,f,q,g),t&&(m.it=t),t=m.it,j=0,l=b.length;l>j;j++)t&&i(b[j]),n=new u(v,"item",m,b[j],a,(f||0)+j,q,g),o=a.fn(b[j],n,xa),x+=m._.onRender?m._.onRender(o,n):o;else t&&i(b),m=p?e:new u(v,s||"data",e,b,a,f,q,g),h&&!h.flow&&(m.tag=h),x+=a.fn(b,m,xa);return r?r(x,m):x}function E(a,b,c){var d=Ga.onError(a,b,c);if(""+a===a)throw new Fa.Err(d);return!b.linkCtx&&b.linked?Ca.html(d):d}function F(a){E("Syntax error\n"+a)}function G(a,b,c,d,e){function f(b){b-=n,b&&p.push(a.substr(n,b).replace(ea,"\\n"))}function g(b,c){b&&(b+="}}",F((c?"{{"+c+"}} block has {{/"+b+" without {{"+b:"Unmatched or missing {{/"+b)+", in template:\n"+a))}function h(h,i,m,r,s,t,u,v,w,x,y,z){t&&(s=":",r=ra),x=x||c&&!e;var A=(i||c)&&[[]],B="",C="",D="",E="",G="",H="",J="",L="",M=!x&&!s&&!u;m=m||(w=w||"#data",s),f(z),n=z+h.length,v?l&&p.push(["*","\n"+w.replace(/^:/,"ret+= ").replace(fa,"$1")+";\n"]):m?("else"===m&&(ia.test(w)&&F('for "{{else if expr}}" use "{{else expr}}"'),A=q[7]&&[[]],q[8]=a.substring(q[8],z),q=o.pop(),p=q[2],M=!0),w&&K(w.replace(ea," "),A,b).replace(ha,function(a,b,c,d,e,f,g,h){return d="'"+e+"':",g?(C+=f+",",E+="'"+h+"',"):c?(D+=d+f+",",H+=d+"'"+h+"',"):b?J+=f:("trigger"===e&&(L+=f),B+=d+f+",",G+=d+"'"+h+"',",k=k||ma.test(e)),""}).slice(0,-1),A&&A[0]&&A.pop(),j=[m,r||!!d||k||"",M&&[],I(E,G,H),I(C,B,D),J,L,A||0],p.push(j),M&&(o.push(q),q=j,q[8]=n)):y&&(g(y!==q[0]&&"else"!==q[0]&&y,q[0]),q[8]=a.substring(q[8],z),q=o.pop()),g(!q&&y),p=q[2]}var i,j,k,l=Ga.allowCode||b&&b.allowCode,m=[],n=0,o=[],p=m,q=[,,m];return l&&(b.allowCode=l),c&&(a=Z+a+aa),g(o[0]&&o[0][2].pop()[0]),a.replace(R,h),f(a.length),(n=m[m.length-1])&&g(""+n!==n&&+n[8]===n[8]&&n[0]),c?(i=L(m,a,c),H(i,[m[0][7]])):i=L(m,b),i}function H(a,b){var c,d,e=0,f=b.length;for(a.deps=[];f>e;e++){d=b[e];for(c in d)"_jsvto"!==c&&d[c].length&&(a.deps=a.deps.concat(d[c]))}a.paths=d}function I(a,b,c){return[a.slice(0,-1),b.slice(0,-1),c.slice(0,-1)]}function J(a,b){return"\n	"+(b?b+":{":"")+"args:["+a[0]+"]"+(a[1]||!b?",\n	props:{"+a[1]+"}":"")+(a[2]?",\n	ctx:{"+a[2]+"}":"")}function K(a,b,c){function d(d,r,s,t,u,v,w,x,y,z,A,B,C,D,E,H,I,J,K,L){function M(a,c,d,g,h,i,l,m){var n="."===d;if(d&&(u=u.slice(c.length),n||(a=(g?'view.hlp("'+g+'")':h?"view":"data")+(m?(i?"."+i:g?"":h?"":"."+d)+(l||""):(m=g?"":h?i||"":d,"")),a+=m?"."+m:"",a=c+("view.data"===a.slice(0,9)?a.slice(5):a)),j)){if(P="linkTo"===e?f=b._jsvto=b._jsvto||[]:k.bd,Q=n&&P[P.length-1]){if(Q._jsv){for(;Q.sb;)Q=Q.sb;Q.bnd&&(u="^"+u.slice(1)),Q.sb=u,Q.bnd=Q.bnd||"^"===u.charAt(0)}}else P.push(u);q[o]=K+(n?1:0)}return a}t=j&&t,t&&!x&&(u=t+u),v=v||"",s=s||r||B,u=u||y,z=z||I||"";var N,O,P,Q,R;if(!w||i||h){if(j&&H&&!i&&!h&&(!e||g||f)&&(N=q[o-1],L.length-1>K-(N||0))){if(N=L.slice(N,K+d.length),O!==!0)if(P=f||l[o-1].bd,Q=P[P.length-1],Q&&Q.prm){for(;Q.sb&&Q.sb.prm;)Q=Q.sb;R=Q.sb={path:Q.sb,bnd:Q.bnd}}else P.push(R={path:P.pop()});H=$+":"+N+" onerror=''"+_,O=n[H],O||(n[H]=!0,n[H]=O=G(H,c,!0)),O!==!0&&R&&(R._jsv=O,R.prm=k.bd,R.bnd=R.bnd||R.path&&R.path.indexOf("^")>=0)}return i?(i=!C,i?d:B+'"'):h?(h=!D,h?d:B+'"'):(s?(q[o]=K++,k=l[++o]={bd:[]},s):"")+(J?o?"":(m=L.slice(m,K),(e?(e=g=f=!1,"\b"):"\b,")+m+(m=K+d.length,j&&b.push(k.bd=[]),"\b")):x?(o&&F(a),j&&b.pop(),e=u,g=t,m=K+d.length,t&&(j=k.bd=b[e]=[]),u+":"):u?u.split("^").join(".").replace(ca,M)+(z?(k=l[++o]={bd:[]},p[o]=!0,z):v):v?v:E?(p[o]=!1,k=l[--o],E+(z?(k=l[++o],p[o]=!0,z):"")):A?(p[o]||F(a),","):r?"":(i=C,h=D,'"'))}F(a)}var e,f,g,h,i,j=b&&b[0],k={bd:j},l={0:k},m=0,n=c?c.links:j&&(j.links=j.links||{}),o=0,p={},q={};return(a+(c?" ":"")).replace(da,d)}function L(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,B,C,D,E,G,I,K,M=0,N=b.useViews||b.tags||b.templates||b.helpers||b.converters,O="",P={},Q=a.length;for(""+b===b?(u=c?'data-link="'+b.replace(ea," ").slice(1,-1)+'"':b,b=0):(u=b.tmplName||"unnamed",b.allowCode&&(P.allowCode=!0),b.debug&&(P.debug=!0),n=b.bnds,t=b.tmpls),d=0;Q>d;d++)if(e=a[d],""+e===e)O+='\n+"'+e+'"';else if(f=e[0],"*"===f)O+=";\n"+e[1]+"\nret=ret";else{if(g=e[1],x=!c&&e[2],h=J(e[3],"params")+"},"+J(p=e[4]),G=e[5],K=e[6],y=e[8]&&e[8].replace(fa,"$1"),(C="else"===f)?o&&o.push(e[7]):(M=0,n&&(o=e[7])&&(o=[o],M=n.push(1))),N=N||p[1]||p[2]||o||/view.(?!index)/.test(p[0]),(D=":"===f)?g&&(f=g===ra?">":g+f):(x&&(v=A(y,P),v.tmplName=u+"/"+f,v.useViews=v.useViews||N,L(x,v),N=v.useViews,t.push(v)),C||(w=f,N=N||f&&(!Ea[f]||!Ea[f].flow),B=O,O=""),z=a[d+1],z=z&&"else"===z[0]),I=G?";\ntry{\nret+=":"\n+",q="",r="",D&&(o||K||g&&g!==ra)){if(E="return {"+h+"};",s='c("'+g+'",view,',E=new Function("data,view,j,u"," // "+u+" "+M+" "+f+"\n"+E),E._er=G,q=s+M+",",r=")",E._tag=f,c)return E;H(E,o),m=!0}if(O+=D?(c?(G?"\ntry{\n":"")+"return ":I)+(m?(m=void 0,N=l=!0,s+(o?(n[M-1]=E,M):"{"+h+"}")+")"):">"===f?(j=!0,"h("+p[0]+")"):(k=!0,"((v="+(p[0]||"data")+')!=null?v:"")')):(i=!0,"\n{view:view,tmpl:"+(x?t.length:"0")+","+h+"},"),w&&!z){if(O="["+O.slice(0,-1)+"]",s='t("'+w+'",view,this,',c||o){if(O=new Function("data,view,j,u"," // "+u+" "+M+" "+w+"\nreturn "+O+";"),O._er=G,O._tag=w,o&&H(n[M-1]=O,o),c)return O;q=s+M+",undefined,",r=")"}O=B+I+s+(M||O)+")",o=0,w=0}G&&(N=!0,O+=";\n}catch(e){ret"+(c?"urn ":"+=")+q+"j._err(e,view,"+G+")"+r+";}\n"+(c?"":"ret=ret"))}O="// "+u+"\nvar v"+(i?",t=j._tag":"")+(l?",c=j._cnvt":"")+(j?",h=j.converters.html":"")+(c?";\n":',ret=""\n')+(P.debug?"debugger;":"")+O+(c?"\n":";\nreturn ret;"),Ga._dbgMode&&(O="try {\n"+O+"\n}catch(e){\nreturn j._err(e, view);\n}");try{O=new Function("data,view,j,u",O)}catch(R){F("Compiled template code:\n\n"+O+'\n: "'+R.message+'"')}return b&&(b.fn=O,b.useViews=!!N),O}function M(a,b){return a&&a!==b?b?k(k({},b),a):a:b&&k({},b)}function N(a){return qa[a]||(qa[a]="&#"+a.charCodeAt(0)+";")}function O(a){var b,c,d=[];if(typeof a===sa)for(b in a)c=a[b],c&&c.toJSON&&!c.toJSON()||za(c)||d.push({key:b,prop:c});return d}function P(a){return void 0!=a?la.test(a)&&(""+a).replace(na,N)||a:""}a=a===!0;var Q,R,S,T,U,V="v1.0.0-beta",W=(0,eval)("this"),X=W.jQuery,Y=W.document,Z="{",$="{",_="}",aa="}",ba="^",ca=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,da=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*[.^]|\s*$|[^\(\[])|[)\]])([([]?))|(\s+)/g,ea=/[ \t]*(\r\n|\n|\r)/g,fa=/\\(['"])/g,ga=/['"\\]/g,ha=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$_\.]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,ia=/^if\s/,ja=/<(\w+)[>\s]/,ka=/[\x00`><"'&]/g,la=/[\x00`><\"'&]/,ma=/^on[A-Z]|^convert(Back)?$/,na=ka,oa=0,pa=0,qa={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},ra="html",sa="object",ta="data-jsv-tmpl",ua="For #index in nested block use #getIndex().",va={},wa={template:{compile:y},tag:{compile:w},helper:{},converter:{}},xa={jsviews:V,settings:function(a){k(Ga,a),i(Ga._dbgMode),Ga.jsv&&Ga.jsv()},sub:{View:u,Err:j,tmplFn:G,parse:K,extend:k,syntaxErr:F,onStore:{},_ths:e,_tg:function(){}},map:z,_cnvt:q,_tag:t,_err:E},ya=W.jsviews;(j.prototype=new Error).constructor=j,n.depends=function(){return[this.get("item"),"index"]},o.depends="index",u.prototype={get:m,getIndex:o,getRsc:s,hlp:p,_is:"view"};for(Q in wa)B(Q,wa[Q]);var za,Aa,Ba=xa.templates,Ca=xa.converters,Da=xa.helpers,Ea=xa.tags,Fa=xa.sub,Ga=xa.settings;return Fa._tg.prototype={baseApply:x,cvtArgs:r},T=Fa.topView=new u,X?(X.fn.render=function(a,b,c){var d=this.jquery&&(this[0]||E('Unknown template: "'+this.selector+'"')),e=d.getAttribute(ta);return C.call(e?Ba[e]:Ba(d),a,b,c)},X.observable&&(k(Fa,X.views.sub),xa.map=X.views.map)):(X={},a||(W.jsviews=X),X.isFunction=function(a){return"function"==typeof a},X.isArray=Array.isArray||function(a){return"[object Array]"===X.toString.call(a)},X.noConflict=function(){return W.jsviews===X&&(W.jsviews=ya),X}),za=X.isFunction,Aa=X.isArray,X.render=va,X.views=xa,X.templates=Ba=xa.templates,xa.compile=function(a,b){return b=b||{},b.markup=a,Ba(b)},Ga({debugMode:i,delimiters:l,onError:function(a,b,c){return b&&(a=void 0===c?"{Error: "+(a.message||a)+"}":za(c)?c(a,b):c),void 0==a?"":a},_dbgMode:!1}),Ea({"if":{render:function(a){var b=this,c=b.tagCtx,d=b.rendering.done||!a&&(arguments.length||!c.index)?"":(b.rendering.done=!0,b.selected=c.index,c.render(c.view,!0));return d},flow:!0},"for":{render:function(a){var b,c=!arguments.length,d=this,e=d.tagCtx,f="",g=0;return d.rendering.done||(b=c?e.view.data:a,void 0!==b&&(f+=e.render(b,c),g+=Aa(b)?b.length:1),(d.rendering.done=g)&&(d.selected=e.index)),f},flow:!0},props:{baseTag:"for",dataMap:z(O),flow:!0},include:{flow:!0},"*":{render:f,flow:!0},":*":{render:f,flow:!0},dbg:Da.dbg=Ca.dbg=h}),Ca({html:P,attr:P,url:function(a){return void 0!=a?encodeURI(""+a):null===a?a:""}}),l(),xa}),function(a,b){"use strict";function c(c,d){this.options=a.extend({},h,d),this.$element=a(c),this.$win=a(b),this.$loadingClassTarget=this._getLoadingClassTarget(),this.$scrollContainer=this._getScrollContainer(),this.loading=!1,this.doneLoadingInt=null,this.pageCount=this.options.triggerInitialLoad?this.options.startingPageCount-1:this.options.startingPageCount,this.destroyed=!1,this._init()}function d(b,c,d){b&&a.isFunction(b[c])&&b[c].apply(b,d)}function e(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}var f="infiniteScrollHelper",g="plugin_"+f,h={bottomBuffer:0,debounceInt:100,doneLoading:null,interval:300,loadingClass:"loading",loadingClassTarget:null,loadMoreDelay:0,loadMore:a.noop,startingPageCount:1,triggerInitialLoad:!1};c.prototype._init=function(){this._addListeners(),this.options.triggerInitialLoad?this._beginLoadMore(this.options.loadMoreDelay):this._handleScroll()},c.prototype._getLoadingClassTarget=function(){return this.options.loadingClassTarget?a(this.options.loadingClassTarget):this.$element},c.prototype._getScrollContainer=function(){var b=null;return"auto"==this.$element.css("overflow-y")&&(b=this.$element),b||(b=this.$element.parents().filter(function(){return"auto"==a(this).css("overflow-y")})),b=b.length>0?b:this.$win},c.prototype._addListeners=function(){var a=this;this.$scrollContainer.on("scroll."+f,e(function(){a._handleScroll()},this.options.debounceInt))},c.prototype._removeListeners=function(){this.$scrollContainer.off("scroll."+f)},c.prototype._handleScroll=function(a){var b=this;this._shouldTriggerLoad()&&(this._beginLoadMore(this.options.loadMoreDelay),this.options.doneLoading&&(this.doneLoadingInt=setInterval(function(){b.options.doneLoading(b.pageCount)&&b._endLoadMore()},this.options.interval)))},c.prototype._shouldTriggerLoad=function(){var a=this._getElementHeight(),b=this.$scrollContainer.scrollTop()+this.$scrollContainer.height()+this.options.bottomBuffer;return!this.loading&&b>=a&&this.$element.is(":visible")},c.prototype._getElementHeight=function(){return this.$element==this.$scrollContainer?this.$element[0].scrollHeight:this.$element.height()},c.prototype._beginLoadMore=function(b){b=b||0,setTimeout(a.proxy(function(){this.pageCount++,this.options.loadMore(this.pageCount,a.proxy(this._endLoadMore,this)),this.$loadingClassTarget.addClass(this.options.loadingClass)},this),b),this.loading=!0,this._removeListeners()},c.prototype._endLoadMore=function(){clearInterval(this.doneLoadingInt),this.loading=!1,this.$loadingClassTarget.removeClass(this.options.loadingClass),!this.destroyed&&this._addListeners()},c.prototype.destroy=function(){this._removeListeners(),this.options.loadMore=null,this.options.doneLoading=null,a.data(this.$element[0],g,null),clearInterval(this.doneLoadingInt),this.destroyed=!0},a.fn[f]=function(b){var e=!1,f=arguments;return"string"==typeof b&&(e=b),this.each(function(){var h=a.data(this,g);h||e?e&&d(h,e,Array.prototype.slice.call(f,1)):a.data(this,g,new c(this,b))})},b.InfiniteScrollHelper=b.InfiniteScrollHelper||c}(jQuery,window),$.fn.redraw=function(){$(this).each(function(){this.offsetHeight})},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Number.prototype.roundDecimals=function(a){if(Math.floor(this.valueOf())===this.valueOf())return this.valueOf();var b=this.toString().split(".")[1].length;return a>b?this.valueOf():this.valueOf().toFixed(a)},function(a){var b=/([^&=]+)=?([^&]*)/g,c=function(a){return decodeURIComponent(a.replace(/\+/g," "))};a.parseParams=function(d){function e(b,c,d){if(c+="",-1!==c.indexOf(".")){var f=c.split("."),g=c.split(/\.(.+)?/)[1];b[f[0]]||(b[f[0]]={}),""!==g?e(b[f[0]],g,d):console.warn('parseParams :: empty property in key "'+c+'"')}else if(-1!==c.indexOf("[")){var f=c.split("[");c=f[0];var f=f[1].split("]"),h=f[0];""==h?(b||(b={}),b[c]&&a.isArray(b[c])||(b[c]=[]),b[c].push(d)):(b||(b={}),b[c]&&a.isArray(b[c])||(b[c]=[]),b[c][parseInt(h)]=d)}else b||(b={}),b[c]=d}d?d+="":d=window.location+"";var f,g={};if(d){if(-1!==d.indexOf("#")&&(d=d.substr(0,d.indexOf("#"))),-1===d.indexOf("?"))return{};if(d=d.substr(d.indexOf("?")+1,d.length),""==d)return{};for(;f=b.exec(d);){var h=c(f[1]),i=c(f[2]);e(g,h,i)}}return g}}(jQuery),function(a){a.encodeURL=function(b){function c(b,d){if(null===b)return"";if(a.isArray(b)){for(var e=0,f="",g=0;g<b.length;g++)e>0&&(f+="&"),f+=d+"[]="+b[g],e++;return f}if("object"==typeof b){var e=0,f="";for(var h in b)b.hasOwnProperty(h)&&(e>0&&(f+="&"),f+=c(b[h],d+"."+h),e++);return f}return d+"="+b}var d="?",e=0;for(var f in b)b.hasOwnProperty(f)&&(e>0&&(d+="&"),d+=c(b[f],f),e++);return d}}(jQuery);